<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Eirc Chang&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="~爱前端，爱生活~">
<meta property="og:type" content="website">
<meta property="og:title" content="Eirc Chang's Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Eirc Chang's Blog">
<meta property="og:description" content="~爱前端，爱生活~">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eirc Chang's Blog">
<meta name="twitter:description" content="~爱前端，爱生活~">
  
    <link rel="alternative" href="/atom.xml" title="Eirc Chang&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">


	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/images/me.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/" style="font-family: Microsoft Yahei;">Eric Chang</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">归档</a></li>
				        
							<li><a href="/tags/feeling">感悟</a></li>
				        
							<li><a href="/tags/me">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/changsiyuan" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/2803286360" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:changsiyuan2011@126.com" title="mail">mail</a>
					        
								<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/preview?locale=zh_CN&trk=prof-0-sb-preview-primary-button" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Angularjs/" style="font-size: 11.25px;">Angularjs</a> <a href="/tags/JSONP/" style="font-size: 10px;">JSONP</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 18.75px;">JavaScript</a> <a href="/tags/Latex/" style="font-size: 10px;">Latex</a> <a href="/tags/Linkedlist/" style="font-size: 10px;">Linkedlist</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Operating-System/" style="font-size: 10px;">Operating System</a> <a href="/tags/RESTful/" style="font-size: 10px;">RESTful</a> <a href="/tags/Web/" style="font-size: 17.5px;">Web</a> <a href="/tags/books/" style="font-size: 10px;">books</a> <a href="/tags/computer/" style="font-size: 11.25px;">computer</a> <a href="/tags/cooking/" style="font-size: 10px;">cooking</a> <a href="/tags/css/" style="font-size: 12.5px;">css</a> <a href="/tags/datebase/" style="font-size: 13.75px;">datebase</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/feeling/" style="font-size: 15px;">feeling</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/glassfish/" style="font-size: 10px;">glassfish</a> <a href="/tags/hadoop/" style="font-size: 16.25px;">hadoop</a> <a href="/tags/hardware/" style="font-size: 10px;">hardware</a> <a href="/tags/hdfs/" style="font-size: 10px;">hdfs</a> <a href="/tags/html/" style="font-size: 11.25px;">html</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/jQuery/" style="font-size: 12.5px;">jQuery</a> <a href="/tags/javaEE/" style="font-size: 10px;">javaEE</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mapreduce/" style="font-size: 13.75px;">mapreduce</a> <a href="/tags/me/" style="font-size: 10px;">me</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/node-js/" style="font-size: 10px;">node.js</a> <a href="/tags/others/" style="font-size: 11.25px;">others</a> <a href="/tags/psychology/" style="font-size: 11.25px;">psychology</a> <a href="/tags/publicity/" style="font-size: 10px;">publicity</a> <a href="/tags/selenium/" style="font-size: 10px;">selenium</a> <a href="/tags/translation/" style="font-size: 11.25px;">translation</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.ruanyifeng.com/home.html">阮一峰</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://es6.ruanyifeng.com/#README">ES6</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">MDN-JavaScript</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.uisdc.com/">优设网</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我叫常思源，毕业于北京邮电大学。专注前端开发事业。虽然在很多方面仍是小白，但我会不断努力哒~</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Eric Chang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/images/me.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Eric Chang</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">归档</a></li>
		        
					<li><a href="/tags/feeling">感悟</a></li>
		        
					<li><a href="/tags/me">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/changsiyuan" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/2803286360" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:changsiyuan2011@126.com" title="mail">mail</a>
			        
						<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/preview?locale=zh_CN&trk=prof-0-sb-preview-primary-button" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2016-3-30-Angularjs-source-code" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/30/2016-3-30-Angularjs-source-code/" class="article-date">
  	<time datetime="2016-03-29T16:00:00.000Z" itemprop="datePublished">2016-03-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/30/2016-3-30-Angularjs-source-code/">Angularjs 源码阅读体会</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="说明">说明</h3><ul>
<li>本文是我在阅读Angularjs源码时的一些体会，写出来分享给大家，不足之处请多多指正。</li>
<li>本文以angularjs 1.5.x版本源码为例；</li>
<li>本文参考：<a href="http://www.html-js.com/article/2364" target="_blank" rel="external">文章一</a>、<a href="http://angularjs.cn/A0AY" target="_blank" rel="external">系列分析文章</a></li>
</ul>
<h3 id="Angularjs在初始化的时候做了什么">Angularjs在初始化的时候做了什么</h3><h4 id="尝试绑定jQuery对象，如果没有则采用内置的jqLite(30561行)：">尝试绑定jQuery对象，如果没有则采用内置的jqLite(30561行)：</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//try to bind to jquery now so that one can write jqLite(document).ready()</span></span><br><span class="line"><span class="comment">//but we will rebind on bootstrap again.</span></span><br><span class="line"><span class="function">bindJQuery</span>();</span><br></pre></td></tr></table></figure>
<h4 id="publishExternalAPI初始化angular环境,这也是angularjs实现其重要特性–扩展指令、依赖注入的重要步骤："><code>publishExternalAPI</code>初始化angular环境,这也是angularjs实现其重要特性–扩展指令、依赖注入的重要步骤：</h4><ul>
<li>把一些基础api挂载到angular上(2455行)：</li>
</ul>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">extend(angular, &#123;</span><br><span class="line">    <span class="string">'bootstrap'</span>: bootstrap,</span><br><span class="line">    <span class="string">'copy'</span>: copy,</span><br><span class="line">    <span class="string">'extend'</span>: extend,</span><br><span class="line">    <span class="string">'merge'</span>: merge,</span><br><span class="line">    <span class="string">'equals'</span>: equals,</span><br><span class="line">    <span class="string">'element'</span>: jqLite,</span><br><span class="line">    <span class="string">'forEach'</span>: forEach,</span><br><span class="line">    <span class="string">'injector'</span>: createInjector,</span><br><span class="line">    <span class="string">'noop'</span>: noop,</span><br><span class="line">    <span class="string">'bind'</span>: bind,</span><br><span class="line">    <span class="string">'toJson'</span>: toJson,</span><br><span class="line">    <span class="string">'fromJson'</span>: fromJson,</span><br><span class="line">    <span class="string">'identity'</span>: identity,</span><br><span class="line">    <span class="string">'isUndefined'</span>: isUndefined,</span><br><span class="line">    <span class="string">'isDefined'</span>: isDefined,</span><br><span class="line">    <span class="string">'isString'</span>: <span class="built_in">isString</span>,</span><br><span class="line">    <span class="string">'isFunction'</span>: isFunction,</span><br><span class="line">    <span class="string">'isObject'</span>: isObject,</span><br><span class="line">    <span class="string">'isNumber'</span>: <span class="built_in">isNumber</span>,</span><br><span class="line">    <span class="string">'isElement'</span>: isElement,</span><br><span class="line">    <span class="string">'isArray'</span>: <span class="built_in">isArray</span>,</span><br><span class="line">    <span class="string">'version'</span>: version,</span><br><span class="line">    <span class="string">'isDate'</span>: isDate,</span><br><span class="line">    <span class="string">'lowercase'</span>: lowercase,</span><br><span class="line">    <span class="string">'uppercase'</span>: uppercase,</span><br><span class="line">    <span class="string">'callbacks'</span>: &#123;counter: <span class="number">0</span>&#125;,</span><br><span class="line">    <span class="string">'getTestability'</span>: getTestability,</span><br><span class="line">    <span class="string">'$$minErr'</span>: minErr,</span><br><span class="line">    <span class="string">'$$csp'</span>: csp,</span><br><span class="line">    <span class="string">'reloadWithDebugInfo'</span>: reloadWithDebugInfo</span><br><span class="line">  &#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在angular上添加了module方法（2488行）：<ul>
<li>在window下面创建全局的angular对象,并且返回一个高阶函数，赋值给了angular.module属性；</li>
<li><code>setupModuleLoader</code>返回的内容中包含了<code>provider</code>、<code>factory</code>、<code>service</code>、<code>value</code>、<code>constant</code>、<code>controller</code>、<code>directive</code>等诸多对象，方便用angular.module链式调用这些对象；</li>
</ul>
</li>
</ul>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angularModule = setupModuleLoader<span class="list">(<span class="keyword">window</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//链式调用</span></span><br><span class="line">angular.module(<span class="emphasis">'demoApp'</span>, [])</span><br><span class="line"><span class="title">.factory()</span></span><br><span class="line"><span class="title">.controller()</span></span><br><span class="line"><span class="title">.directive()</span></span><br><span class="line"><span class="title">.config()</span></span><br><span class="line"><span class="title">.run();</span></span><br></pre></td></tr></table></figure>
<h4 id="当dom_ready时，开始执行程序的初始化">当dom ready时，开始执行程序的初始化</h4><ul>
<li>执行初始化的代码（30708行）：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jqLite(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    angularInit(<span class="built_in">document</span>, bootstrap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>angularInit函数(1591行):<ul>
<li>获取<code>ng-app</code>的应用根节点（含有<code>xx-app</code>属性的dom）；</li>
<li>获取启动模块（<code>xx-app</code>的值xx为 [‘ng-‘, ‘data-ng-‘, ‘ng:’, ‘x-ng-‘] 任一一种;</li>
<li>将上述结果传给bootstrap函数：<code>bootstrap(appElement, module ? [module] : [], config);</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The element `element` has priority over any other element</span></span><br><span class="line">forEach(ngAttrPrefixes, <span class="function"><span class="keyword">function</span>(<span class="params">prefix</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = prefix + <span class="string">'app'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!appElement &amp;&amp; element.hasAttribute &amp;&amp; element.hasAttribute(name)) &#123;</span><br><span class="line">    appElement = element;</span><br><span class="line">    <span class="built_in">module</span> = element.getAttribute(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">forEach(ngAttrPrefixes, <span class="function"><span class="keyword">function</span>(<span class="params">prefix</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = prefix + <span class="string">'app'</span>;</span><br><span class="line">  <span class="keyword">var</span> candidate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!appElement &amp;&amp; (candidate = element.querySelector(<span class="string">'['</span> + name.replace(<span class="string">':'</span>, <span class="string">'\\:'</span>) + <span class="string">']'</span>))) &#123;</span><br><span class="line">    appElement = candidate;</span><br><span class="line">    <span class="built_in">module</span> = candidate.getAttribute(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>boostrap函数（1679行）：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params">element, modules, config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...省略若干代码</span></span><br><span class="line">  <span class="keyword">var</span> doBootstrap = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    element = jqLite(element);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 首先判断该dom是否已经被注入（即这个dom已经被bootstrap过）</span></span><br><span class="line">    <span class="comment">// 注意这里的injector方法是Angular为jqLite中提供的，区别于一般的jQuery api</span></span><br><span class="line">    <span class="keyword">if</span> (element.injector()) &#123;</span><br><span class="line">      <span class="keyword">var</span> tag = (element[<span class="number">0</span>] === <span class="built_in">document</span>) ? <span class="string">'document'</span> : startingTag(element);</span><br><span class="line">      <span class="comment">//Encode angle brackets to prevent input from being sanitized to empty string #8683</span></span><br><span class="line">      <span class="keyword">throw</span> ngMinErr(</span><br><span class="line">          <span class="string">'btstrpd'</span>,</span><br><span class="line">          <span class="string">"App Already Bootstrapped with this Element '&#123;0&#125;'"</span>,</span><br><span class="line">          tag.replace(<span class="regexp">/&lt;/</span>,<span class="string">'&lt;'</span>).replace(<span class="regexp">/&gt;/</span>,<span class="string">'&gt;'</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modules = modules || [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加匿名模块</span></span><br><span class="line">    modules.unshift([<span class="string">'$provide'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$provide</span>) </span>&#123;</span><br><span class="line">      $provide.value(<span class="string">'$rootElement'</span>, element);</span><br><span class="line">    &#125;]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (config.debugInfoEnabled) &#123;</span><br><span class="line">      <span class="comment">// Pushing so that this overrides `debugInfoEnabled` setting defined in user's `modules`.</span></span><br><span class="line">      modules.push([<span class="string">'$compileProvider'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$compileProvider</span>) </span>&#123;</span><br><span class="line">        $compileProvider.debugInfoEnabled(<span class="literal">true</span>);</span><br><span class="line">      &#125;]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加ng模块</span></span><br><span class="line">    modules.unshift(<span class="string">'ng'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 到这里modules可能是: ['ng', [$provide, function($provide)&#123;...&#125;], 'xx']</span></span><br><span class="line">    <span class="comment">// xx: ng-app="xx" </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建injector对象，注册所有的内置模块</span></span><br><span class="line">    <span class="keyword">var</span> injector = createInjector(modules, config.strictDi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 利用injector的依赖注入，执行回调</span></span><br><span class="line">    injector.invoke([<span class="string">'$rootScope'</span>, <span class="string">'$rootElement'</span>, <span class="string">'$compile'</span>, <span class="string">'$injector'</span>,</span><br><span class="line">       <span class="function"><span class="keyword">function</span> <span class="title">bootstrapApply</span>(<span class="params">scope, element, compile, injector</span>) </span>&#123;</span><br><span class="line">        scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 标记该dom已经被注入</span></span><br><span class="line">          element.data(<span class="string">'$injector'</span>, injector);</span><br><span class="line">          <span class="comment">// 编译整个dom</span></span><br><span class="line">          compile(element)(scope);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> injector;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...省略若干代码</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span> &amp;&amp; !NG_DEFER_BOOTSTRAP.test(<span class="built_in">window</span>.name)) &#123;</span><br><span class="line">    <span class="keyword">return</span> doBootstrap();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...省略若干代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>除了系统会自动调用bootsrap函数，也可以自己手动调用：</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'demo'</span>, [])</span><br><span class="line">    .controller(<span class="string">'WelcomeController'</span>, <span class="keyword">function</span>(<span class="variable">$scope</span>) &#123;</span><br><span class="line">         <span class="variable">$scope</span>.greeting = <span class="string">'Welcome!'</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">angular.bootstrap(document, [<span class="string">'demo'</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="$get的分析"><code>$get</code>的分析</h3><ul>
<li><code>$get</code>见源码16163行；</li>
<li>构造函数如下：</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Scope() &#123;</span><br><span class="line">      this.<span class="variable">$id</span> = nextUid();</span><br><span class="line">      this.$<span class="variable">$phase</span> = this.<span class="variable">$parent</span> = this.$<span class="variable">$watchers</span> =</span><br><span class="line">                     this.$<span class="variable">$nextSibling</span> = this.$<span class="variable">$prevSibling</span> =</span><br><span class="line">                     this.$<span class="variable">$childHead</span> = this.$<span class="variable">$childTail</span> = null;</span><br><span class="line">      this.<span class="variable">$root</span> = this;</span><br><span class="line">      this.$<span class="variable">$destroyed</span> = false;</span><br><span class="line">      this.$<span class="variable">$listeners</span> = &#123;&#125;;</span><br><span class="line">      this.$<span class="variable">$listenerCount</span> = &#123;&#125;;</span><br><span class="line">      this.$<span class="variable">$watchersCount</span> = <span class="number">0</span>;</span><br><span class="line">      this.$<span class="variable">$isolateBindings</span> = null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>含义：</p>
<ul>
<li>$id, 通过nextUid方法来生成一个唯一的标识</li>
<li>$$phase, 这是一个状态标识,一般在dirty check时用到，表明现在在哪个阶段</li>
<li>$parent, 代表自己的上级scope属性</li>
<li>$$watchers, 保存scope变量当前所有的监控数据,是一个数组</li>
<li>$$nextSibling, 下一个兄弟scope属性</li>
<li>$$prevSibling, 前一个兄弟scope属性</li>
<li>$$childHead, 第一个子级scope属性</li>
<li>$$childTail, 最后一个子级scope属性</li>
<li>$$destroyed, 表示是否被销毁</li>
<li>$$asyncQueue, 代表异步操作的数组</li>
<li>$$postDigestQueue, 代表一个在dirty check之后执行的数组</li>
<li>$$listeners, 代表scope变量当前所有的监听数据,是一个数组</li>
</ul>
</li>
<li><p>创建子级作用域是通过<code>$new</code>方法：</p>
</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$new</span>: <span class="keyword">function</span>(isolate, parent) &#123;</span><br><span class="line">        var child;</span><br><span class="line"></span><br><span class="line">        parent = parent || this;</span><br><span class="line"></span><br><span class="line">        if (isolate) &#123;</span><br><span class="line">          child = new Scope();</span><br><span class="line">          child.<span class="variable">$root</span> = this.<span class="variable">$root</span>;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // Only create a child scope class if somebody asks for one,</span><br><span class="line">          // but cache it to allow the VM to optimize lookups.</span><br><span class="line">          if (!this.$<span class="variable">$ChildScope</span>) &#123;</span><br><span class="line">            this.$<span class="variable">$ChildScope</span> = createChildScopeClass(this);</span><br><span class="line">          &#125;</span><br><span class="line">          child = new this.$<span class="variable">$ChildScope</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        child.<span class="variable">$parent</span> = parent;</span><br><span class="line">        child.$<span class="variable">$prevSibling</span> = parent.$<span class="variable">$childTail</span>;</span><br><span class="line">        if (parent.$<span class="variable">$childHead</span>) &#123;</span><br><span class="line">          parent.$<span class="variable">$childTail</span>.$<span class="variable">$nextSibling</span> = child;</span><br><span class="line">          parent.$<span class="variable">$childTail</span> = child;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          parent.$<span class="variable">$childHead</span> = parent.$<span class="variable">$childTail</span> = child;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // When the new scope is not isolated or we inherit from `this`, and</span><br><span class="line">        // the parent scope is destroyed, the property `$<span class="variable">$destroyed</span>` is inherited</span><br><span class="line">        // prototypically. In all other cases, this property needs to be set</span><br><span class="line">        // when the parent scope is destroyed.</span><br><span class="line">        // The listener needs to be added after the parent is set</span><br><span class="line">        if (isolate || parent != this) child.<span class="variable">$on</span>(<span class="string">'$destroy'</span>, destroyChildScope);</span><br><span class="line"></span><br><span class="line">        return child;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>分析：<ul>
<li>isolate标识来创建独立作用域,这个在创建指令，并且scope属性定义的情况下，会触发这种情况，还有几种别的特殊情况,假如是独立作用域的话，会多一个$root属性,这个默认是指向rootscope的；</li>
<li>如果不是独立的作用域,则会生成一个内部的构造函数,把此构造函数的prototype指向当前scope实例；</li>
<li>通用的操作就是,设置当前作用域的<code>$$childTail</code>,<code>$$childTail.$$nextSibling</code>,<code>$$childHead</code>,<code>this.$$childTail</code>为生成的子级作用域;设置子级域的<code>$parent</code>为当前作用域,<code>$$prevSibling</code>为当前作用域最后一个子级作用域；</li>
</ul>
</li>
</ul>
<h3 id="$watch的分析"><code>$watch</code>的分析</h3><ul>
<li><code>$watch</code>在16452行，具体如下：</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$watch</span>: <span class="keyword">function</span>(watchExp, listener, objectEquality, prettyPrintExpression) &#123;</span><br><span class="line">        var get = <span class="variable">$parse</span>(watchExp);</span><br><span class="line"></span><br><span class="line">        if (get.$<span class="variable">$watchDelegate</span>) &#123;</span><br><span class="line">          return get.$<span class="variable">$watchDelegate</span>(this, listener, objectEquality, get, watchExp);</span><br><span class="line">        &#125;</span><br><span class="line">        var scope = this,</span><br><span class="line">            array = scope.$<span class="variable">$watchers</span>,</span><br><span class="line">            watcher = &#123;</span><br><span class="line">              fn: listener,</span><br><span class="line">              last: initWatchVal,</span><br><span class="line">              get: get,</span><br><span class="line">              exp: prettyPrintExpression || watchExp,</span><br><span class="line">              eq: !!objectEquality</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        lastDirtyWatch = null;</span><br><span class="line"></span><br><span class="line">        if (!isFunction(listener)) &#123;</span><br><span class="line">          watcher.fn = noop;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!array) &#123;</span><br><span class="line">          array = scope.$<span class="variable">$watchers</span> = [];</span><br><span class="line">        &#125;</span><br><span class="line">        // we use unshift since we use a while loop in <span class="variable">$digest</span> for speed.</span><br><span class="line">        // the while loop reads in reverse order.</span><br><span class="line">        array.unshift(watcher);</span><br><span class="line">        incrementWatchersCount(this, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        return function deregisterWatch() &#123;</span><br><span class="line">          if (arrayRemove(array, watcher) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            incrementWatchersCount(scope, -<span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          lastDirtyWatch = null;</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>对象含义：</p>
<ul>
<li>fn, 代表监听函数,当监控表达式新旧不相等时会执行此函数</li>
<li>last, 保存最后一次发生变化的监控表达式的值</li>
<li>get, 保存一个监控表达式对应的函数,目的是用来获取表达式的值然后用来进行新旧对比的</li>
<li>exp, 保存一个原始的监控表达式</li>
<li>eq, 保存$watch函数的第三个参数，表示是否进行深度比较</li>
</ul>
</li>
<li><p>检查传递进来的监听参数是否为函数,如果是一个有效的字符串，则通过parse来解析生成一个函数,否则赋值为一个noop占位函数,最后生成一个包装函数，函数体的内容就是执行刚才生成的监听函数,默认传递当前作用域.</p>
</li>
<li>检查监控表达式是否为字符串并且执行表达式的constant为true,代表这个字符串是一个常量,那么，系统在处理这种监听的时候，执行完一次监听函数之后就会删除这个<code>$watch</code>.最后往当前作用域里的<code>$$watchers</code>数组头中添加<code>$watch</code>信息,注意这里的返回值,利用JS的闭包保留了当前的watcher，然后返回一个函数，这个就是用来删除监听用的.</li>
</ul>
<h3 id="$digest分析"><code>$digest</code>分析</h3><ul>
<li>见源码16812行；</li>
<li>digest方法是dirty check的核心,主要思路是先执行<code>$$asyncQueue</code>队列中的表达式,然后开启一个loop来的执行所有的watch里的监听函数,前提是前后两次的值是否不相等,假如ttl超过系统默认值，则dirth check结束,最后执行<code>$$postDigestQueue</code>队列里的表达式.</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$digest</span>: <span class="keyword">function</span>() &#123;</span><br><span class="line">        var watch, value, last, fn, get,</span><br><span class="line">            watchers,</span><br><span class="line">            length,</span><br><span class="line">            dirty, ttl = TTL,</span><br><span class="line">            next, current, target = this,</span><br><span class="line">            watchLog = [],</span><br><span class="line">            logIdx, asyncTask;</span><br><span class="line"></span><br><span class="line">        beginPhase(<span class="string">'$digest'</span>);</span><br><span class="line">        // Check for changes to browser url that happened in sync before the call to <span class="variable">$digest</span></span><br><span class="line">        <span class="variable">$browser</span>.$<span class="variable">$checkUrlChange</span>();</span><br><span class="line"></span><br><span class="line">        if (this === <span class="variable">$rootScope</span> &amp;&amp; applyAsyncId !== null) &#123;</span><br><span class="line">          // If this is the root scope, and <span class="variable">$applyAsync</span> has scheduled a deferred <span class="variable">$apply</span>(), then</span><br><span class="line">          // cancel the scheduled <span class="variable">$apply</span> and flush the queue of expressions to be evaluated.</span><br><span class="line">          <span class="variable">$browser</span>.defer.cancel(applyAsyncId);</span><br><span class="line">          flushApplyAsync();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lastDirtyWatch = null;</span><br><span class="line"></span><br><span class="line">        do &#123; // <span class="string">"while dirty"</span> loop</span><br><span class="line">          dirty = false;</span><br><span class="line">          current = target;</span><br><span class="line"></span><br><span class="line">          while (asyncQueue.length) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">              asyncTask = asyncQueue.shift();</span><br><span class="line">              asyncTask.scope.<span class="variable">$eval</span>(asyncTask.expression, asyncTask.locals);</span><br><span class="line">            &#125; catch (e) &#123;</span><br><span class="line">              <span class="variable">$exceptionHandler</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">            lastDirtyWatch = null;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          traverseScopesLoop:</span><br><span class="line">          do &#123; // <span class="string">"traverse the scopes"</span> loop</span><br><span class="line">            if ((watchers = current.$<span class="variable">$watchers</span>)) &#123;</span><br><span class="line">              // process our watches</span><br><span class="line">              length = watchers.length;</span><br><span class="line">              while (length--) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                  watch = watchers[length];</span><br><span class="line">                  // Most common watches are on primitives, in which case we can short</span><br><span class="line">                  // circuit it with === operator, only when === fails do we use .equals</span><br><span class="line">                  if (watch) &#123;</span><br><span class="line">                    get = watch.get;</span><br><span class="line">                    if ((value = get(current)) !== (last = watch.last) &amp;&amp;</span><br><span class="line">                        !(watch.eq</span><br><span class="line">                            ? equals(value, last)</span><br><span class="line">                            : (typeof value === <span class="string">'number'</span> &amp;&amp; typeof last === <span class="string">'number'</span></span><br><span class="line">                               &amp;&amp; isNaN(value) &amp;&amp; isNaN(last)))) &#123;</span><br><span class="line">                      dirty = true;</span><br><span class="line">                      lastDirtyWatch = watch;</span><br><span class="line">                      watch.last = watch.eq ? copy(value, null) : value;</span><br><span class="line">                      fn = watch.fn;</span><br><span class="line">                      fn(value, ((last === initWatchVal) ? value : last), current);</span><br><span class="line">                      if (ttl &lt; <span class="number">5</span>) &#123;</span><br><span class="line">                        logIdx = <span class="number">4</span> - ttl;</span><br><span class="line">                        if (!watchLog[logIdx]) watchLog[logIdx] = [];</span><br><span class="line">                        watchLog[logIdx].push(&#123;</span><br><span class="line">                          msg: isFunction(watch.exp) ? <span class="string">'fn: '</span> + (watch.exp.name || watch.exp.toString()) : watch.exp,</span><br><span class="line">                          newVal: value,</span><br><span class="line">                          oldVal: last</span><br><span class="line">                        &#125;);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125; else if (watch === lastDirtyWatch) &#123;</span><br><span class="line">                      // If the most recently dirty watcher is now clean, short circuit since the remaining watchers</span><br><span class="line">                      // have already been tested.</span><br><span class="line">                      dirty = false;</span><br><span class="line">                      break traverseScopesLoop;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125; catch (e) &#123;</span><br><span class="line">                  <span class="variable">$exceptionHandler</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Insanity Warning: scope depth-first traversal</span><br><span class="line">            // yes, this code is a bit crazy, but it works and we have tests to prove it!</span><br><span class="line">            // this piece should be kept in sync with the traversal in <span class="variable">$broadcast</span></span><br><span class="line">            if (!(next = ((current.$<span class="variable">$watchersCount</span> &amp;&amp; current.$<span class="variable">$childHead</span>) ||</span><br><span class="line">                (current !== target &amp;&amp; current.$<span class="variable">$nextSibling</span>)))) &#123;</span><br><span class="line">              while (current !== target &amp;&amp; !(next = current.$<span class="variable">$nextSibling</span>)) &#123;</span><br><span class="line">                current = current.<span class="variable">$parent</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; while ((current = next));</span><br><span class="line"></span><br><span class="line">          // `break traverseScopesLoop;` takes us to here</span><br><span class="line"></span><br><span class="line">          if ((dirty || asyncQueue.length) &amp;&amp; !(ttl--)) &#123;</span><br><span class="line">            clearPhase();</span><br><span class="line">            throw <span class="variable">$rootScopeMinErr</span>(<span class="string">'infdig'</span>,</span><br><span class="line">                <span class="string">'&#123;0&#125; $digest() iterations reached. Aborting!\n'</span> +</span><br><span class="line">                <span class="string">'Watchers fired in the last 5 iterations: &#123;1&#125;'</span>,</span><br><span class="line">                TTL, watchLog);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; while (dirty || asyncQueue.length);</span><br><span class="line"></span><br><span class="line">        clearPhase();</span><br><span class="line"></span><br><span class="line">        while (postDigestQueue.length) &#123;</span><br><span class="line">          try &#123;</span><br><span class="line">            postDigestQueue.shift()();</span><br><span class="line">          &#125; catch (e) &#123;</span><br><span class="line">            <span class="variable">$exceptionHandler</span>(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>核心就是两个loop，外loop保证所有的model都能检测到,内loop则是真实的检测每个watch,watch.get就是计算监控表达式的值,这个用来跟旧值进行对比,假如不相等，则执行监听函数；</li>
<li>比较完之后,把新值传给watch.last,然后执行watch.fn也就是监听函数,传递三个参数,分别是:最新计算的值,上次计算的值(假如是第一次的话,则传递新值),最后一个参数是当前作用域实例,这里有一个设置外loop的条件值，那就是dirty = true,也就是说只要内loop执行了一次watch,则外loop还要接着执行，这是为了保证所有的model都能监测一次，虽然这个有点浪费性能,不过超过ttl设置的值后,dirty check会强制关闭，并抛出异常；</li>
<li>当检查完一个作用域内的所有watch之后，则开始深度遍历当前作用域的子级或者父级,虽然这有些影响性能，就像这里的注释写的那样yes, <code>this code is a bit crazy</code></li>
</ul>
<h3 id="$apply分析"><code>$apply</code>分析</h3><ul>
<li>见源码17121行；</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$apply</span>: <span class="keyword">function</span>(expr) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">          beginPhase(<span class="string">'$apply'</span>);</span><br><span class="line">          try &#123;</span><br><span class="line">            return this.<span class="variable">$eval</span>(expr);</span><br><span class="line">          &#125; finally &#123;</span><br><span class="line">            clearPhase();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">          <span class="variable">$exceptionHandler</span>(e);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">          try &#123;</span><br><span class="line">            <span class="variable">$rootScope</span>.<span class="variable">$digest</span>();</span><br><span class="line">          &#125; catch (e) &#123;</span><br><span class="line">            <span class="variable">$exceptionHandler</span>(e);</span><br><span class="line">            throw e;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这个方法一般用在，不在ng的上下文中执行js代码的情况,比如原生的DOM事件中执行想改变ng中某些model的值,这个时候就要使用<code>$apply</code>方法了;</li>
<li>代码中，首先让当前阶段标识为<code>$apply</code>,这个可以防止使用<code>$apply</code>方法时检查是否已经在这个阶段了,然后就是执行<code>$eval</code>方法, 这个方法上面有讲到,最后执行<code>$digest</code>方法,来使ng中的M或者VM改变.</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angularjs/">Angularjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2016-3-10-jQuery3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/2016-3-10-jQuery3/" class="article-date">
  	<time datetime="2016-03-09T16:00:00.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/10/2016-3-10-jQuery3/">jQuery3新特性</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="说明">说明</h3><ul>
<li>本文为翻译文章，原文<a href="http://developer.telerik.com/featured/whats-new-in-jquery-3/?utm_source=javascriptweekly&amp;utm_medium=email" target="_blank" rel="external">在这里</a></li>
<li>本文作者：Aurelio De Rosa</li>
<li>本文总结了jQuery3新特性，作为jQuery开发者的参考</li>
</ul>
<h3 id="引言">引言</h3><ul>
<li>jQuery影响网页开发已经有十年的时间，它一路走来源于它的诸多优势。 jQuery为用户提供了一个易于使用的与DOM交互方式，比如：执行Ajax请求，创建动画，等等。此外，不同于纯DOM的API，jQuery实现了复合模式。正因为如此，你在不用知道元素数量的前提下，可以方便调用一个jQuery集合或是一个jQuery方法。</li>
<li>在未来的几个星期，一个重要的时间节点将要到来，jQuery将发布版本3，其中修复了很多的bug，增加了新的方法，弃用并删除了一些功能，改变了一些功能的行为。在这篇文章中，我将讲解jQuery3引入的最重要的变化。</li>
</ul>
<h3 id="新特性">新特性</h3><blockquote>
<ul>
<li>在下面的章节，我将讨论jQuery3中添加的最重要的特性。</li>
</ul>
</blockquote>
<h4 id="FOR…OF_LOOP">FOR…OF LOOP</h4><ul>
<li>jQuery3将提供for…of 循环来遍历一个jQuery集合的DOM元素。这种新的迭代器是ECMAScript 2015（又名的ECMAScript6）规范的一部分。它可以让你方便的迭代对象（包括阵列，地图，设置，等等）。</li>
<li>当使用这种新的迭代方式的时候，您会收到一个不是jQuery的集合，从中仅可以在同一时间访问一个DOM元素。这个迭代器将使你可以在一个jQuery集合执行操作的方式略有提升。</li>
<li>为了理解这个迭代器是如何工作的，我们举个例子。比如你想分配一个ID给页面的每个输入元素。 jQuery的3之前你可以这样写：</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var <span class="variable">$inputs</span> = $(<span class="string">'input'</span>);</span><br><span class="line"><span class="keyword">for</span>(var i = <span class="number">0</span>; i &lt; <span class="variable">$inputs</span>.length; i++) &#123;</span><br><span class="line">   <span class="variable">$inputs</span>[i].id = <span class="string">'input-'</span> + i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在jQuery3中可以这样写：</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var <span class="variable">$inputs</span> = $(<span class="string">'input'</span>);var i = <span class="number">0</span>; </span><br><span class="line"><span class="keyword">for</span>(var input <span class="keyword">of</span> <span class="variable">$inputs</span>) &#123;</span><br><span class="line">  input.id = <span class="string">'input-'</span> + i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="$-GET()_AND_$-POST()的新属性"><code>$.GET()</code> AND <code>$.POST()</code>的新属性</h4><ul>
<li>jQuery3增加了<code>$.get()</code>和<code>$.post()</code>的新属性，他们是ajax的具体实现。添加新的属性是：</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="function"><span class="title">get</span><span class="params">([settings])</span></span></span><br><span class="line">$.<span class="function"><span class="title">post</span><span class="params">([settings])</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>setting是一个对象，可以拥有许多属性。你可以给$.ajax()提供相同的对象。要了解更多内容，请参阅<a href="http://api.jquery.com/jquery.ajax/#jQuery-ajax-settings" target="_blank" rel="external">$.ajax()</a>。</li>
<li>在给<code>$.get()</code>、<code>$.post()</code>传送对象和给<code>$.ajax()</code>传送对象的最大的区别是方法的属性始终被忽略掉。产生这种情况的原因是<code>$.get()</code>、<code>$.post()</code>对象有一个预设的HTTP方法来执行Ajax请求（GET方法对应<code>$.get()</code>、POST方法对应<code>$.post()</code>）。最基本的一个原则是，你不能尝试通过<code>$.get()</code>去发送POST请求。</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.get(&#123;</span><br><span class="line">   url: 'https://www.audero.it',</span><br><span class="line">   <span class="keyword">method</span>: '<span class="type">POST</span>' // <span class="type">This</span> property <span class="keyword">is</span> ignored</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>尽管显式设置了请求的方法为POST，这段代码仍将发出GET而非POST请求。</li>
</ul>
<h4 id="使用REQUESTANIMATIONFRAME()播放动画">使用REQUESTANIMATIONFRAME()播放动画</h4><ul>
<li>所有现代浏览器，包括Internet Explorer10及以上，都支持requestAnimationFrame。在实际操作中，jQuery3播放动画时，使用这个API将使得动画的播放更加平滑，而且消耗更少的CPU资源。</li>
</ul>
<h4 id="UNWRAP()">UNWRAP()</h4><ul>
<li>jQuery3对于unwrap()函数增加了一个可选的选择参数。该方法现在可以这么使用：</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">unwrap</span><span class="params">([selector])</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>由于这种变化，你可以在unwrap函数中添加选择器。如果选择器存在匹配的DOM对象，则匹配的子元素是展开；否则，不进行操作。</li>
</ul>
<h3 id="未来的变化">未来的变化</h3><blockquote>
<ul>
<li>jQuery3还修改了它的一些功能的行为。</li>
</ul>
</blockquote>
<h4 id="VISIBLE_和_:HIDDEN">VISIBLE 和 :HIDDEN</h4><ul>
<li>新版的jQuery更改了:visible 和:hidden的含义，如果元素存在盒模型（包括那些宽度和高度为零的盒模型），这样的元素将被认为是:visible的。例如，<br>元素和一些没有内容的行内元素在jQuery3中就会被:visible选择器选中。所以，如果您页面上结构如下：</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;div&gt;</span><span class="tag">&lt;/div&gt;</span></span><br><span class="line"><span class="tag">&lt;br /&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>而且您写了如下的代码：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log($(<span class="string">'body :visible'</span>).length);</span><br></pre></td></tr></table></figure>
<ul>
<li>在jQuery1和jQuery2中，您将获取0，在jQuery3中，您将获得2.</li>
</ul>
<h4 id="DATA()">DATA()</h4><ul>
<li>另一个重要变化是关于data()方法的。它已被更改为符合 Dataset API specifications的方法。 jQuery3将所有属性的key值变更为camel case。要理解这种变化，请考虑以下代码：</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="property">id</span>=<span class="string">"container"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果您使用的是jQuery3之前的版本，你可以这么写：</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var <span class="variable">$elem</span> = $(<span class="string">'#container'</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$elem</span>.data(&#123;</span><br><span class="line">   <span class="string">'my-property'</span>: <span class="string">'hello'</span>&#125;);</span><br><span class="line"></span><br><span class="line">console.log(<span class="variable">$elem</span>.data());</span><br></pre></td></tr></table></figure>
<ul>
<li>在控制台你将得到如下输出：</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;<span class="rule"><span class="attribute">my-property</span>:<span class="value"> <span class="string">"hello"</span></span></span></span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>但是如果您使用jQuery3，将得到：</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;<span class="rule"><span class="attribute">myProperty</span>:<span class="value"> <span class="string">"hello"</span></span></span></span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意，jQuery3属性的名称是camel case的，没有“-”符号，而以前的版本则有。</li>
</ul>
<h4 id="THE_DEFERRED_OBJECT">THE DEFERRED OBJECT</h4><ul>
<li>jQuery3改变了递延对象的行为，是Promise对象的先驱，以提高其与promise/ A+对象的兼容性。这个对象和它的历史是很有趣的。为了更多地了解它，你可以阅读<a href="https://api.jquery.com/category/deferred-object/" target="_blank" rel="external">官方文档</a>或阅读<a href="https://www.manning.com/books/jquery-in-action-third-edition" target="_blank" rel="external">我的书</a>,涵盖jQuery3的知识点。</li>
<li>在jQuery1.x和2.x中，回调函数中的未捕获异常被传递给一个异常中止程序的执行。不同于原生的Promise 对象，它会一层一层抛出异常，直到它达到window.onerror对象。如果你还没有为此函数定义事件（这是一种罕见的情况），异常消息会显示出来，程序流被终止。</li>
<li>jQuery3遵循和原生的Promise对象相同的模式。因此，引发的异常被转换成一个rejection 对象并且执行失败情况下的回调函数。一旦完成，该过程继续，并且随后执行成功情况下的回调函数。</li>
<li>为了帮助您了解这种差异，让我们看一个小例子。考虑下面的代码：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deferred = $.Deferred();</span><br><span class="line"></span><br><span class="line">deferred</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'An error'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Success 1'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Failure 1'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Success 2'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Failure 2'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">deferred.resolve();</span><br></pre></td></tr></table></figure>
<ul>
<li>在jQuery1和jQuery2中，只有第一个函数（抛出异常的那个函数）被执行。另外，因为我们没有定义任何window.onerror的处理函数，控制台消息将输出“Uncaught Error: An error”，程序执行将中止。</li>
<li>在jQuery3中，程序的行为是完全不同的。你会看到控制台消息显示“Failure 1”和“Success 2”。该异常由第一个失败处理函数来处理，一旦它已经被处理，接下来成功的函数可以被执行。</li>
</ul>
<h4 id="SVG_文件">SVG 文件</h4><ul>
<li>没有jQuery版本，包括jQuery3，正式支持SVG文件。然而事实是，许多方法都可以工作，比如那些操纵类名称的函数，已在jQuery3中被更新。因此，在这个即将到来的jQuery版本，你就可以使用SVG文档的方法，如addClass()和hasClass()方法。</li>
</ul>
<h3 id="方法和属性已过时或删除">方法和属性已过时或删除</h3><blockquote>
<ul>
<li>到目前我们介绍了jQuery3新增的功能，同时它也移除和弃用的几个功能。</li>
</ul>
</blockquote>
<ul>
<li><p>弃用 BIND(), UNBIND(), DELEGATE() UNDELEGATE()方法</p>
<ul>
<li>on()方法以前曾经介绍过，是用来为提供一个统一的接口来代替jQuery的bind()、delegate()和 live()方法。同时，jQuery建议用off()提供的统一的接口来代替unbind(),undelegated()和die()方法。</li>
<li>jQuery3弃用了所有的这些方法，将来的版本也不会重新使用。请在你的项目中专注于使用on() 和off()。</li>
</ul>
</li>
<li><p>弃用LOAD(), UNLOAD() 和 ERROR()方法</p>
<ul>
<li>jQuery3弃用了LOAD(), UNLOAD() 和 ERROR()方法。这些方法其实早在jQuery1.8中就被弃用了，但并未被绝对禁止使用。如果你正在使用依赖于一个或一个以上的这些方法，升级到jQuery3则会破坏你的代码的可用性。因此，在决定升级前要注意。</li>
</ul>
</li>
<li><p>弃用CONTEXT, SUPPORT 和 SELECTOR属性</p>
<ul>
<li>jQuery3 弃用了context, support和 selector属性。正如我在上一节中提到的，如果你还在项目中使用它们，升级到jQuery3会破坏你的代码的可用性。</li>
</ul>
</li>
<li><p>Bug的修正</p>
<ul>
<li>jQuery3修复了以前版本中的一些重要的错误。在下面的部分，我将重点讲解两方面，这将使您的工作方式的巨大变化。</li>
</ul>
</li>
<li><p>对于 width() 和height()函数不会有更多的四舍五入</p>
<ul>
<li>jQuery3修复了包括width()和height()等相关函数的bug。这些方法将不再舍入到最近的像素，这使得它在某些情况下难以定位。</li>
<li>要理解这个问题，举例来说，你有一个有100像素宽的容器元素，分成三等份，每一份为宽度为整体的三分之一（即33.333333％）,在jQuery历史版本中，如果你要按照下面的代码获取每一份的宽度,你将会得到四舍五入后的宽度33像素。jQuery3中修复了这个bug，你将会得到一个浮点数。</li>
</ul>
</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">div</span> <span class="type">class</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">   &lt;<span class="keyword">div</span>&gt;My <span class="property">name</span>&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">   &lt;<span class="keyword">div</span>&gt;<span class="keyword">is</span>&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">   &lt;<span class="keyword">div</span>&gt;Aurelio De Rosa&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(</span><span class="string">'.container div'</span>).width();</span><br></pre></td></tr></table></figure>
<ul>
<li>WRAPALL()函数<ul>
<li>jQuery的新版本修复了一个wrapAll()方法的错误。在jQuery3之前的版本中，当向wrapAll()传递函数时，它独立包装jQuery的集合中的元素。换句话说，它的行为和向wrap()传递函数作用相同。</li>
<li>为了解决这个问题，因为函数被在jQuery3中仅仅被调用了1次，它没有通过jQuery的集合传递元素的索引。最后，函数上下文（this对象）将引用jQuery集合中的第一个元素。</li>
</ul>
</li>
</ul>
<h3 id="下载jQuery3测试版本1">下载jQuery3测试版本1</h3><ul>
<li><p>可通过如下URL下载</p>
<blockquote>
<ul>
<li>非压缩版本: <a href="https://code.jquery.com/jquery-3.0.0-beta1.js" target="_blank" rel="external">https://code.jquery.com/jquery-3.0.0-beta1.js</a></li>
<li>压缩版本: <a href="https://code.jquery.com/jquery-3.0.0-beta1.min.js" target="_blank" rel="external">https://code.jquery.com/jquery-3.0.0-beta1.min.js</a></li>
</ul>
</blockquote>
</li>
<li><p>也可用npm下载：</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery@<span class="number">3.0</span><span class="number">.0</span>-beta1</span><br></pre></td></tr></table></figure>
<h3 id="结论">结论</h3><ul>
<li>很多人说，jQuery已死，现代Web开发不会用到jQuery了。然而，它的发展仍在继续，但其78.5％的使用率的统计结果违背了这些说法。</li>
<li>在这篇文章中，我已经带您领略了jQuery3的新特性。正如您可能已经注意到，这个版本不会打破任何现有的项目，因为它不会引入许多重大更改。尽管如此，有一些更改在升级前需要牢记。第三方的依赖升级前，该项目的审查会帮助你发现任何异常行为或损坏的功能。</li>
</ul>
<h3 id="再次声明">再次声明</h3><ul>
<li>本文是<a href="http://developer.telerik.com/featured/whats-new-in-jquery-3/?utm_source=javascriptweekly&amp;utm_medium=email" target="_blank" rel="external">这篇文章</a>的翻译，作者是Aurelio De Rosa，译者是饮水思源。</li>
<li>非常感谢作者分享jQuery3新特性，让我们对jQuery有了全新的认识和体验。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/translation/">translation</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/translation/">translation</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2016-3-9-sudoku" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/09/2016-3-9-sudoku/" class="article-date">
  	<time datetime="2016-03-08T16:00:00.000Z" itemprop="datePublished">2016-03-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/09/2016-3-9-sudoku/">九宫格样式的实现</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="九宫格样式">九宫格样式</h3><ul>
<li>页面显示九宫格，鼠标放在哪一个格子上，相应的格子的外边框变色；</li>
<li>具体效果如下：</li>
</ul>
<p><img src="/images/sudoku/sudoku.png" alt="suduku"></p>
<ul>
<li>下面先贴出代码：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line">		<span class="id">#outer</span>&gt;<span class="tag">div</span><span class="rules">&#123;</span><br><span class="line">			<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">float</span>:<span class="value"> left</span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">border</span>:<span class="value"><span class="number">5px</span> solid blue</span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">		&#125;</span></span><br><span class="line"></span><br><span class="line">		<span class="id">#outer</span>&gt;<span class="tag">div</span><span class="pseudo">:hover</span><span class="rules">&#123;</span><br><span class="line">			<span class="rule"><span class="attribute">border</span>:<span class="value"><span class="number">5px</span> solid red</span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">z-index</span>:<span class="value"><span class="number">999</span></span></span>;</span><br><span class="line">		&#125;</span></span><br><span class="line"></span><br><span class="line">		<span class="class">.middle</span><span class="rules">&#123;</span><br><span class="line">			<span class="rule"><span class="attribute">margin-left</span>:<span class="value"> -<span class="number">5px</span></span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">margin-right</span>:<span class="value"> -<span class="number">5px</span></span></span>;</span><br><span class="line">		&#125;</span></span><br><span class="line">		<span class="class">.middle1</span><span class="rules">&#123;</span><br><span class="line">			<span class="rule"><span class="attribute">margin-top</span>:<span class="value"> -<span class="number">5px</span></span></span>;</span><br><span class="line">			<span class="rule"><span class="attribute">margin-bottom</span>:<span class="value"> -<span class="number">5px</span></span></span>;</span><br><span class="line">		&#125;</span></span><br><span class="line">		</span><br><span class="line">	</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"width:320px; height:320px;background-color:#eee"</span> <span class="attribute">id</span>=<span class="value">"outer"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span>&gt;</span>1<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"middle"</span>&gt;</span>2<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span>&gt;</span>3<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"middle1"</span>&gt;</span>4<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"middle middle1"</span>&gt;</span>5<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"middle1"</span>&gt;</span>6<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span>&gt;</span>7<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"middle"</span>&gt;</span>8<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span>&gt;</span>9<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="研究">研究</h3><ul>
<li>div换行问题：<ul>
<li><code>&lt;div&gt;</code>是块级元素，前后有换行符，如果不加任何设置，九个div将垂直排列在页面；</li>
<li>解决方法是，先设置好外层、内层div的宽高，然后对内层div加入<code>float: left;</code>属性，使其向左浮动，去掉div前后的换行符，由于外层div有宽度限制，内层div在达到外层div宽度后，会自动换行，实现九宫格基本样式；</li>
</ul>
</li>
<li>文字的居中问题：<ul>
<li>对于文字的左右居中，不需要使用position属性配合left、margin-left属性来设置，只需用特定作用于文字的属性<code>text-align: center;</code>即可，这个属性不仅可以作用于文字，而且还能作用于很多块级元素，美中不足的是，如果父元素设置了<code>text-align</code>属性，它的所有子元素将继承这个属性的值；</li>
<li>对于文字的上下居中，本来也想使用position属性配合left、margin-left属性来设置，但看到网上有牛人直接用<code>line-height</code>就实现了，这个属性用于设置行间距，由于九宫格中的文字只有一行，所以将<code>line-height</code>设置为div的高度即可实现垂直居中效果；</li>
</ul>
</li>
<li>负外边距的问题：<ul>
<li>如果不对<code>.middle</code>和<code>.middle1</code>类设置负外边距，效果是下面的样子，即处于上下中间或左右中间的格子，只对自己的外边框变化了颜色，与我们要求的效果有差距；</li>
<li>通过将2、5、8格子的左右的margin设置为负值，4、5、6格子的上下的margin设置为负值，可有效避免相邻格子间的外边距叠加的问题；</li>
</ul>
</li>
</ul>
<p><img src="/images/sudoku/sudoku-error1.png" alt="suduku_error1"></p>
<ul>
<li>将格子的position属性设置为relative，并且将鼠标悬浮时的格子的z-index属性设置为较大的值，可保证鼠标悬浮时，当前格子总是处于最高的层叠位置，否则会出现下图的情况：</li>
</ul>
<p><img src="/images/sudoku/sudoku-error2.png" alt="suduku_error2"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Web/">Web</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2016-1-5-sort-algorithm" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/05/2016-1-5-sort-algorithm/" class="article-date">
  	<time datetime="2016-01-04T16:00:00.000Z" itemprop="datePublished">2016-01-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/05/2016-1-5-sort-algorithm/">几种排序算法的实现</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>排序算法是重要的基础算法；</li>
<li>排序算法的效率至关重要；</li>
<li>任何算法的空间效率和时间效率不可兼得，所以没有最好的算法，只有最合适的算法；</li>
<li>本文总结了几种排序算法，并分析了他们的适用场景，使用的语言为java和js；</li>
</ul>
<h3 id="选择排序（selection_sort）">选择排序（selection sort）</h3><ul>
<li>思想：对于一个数组a，找出数组中的最小元素并和a[0]交换，然后忽略a[0]，再次找出数组中的最小元素并与a[1]交换，以此类推；</li>
<li>java实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> SelectionSort &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] nums = &#123; <span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span> &#125;;</span><br><span class="line">		sort(nums);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			System.out.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] myArray)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; myArray.length; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> temp = myArray[i];</span><br><span class="line">			<span class="keyword">int</span> position = i;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; myArray.length; j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (myArray[j] &lt; temp) &#123;</span><br><span class="line">					temp = myArray[j];</span><br><span class="line">					position = j;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			myArray[position] = myArray[i];</span><br><span class="line">			myArray[i] = temp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span>];</span><br><span class="line"><span class="keyword">var</span> selectionSort = <span class="function"><span class="keyword">function</span>(<span class="params">nums</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> temp = nums[i];</span><br><span class="line">		<span class="keyword">var</span> position = i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> j=i; j&lt;nums.length; j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(nums[j]&lt;temp)&#123;</span><br><span class="line">				temp = nums[j];</span><br><span class="line">				position = j;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		nums[position] = nums[i];</span><br><span class="line">		nums[i] = temp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">selectionSort(nums);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> number <span class="keyword">in</span> nums)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(nums[number]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="插入排序（Insertion_sort）">插入排序（Insertion  sort）</h3><ul>
<li>思想：从数组的第二个元素开始，将数组中的每一个元素按照规则插入到已排好序的数组中以达到排序的目的；</li>
<li>java排序：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InsertionSort &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] nums = &#123; <span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span> &#125;;</span><br><span class="line">		sort(nums);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			System.out.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] myArray)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; myArray.length; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> j = i - <span class="number">1</span>;</span><br><span class="line">			temp = myArray[i];</span><br><span class="line">			<span class="keyword">for</span> (; j &gt;= <span class="number">0</span> &amp;&amp; temp &lt; myArray[j]; j--) &#123;</span><br><span class="line">				myArray[j + <span class="number">1</span>] = myArray[j]; <span class="comment">// 将大于temp的值整体后移一个单位</span></span><br><span class="line">			&#125;</span><br><span class="line">			myArray[j + <span class="number">1</span>] = temp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var nums = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">0</span>];</span><br><span class="line">var insertionSort = function(nums)&#123;</span><br><span class="line">	<span class="keyword">for</span>(var i=<span class="number">1</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">		var temp = nums[i];</span><br><span class="line">		<span class="keyword">for</span>(var j = i-<span class="number">1</span>; j&gt;=<span class="number">0</span>&amp;&amp;nums[j]&gt;temp; j--)&#123;</span><br><span class="line">			nums[j+<span class="number">1</span>] = nums[j];</span><br><span class="line">		&#125;</span><br><span class="line">		nums[j+<span class="number">1</span>]=temp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">insertionSort(nums);</span><br><span class="line"><span class="keyword">for</span>(var number in nums)&#123;</span><br><span class="line">	console.<span class="built_in">log</span>(nums[number]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="希尔排序（shell_sort）">希尔排序（shell sort）</h3><ul>
<li>希尔排序是改进后的插入排序；</li>
<li>思想：由于数组越接近有序，插入排序时间复杂度越低，所以希尔排序不是直接对数组进行插入排序，而是先对数组分成若干组，对每一组分别进行插入排序，使得数组变得”更加有序”之后再扩大每组的元素个数，再对每组进行插入排序，以此类推，直至元素全部有序，这是一种为了降低时间复杂度的”渐进式”的插入排序；</li>
<li>java实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InsertionSort &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] nums = &#123; <span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span> &#125;;</span><br><span class="line">		sort(nums);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			System.out.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] myArray)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">double</span> d = myArray.length;</span><br><span class="line">		<span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">			d = Math.<span class="built_in">ceil</span>(d/<span class="number">2</span>);</span><br><span class="line">			<span class="keyword">int</span> inteval = (<span class="keyword">int</span>)d;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i&lt;inteval; i++)&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j=i+inteval; j&lt;myArray.length; j+=inteval)&#123;</span><br><span class="line">					<span class="keyword">int</span> temp = myArray[j];</span><br><span class="line">					<span class="keyword">int</span> k = j-inteval;</span><br><span class="line">					<span class="keyword">for</span>(; k&gt;=<span class="number">0</span>&amp;&amp;myArray[k]&gt;temp;k-=inteval)&#123;</span><br><span class="line">						myArray[k+inteval] = myArray[k];</span><br><span class="line">					&#125;</span><br><span class="line">					myArray[k+inteval] = temp;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(inteval==<span class="number">1</span>)&#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [3,1,4,2,7,2,3,10];</span><br><span class="line"><span class="keyword">var</span> shellSort = function(nums)&#123;</span><br><span class="line">	<span class="keyword">var</span> <span class="keyword">d</span> = nums.length;</span><br><span class="line">	<span class="keyword">while</span>(true)&#123;</span><br><span class="line">		<span class="keyword">d</span> = Math.<span class="literal">ceil</span>(<span class="keyword">d</span>/2);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=0; i&lt;<span class="keyword">d</span>; i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> j=i+<span class="keyword">d</span>; j&lt;nums.length; j++)&#123;</span><br><span class="line">				<span class="keyword">var</span> temp = nums[j];</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">var</span> k = j-<span class="keyword">d</span>; k&gt;=0&amp;&amp;nums[k]&gt;temp;k-=<span class="keyword">d</span>)&#123;</span><br><span class="line">					nums[k+<span class="keyword">d</span>] = nums[k];</span><br><span class="line">				&#125;</span><br><span class="line">				nums[k+<span class="keyword">d</span>] = temp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">d</span>==1)&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">shellSort(nums);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> number <span class="keyword">in</span> nums)&#123;</span><br><span class="line">	console.<span class="literal">log</span>(nums[number]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="归并排序（Merge_Sort）">归并排序（Merge Sort）</h3><ul>
<li>归并排序是分治法在排序算法中的的典型实现；</li>
<li>归并排序是将一个数组分为两半A、B（或更多部分），对这两半分别排序后，再将他们归并为一个有序数组；</li>
<li>合并的方法：将A数组中的一个元素与B数组中的一个元素相比较，并将较小的元素复制到第三个新数组中，当其中一个数组到达末尾时，将另一个数组中剩余元素复制到第三个数组中即可；</li>
<li>java实现：</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line">public class <span class="type">InsertionSort</span> &#123;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">		<span class="type">int</span>[] nums = &#123; <span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span> &#125;;</span><br><span class="line">		sort(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			<span class="type">System</span>.<span class="keyword">out</span>.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> sort(<span class="type">int</span>[] myArray,<span class="type">int</span> left,<span class="type">int</span> right) &#123;</span><br><span class="line">		<span class="keyword">if</span>(left&lt;right)&#123;</span><br><span class="line">			<span class="type">int</span> center = (left+right)/<span class="number">2</span>;</span><br><span class="line">			sort(myArray,left,center);  //递归</span><br><span class="line">			sort(myArray,center+<span class="number">1</span>,right);</span><br><span class="line">			merge(myArray,left,center,right);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> merge(<span class="type">int</span>[] myArray,<span class="type">int</span> left,<span class="type">int</span> center,<span class="type">int</span> right)&#123;</span><br><span class="line">		<span class="type">int</span>[] <span class="literal">result</span> = new <span class="type">int</span>[myArray.length];</span><br><span class="line">		<span class="type">int</span> mid = center+<span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> third = left; //记录新的数组<span class="literal">result</span>的偏移量</span><br><span class="line">		<span class="type">int</span> tmp = left;</span><br><span class="line">		//归并</span><br><span class="line">		<span class="keyword">while</span>(left&lt;=center&amp;&amp;mid&lt;=right)&#123;</span><br><span class="line">			<span class="keyword">if</span>(myArray[left]&lt;=myArray[mid])&#123;</span><br><span class="line">				<span class="literal">result</span>[third++] = myArray[left++];</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="literal">result</span>[third++] = myArray[mid++];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		//处理归并剩余部分</span><br><span class="line">		<span class="keyword">while</span>(mid&lt;=right)&#123;</span><br><span class="line">			<span class="literal">result</span>[third++] = myArray[mid++];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">while</span>(left&lt;=center)&#123;</span><br><span class="line">			<span class="literal">result</span>[third++] = myArray[left++];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		//复制回原数组</span><br><span class="line">		<span class="keyword">while</span>(tmp&lt;=right)&#123;</span><br><span class="line">			myArray[tmp] = <span class="literal">result</span>[tmp];</span><br><span class="line">			tmp++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span>];</span><br><span class="line"><span class="keyword">var</span> mergeSort = function(nums,left,right)&#123;</span><br><span class="line">	<span class="keyword">if</span>(left&lt;right)&#123;</span><br><span class="line">		<span class="keyword">var</span> center = <span class="type">Math</span>.floor((left+right)/<span class="number">2</span>);</span><br><span class="line">		mergeSort(nums,left,center);</span><br><span class="line">		mergeSort(nums,center+<span class="number">1</span>,right);</span><br><span class="line">		merge(nums,left,center,right);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> merge = function(nums,left,center,right)&#123;</span><br><span class="line">	<span class="keyword">var</span> mid = center+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">var</span> tmp = left;</span><br><span class="line">	<span class="keyword">var</span> third = left;</span><br><span class="line">	<span class="keyword">var</span> <span class="literal">result</span> = new <span class="type">Array</span>(nums.length);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(left&lt;=center&amp;&amp;mid&lt;=right)&#123;</span><br><span class="line">		<span class="keyword">if</span>(nums[left]&lt;nums[mid])&#123;</span><br><span class="line">			<span class="literal">result</span>[third++] = nums[left++];</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="literal">result</span>[third++] = nums[mid++];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(left&lt;=center)&#123;</span><br><span class="line">		<span class="literal">result</span>[third++] = nums[left++];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(mid&lt;=right)&#123;</span><br><span class="line">		<span class="literal">result</span>[third++] = nums[mid++];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(tmp&lt;=right)&#123;</span><br><span class="line">		nums[tmp] = <span class="literal">result</span>[tmp];</span><br><span class="line">		tmp++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mergeSort(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> number <span class="keyword">in</span> nums)&#123;</span><br><span class="line">	console.log(nums[number]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="冒泡排序（Bubble_sort）">冒泡排序（Bubble sort）</h3><ul>
<li>从第一个元素开始，比较相邻的元素，如果第一个比第二个大，就交换他们两个； </li>
<li>依次往后，对每一对相邻元素作同样的工作，直到序列最后，最后的元素应该会是最大的数； </li>
<li>从第一个元素开始，重复上面两步，直到倒数第二个元素就停止（最后一个元素肯定是序列中最大的，不用再次比较）；</li>
<li>重复上面的过程，直到序列末尾；</li>
<li>java实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InsertionSort &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] nums = &#123; <span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span> &#125;;</span><br><span class="line">		sort(nums);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			System.out.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] myArray)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tmp;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i&lt;myArray.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;myArray.length-<span class="number">1</span>-i; j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(myArray[j]&gt;myArray[j+<span class="number">1</span>])&#123;</span><br><span class="line">					tmp = myArray[j];</span><br><span class="line">					myArray[j] = myArray[j+<span class="number">1</span>];</span><br><span class="line">					myArray[j+<span class="number">1</span>] = tmp;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var nums = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>];</span><br><span class="line">var bubbleSort = function(nums)&#123;</span><br><span class="line">	var temp;</span><br><span class="line">	<span class="keyword">for</span>(var i=<span class="number">0</span> ;i&lt;nums.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(var j=<span class="number">0</span>; j&lt;nums.length-<span class="number">1</span>-i; j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(nums[j]&gt;nums[j+<span class="number">1</span>])&#123;</span><br><span class="line">				tmp = nums[j];</span><br><span class="line">				nums[j] = nums[j+<span class="number">1</span>];</span><br><span class="line">				nums[j+<span class="number">1</span>] = tmp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bubbleSort(nums);</span><br><span class="line"><span class="keyword">for</span>(var number in nums)&#123;</span><br><span class="line">	console.<span class="built_in">log</span>(nums[number]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="快速排序(Quick_Sort)">快速排序(Quick Sort)</h3><ul>
<li>思想：选择一个基准元素,通常选择第一个元素或者最后一个元素,通过一趟扫描，将待排序列分成两部分,一部分比基准元素小,一部分大于等于基准元素,此时基准元素在其排好序后的正确位置,然后再用同样的方法递归地排序划分的两部分；</li>
<li>java实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InsertionSort &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] nums = &#123; <span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span> &#125;;</span><br><span class="line">		quickSort(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			System.out.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] <span class="built_in">list</span>, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (low &lt; high) &#123;</span><br><span class="line">			<span class="keyword">int</span> middle = getMiddle(<span class="built_in">list</span>, low, high); <span class="comment">// 将list数组进行一分为二</span></span><br><span class="line">			quickSort(<span class="built_in">list</span>, low, middle - <span class="number">1</span>); <span class="comment">// 对低字表进行递归排序</span></span><br><span class="line">			quickSort(<span class="built_in">list</span>, middle + <span class="number">1</span>, high); <span class="comment">// 对高字表进行递归排序</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMiddle</span><span class="params">(<span class="keyword">int</span>[] <span class="built_in">list</span>, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tmp = <span class="built_in">list</span>[low]; <span class="comment">// 数组的第一个作为中轴</span></span><br><span class="line">		<span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">			<span class="keyword">while</span> (low &lt; high &amp;&amp; <span class="built_in">list</span>[high] &gt;= tmp) &#123;</span><br><span class="line">				high--;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">list</span>[low] = <span class="built_in">list</span>[high]; <span class="comment">// 比中轴小的记录移到低端</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">while</span> (low &lt; high &amp;&amp; <span class="built_in">list</span>[low] &lt;= tmp) &#123;</span><br><span class="line">				low++;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">list</span>[high] = <span class="built_in">list</span>[low]; <span class="comment">// 比中轴大的记录移到高端</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">list</span>[low] = tmp; <span class="comment">// 中轴记录到尾</span></span><br><span class="line">		<span class="keyword">return</span> low; <span class="comment">// 返回中轴的位置</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">45</span>];</span><br><span class="line"><span class="keyword">var</span> quickSort = <span class="function"><span class="keyword">function</span>(<span class="params">nums,low,high</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(low&lt;high)&#123;</span><br><span class="line">		<span class="keyword">var</span> middle = sort(nums,low,high);</span><br><span class="line">		quickSort(nums,low,middle-<span class="number">1</span>);</span><br><span class="line">		quickSort(nums,middle+<span class="number">1</span>,high);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sort = <span class="function"><span class="keyword">function</span>(<span class="params">nums, low, high</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> tmp = nums[low];</span><br><span class="line">	<span class="keyword">while</span>(low&lt;high)&#123;</span><br><span class="line">		<span class="keyword">while</span>(low&lt;high&amp;&amp;tmp&lt;=nums[high])&#123;</span><br><span class="line">			high--;</span><br><span class="line">		&#125;</span><br><span class="line">		nums[low] = nums[high];</span><br><span class="line">		<span class="keyword">while</span>(low&lt;high&amp;&amp;tmp&gt;=nums[low])&#123;</span><br><span class="line">			low++;</span><br><span class="line">		&#125;</span><br><span class="line">		nums[high] = nums[low];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	nums[low] = tmp;</span><br><span class="line">	<span class="keyword">return</span> low;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">quickSort(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> number <span class="keyword">in</span> nums)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(nums[number]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="堆排序(Heap_Sort)">堆排序(Heap Sort)</h3><ul>
<li>堆的基本概念：<ul>
<li>堆是节点含有可比较对象，并以如下方式组织的完全二叉树：</li>
<li>每个节点含有的对象不小于(最大堆)/不大于(最小堆)其后代中的对象；</li>
<li>最大（小）堆的根含有堆中最大（小）的对象；</li>
<li>最大（小）堆中任何节点的子树也是最大（小）堆；</li>
</ul>
</li>
<li>堆排序原理：<ul>
<li><a href="http://www.cnblogs.com/mengdd/archive/2012/11/30/2796845.html" target="_blank" rel="external">这里</a>讲解的很清楚；</li>
</ul>
</li>
<li>java实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InsertionSort &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] nums = &#123; <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">10</span> &#125;;</span><br><span class="line">		heapSort(nums);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			System.out.println(nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span>[] myArray)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = myArray.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">			<span class="comment">// i记录了数组中参与重建最大堆的最后一个元素的索引值</span></span><br><span class="line">			buildMaxHeap(myArray, i);</span><br><span class="line">			<span class="comment">// 交换了第一个元素和倒数第myArray.length-1-i个元素</span></span><br><span class="line">			swap(myArray, <span class="number">0</span>, i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] myArray, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tmp;</span><br><span class="line">		tmp = myArray[a];</span><br><span class="line">		myArray[a] = myArray[b];</span><br><span class="line">		myArray[b] = tmp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">buildMaxHeap</span><span class="params">(<span class="keyword">int</span>[] myArray, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// (i-1)/2 是数组中最后一个具有叶子节点的节点的索引，从这个节点开始重建堆</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = (i - <span class="number">1</span>) / <span class="number">2</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">			<span class="keyword">int</span> k = j;</span><br><span class="line">			<span class="keyword">while</span> (k * <span class="number">2</span> + <span class="number">1</span> &lt;= i) &#123;</span><br><span class="line">				<span class="keyword">int</span> leftIndex = k * <span class="number">2</span> + <span class="number">1</span>; <span class="comment">// 当前节点的左子节点的索引</span></span><br><span class="line">				<span class="keyword">int</span> rightIndex = leftIndex + <span class="number">1</span>; <span class="comment">// 当前节点的右子节点的索引</span></span><br><span class="line">				<span class="keyword">int</span> biggerInLeftRight = myArray[leftIndex]; <span class="comment">// 左右子节点中较大的数</span></span><br><span class="line">				<span class="keyword">int</span> biggerIndex = leftIndex; <span class="comment">// 左右子节点中较大的数的索引</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">// 判断右子节点是否参与本次重建堆，参与则执行</span></span><br><span class="line">				<span class="keyword">if</span> (rightIndex &lt;= i) &#123;</span><br><span class="line">					<span class="comment">// 找出左右子节点中较大的数</span></span><br><span class="line">					<span class="keyword">if</span> (myArray[leftIndex] &lt; myArray[rightIndex]) &#123;</span><br><span class="line">						biggerInLeftRight = myArray[rightIndex];</span><br><span class="line">						biggerIndex = rightIndex;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 将当前节点、当前节点的左右子节点中的最大值移到当前节点的位置</span></span><br><span class="line">				<span class="keyword">if</span> (myArray[k] &lt; biggerInLeftRight) &#123;</span><br><span class="line">					swap(myArray, k, biggerIndex);</span><br><span class="line">					<span class="comment">// 继续循环，确保当前节点的左右子节点也满足最大堆的性质</span></span><br><span class="line">					k = biggerIndex;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js实现：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">8</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"><span class="keyword">var</span> heapSort = <span class="function"><span class="keyword">function</span>(<span class="params">nums</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=nums.length-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i--)&#123;</span><br><span class="line">		buildMaxHeap(nums,i);</span><br><span class="line">		swap(nums,<span class="number">0</span>,i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> swap = <span class="function"><span class="keyword">function</span>(<span class="params">nums, a, b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> tmp;</span><br><span class="line">	tmp = nums[a];</span><br><span class="line">	nums[a] = nums[b];</span><br><span class="line">	nums[b] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buildMaxHeap = <span class="function"><span class="keyword">function</span>(<span class="params">nums,i</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="built_in">Math</span>.floor((i-<span class="number">1</span>)/<span class="number">2</span>); j&gt;=<span class="number">0</span>; j--)&#123;</span><br><span class="line">		<span class="keyword">var</span> k = j;</span><br><span class="line">		<span class="keyword">while</span>(k*<span class="number">2</span>+<span class="number">1</span>&lt;=i)&#123;</span><br><span class="line">			<span class="keyword">var</span> leftIndex = k*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">var</span> rightIndex = leftIndex+<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">var</span> biggerIndex = leftIndex;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(rightIndex&lt;=i)&#123;</span><br><span class="line">				<span class="keyword">if</span>(nums[leftIndex]&lt;nums[rightIndex])&#123;</span><br><span class="line">					biggerIndex = rightIndex;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(nums[k]&lt;nums[biggerIndex])&#123;</span><br><span class="line">				swap(nums,k,biggerIndex);</span><br><span class="line">				k = biggerIndex;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">heapSort(nums);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(nums[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="基数排序（radix_sort）">基数排序（radix sort）</h3><ul>
<li>基数排序和其他排序方法的思路不同，不是以比较对象大小为基础；</li>
<li>基础排序先将待排序对象的长度补全成相同的长度，然后从最后一位开始：将所有元素按照最后一位的大小排序，排序后元素的最后一位是有序的；再将所有元素按照倒数第二位的大小排序，排序后元素的倒数第二位是有序的，在倒数第二位相同的元素中，它们的最后一位是有序的；再将所有元素按照倒数第三位的大小排序，排序后元素的倒数第三位是有序的，在倒数第三位相同的元素中，它们的倒数第二位是有序的，在倒数第二位相同的元素中，它们的最后一位是有序的；</li>
<li>以此类推，直到元素的第一位排序完成；</li>
<li>此时元素已经是有序序列；</li>
<li>java实现：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package test8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> RadixSort &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] <span class="built_in">array</span> = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">20</span>, <span class="number">22</span>, <span class="number">98</span>, <span class="number">45</span>, <span class="number">77</span>, <span class="number">75</span>, <span class="number">55</span>, <span class="number">25</span>, <span class="number">52</span>, <span class="number">79</span>, <span class="number">56</span>,</span><br><span class="line">				<span class="number">44</span>, <span class="number">32</span>, <span class="number">37</span>, <span class="number">35</span>, <span class="number">21</span>, <span class="number">102</span>, <span class="number">33</span>, <span class="number">178</span>, <span class="number">187</span>, <span class="number">156</span>, <span class="number">144</span> &#125;;</span><br><span class="line">		sort(<span class="built_in">array</span>, <span class="number">3</span>); <span class="comment">// 传入数组和数组中长度最大的数的长度</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">array</span>.length; i++) &#123;</span><br><span class="line">			System.out.print(<span class="built_in">array</span>[i] + <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] <span class="built_in">array</span>, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[][] bucket = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">array</span>.length][<span class="built_in">array</span>.length];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">1</span>, m = <span class="number">0</span>; m &lt; d; n *= <span class="number">10</span>, m++) &#123;</span><br><span class="line">			<span class="keyword">int</span>[] num = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">array</span>.length];  <span class="comment">//记录二维数组bucket的横向数组的长度</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">array</span>.length; i++) &#123;</span><br><span class="line">				<span class="keyword">int</span> position = <span class="built_in">array</span>[i] / n % <span class="number">10</span>;</span><br><span class="line">				bucket[position][num[position]] = <span class="built_in">array</span>[i];</span><br><span class="line">				num[position]++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>, i = <span class="number">0</span>; k &lt; <span class="built_in">array</span>.length; k++) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; num[k]; j++, i++) &#123;</span><br><span class="line">					<span class="built_in">array</span>[i] = bucket[k][j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="各种排序算法对比">各种排序算法对比</h3><ul>
<li><p>资料：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Sorting_algorithm#Comparison_of_algorithms" target="_blank" rel="external">这里</a>有各种算法的汇总，进入相应的算法的词条有动图；</li>
<li><a href="http://www.webhek.com/misc/comparison-sort" target="_blank" rel="external">这里</a>有HTML5动图，非常好看；</li>
</ul>
</li>
<li><p>复杂度对比：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>排序算法</th>
<th>最好时间复杂度</th>
<th>平均时间复杂度</th>
<th>最坏时间复杂度</th>
<th>稳定性</th>
<th>空间复杂度</th>
</tr>
</thead>
<tbody>
<tr>
<td>冒泡排序</td>
<td>O(n)</td>
<td>O(n^2)</td>
<td>O(n^2)</td>
<td>稳定</td>
<td>O(1)</td>
</tr>
<tr>
<td>选择排序</td>
<td>O(n^2)</td>
<td>O(n^2)</td>
<td>O(n^2)</td>
<td>不稳定</td>
<td>O(1)</td>
</tr>
<tr>
<td>插入排序</td>
<td>O(n)</td>
<td>O(n^2)</td>
<td>O(n^2)</td>
<td>稳定</td>
<td>O(1)</td>
</tr>
<tr>
<td>希尔排序</td>
<td>O(n)</td>
<td>O(n^1.5)</td>
<td>O(n^2)</td>
<td>不稳定</td>
<td>O(1)</td>
</tr>
<tr>
<td>归并排序</td>
<td><code>O(n*logn)</code></td>
<td><code>O(n*logn)</code></td>
<td><code>O(n*logn)</code></td>
<td>稳定</td>
<td>O(1)</td>
</tr>
<tr>
<td>快速排序</td>
<td><code>O(n*logn)</code></td>
<td><code>O(n*logn)</code></td>
<td>O(n^2)</td>
<td>不稳定</td>
<td>O(logn)~O(n)</td>
</tr>
<tr>
<td>堆排序</td>
<td><code>O(n*logn)</code></td>
<td><code>O(n*logn)</code></td>
<td><code>O(n*logn)</code></td>
<td>不稳定</td>
<td>O(1)</td>
</tr>
<tr>
<td>基数排序</td>
<td>约为O(n)</td>
<td>约为O(n)</td>
<td>约为O(n)</td>
<td>稳定</td>
<td>O(rd+n)</td>
</tr>
</tbody>
</table>
<ul>
<li>各种排序方法的适用条件<ul>
<li>当待排序总数较小，用插入排序或选择排序，虽然他们的时间复杂度高，但是在排序总数较小时时间并不是主要矛盾；</li>
<li>当待排序对象基本有序时，用插入排序、冒泡排序、快速排序，因为他们在序列接近有序的情况下的时间复杂度比序列完全无序时低；</li>
<li>若待排序对象非常多，选择快速排序（首选）、堆排序、归并排序，因为他们的时间复杂度为O(nlgn)，即用空间换取时间，以便解决“时间太长”这个主要矛盾；</li>
<li>若要求排序算法稳定，则选用归并排序；</li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Algorithm/">Algorithm</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-java-log" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/30/java-log/" class="article-date">
  	<time datetime="2015-12-29T16:00:00.000Z" itemprop="datePublished">2015-12-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/30/java-log/">Java日志</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>最近在做资源库管理系统，由于这个系统涉及一些复杂的操作，比如增删改查数据库表、用户申请新版本、审批和通过用户申请、导入和导出资源表，需要将每次操作的日志记录在专门的文件中，已被查阅和追责；</li>
<li>需求中提出的日志记录功能不是JVM或者是glassfish层面的日志，而是业务层面的日志，需要用专门的类完成这一功能；</li>
<li>顺便学习了java日志记录的相关知识；</li>
</ul>
<h3 id="log4j">log4j</h3><ul>
<li>日志的记录一般是用Apache的Log4j包，log4j的优点在于：线程安全、可记录多个层次的日志信息、支持国际化、速度经过优化；</li>
<li>本文参考<a href="http://www.codeceo.com/article/log4j-usage.html" target="_blank" rel="external">这篇文章</a>；</li>
</ul>
<h3 id="log4j下载和使用步骤">log4j下载和使用步骤</h3><ul>
<li>在<a href="http://logging.apache.org/log4j/2.x/download.html" target="_blank" rel="external">这里</a>下载；</li>
<li>将其中的jar包复制到eclipse工程中，并通过右键&gt;build path&gt;configuration&gt;library添加jar包进入工程；</li>
<li>在src直接下级目录创建并设置<code>log4j.properties</code>文件</li>
</ul>
<p><img src="/images/javalog/log1.png" alt="log1"></p>
<ul>
<li>log4j.properties文件可写成诸如下面的结构：</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger = debug,stdout,<span class="keyword">D</span>,<span class="literal">E</span></span><br><span class="line"></span><br><span class="line">log4j.appender.stdout = org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target = System.<span class="keyword">out</span></span><br><span class="line">log4j.appender.stdout.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern = [%-5p] %<span class="keyword">d</span>&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; method:%<span class="keyword">l</span>%<span class="keyword">n</span>%<span class="keyword">m</span>%<span class="keyword">n</span></span><br><span class="line"></span><br><span class="line">log4j.appender.<span class="keyword">D</span> = org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.<span class="keyword">D</span>.<span class="keyword">File</span> = C:\\Users\\changsiyuan\\Desktop\\<span class="keyword">log</span>.<span class="literal">log</span></span><br><span class="line">log4j.appender.<span class="keyword">D</span>.<span class="keyword">Append</span> = true</span><br><span class="line">log4j.appender.<span class="keyword">D</span>.Threshold = DEBUG </span><br><span class="line">log4j.appender.<span class="keyword">D</span>.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.<span class="keyword">D</span>.layout.ConversionPattern = %-<span class="keyword">d</span>&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %<span class="keyword">m</span>%<span class="keyword">n</span></span><br><span class="line"></span><br><span class="line">log4j.appender.<span class="keyword">E</span> = org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.<span class="keyword">E</span>.<span class="keyword">File</span> = C:\\Users\\changsiyuan\\Desktop\\<span class="keyword">log</span>.<span class="literal">log</span></span><br><span class="line">log4j.appender.<span class="keyword">E</span>.<span class="keyword">Append</span> = true</span><br><span class="line">log4j.appender.<span class="keyword">E</span>.Threshold = <span class="keyword">ERROR</span> </span><br><span class="line">log4j.appender.<span class="keyword">E</span>.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.<span class="keyword">E</span>.layout.ConversionPattern = %-<span class="keyword">d</span>&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %<span class="keyword">m</span>%<span class="keyword">n</span></span><br></pre></td></tr></table></figure>
<ul>
<li>程序需要先初始化log4j，然后再需要记录日志的地方调用相应的方法即可：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package testlog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.BasicConfigurator;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.PropertyConfigurator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * @author changsiyuan</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="comment">//获取日志记录器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> logger = <span class="type">Logger</span>.getLogger(<span class="type">Test</span>.<span class="keyword">class</span>);  </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 * @param args</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">		<span class="comment">//配置log4j环境，自动快速地使用缺省Log4j环境</span></span><br><span class="line">		<span class="type">BasicConfigurator</span>.configure();</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// 记录debug级别的信息  </span></span><br><span class="line">        logger.debug(<span class="string">"This is debug message."</span>);  </span><br><span class="line">        <span class="comment">// 记录info级别的信息  </span></span><br><span class="line">        logger.info(<span class="string">"This is info message."</span>);</span><br><span class="line">        <span class="comment">// 记录warn级别的信息  </span></span><br><span class="line">        logger.warn (<span class="string">"This is warn message."</span>) ;  </span><br><span class="line">        <span class="comment">// 记录error级别的信息  </span></span><br><span class="line">        logger.error(<span class="string">"This is error message."</span>);  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置文件参数说明">配置文件参数说明</h3><ul>
<li>优先级说明<ul>
<li>日志优先级从高到低为<code>ERROR、WARN、INFO、DEBUG</code>；</li>
</ul>
</li>
<li>根配置信息<ul>
<li>下面的配置信息表明将登记大于等于INFO的日志信息输出到stdout和R两个目的地；</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">log</span>4j.rootCategory=INFO,stdout,R</span><br></pre></td></tr></table></figure>
<ul>
<li>配置日志输出目的地信息<ul>
<li>目的地参数如下：<code>org.apache.log4j.ConsoleAppender</code>（控制台）,<code>org.apache.log4j.FileAppender</code>（文件），<code>org.apache.log4j.DailyRollingFileAppender</code>（每天产生一个日志文件), <code>org.apache.log4j.RollingFileAppender</code>（文件大小到达指定尺寸的时候产生一个新的文件）, <code>org.apache.log4j.WriterAppender</code>（将日志信息以流格式发送到任意指定的地方）</li>
<li>语法如下：</li>
</ul>
</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">log4j<span class="class">.appender</span><span class="class">.appenderName</span> = fully<span class="class">.qualified</span><span class="class">.name</span><span class="class">.of</span><span class="class">.appender</span><span class="class">.class</span>  </span><br><span class="line">log4j<span class="class">.appender</span><span class="class">.appenderName</span><span class="class">.option1</span> = value1  </span><br><span class="line">...</span><br><span class="line">log4j<span class="class">.appender</span><span class="class">.appenderName</span><span class="class">.option</span> = valueN</span><br></pre></td></tr></table></figure>
<ul>
<li>布局信息的配置<ul>
<li>布局参数：<code>org.apache.log4j.HTMLLayout</code>（以HTML表格形式布局），<code>org.apache.log4j.PatternLayout</code>（可以灵活地指定布局模式），<code>org.apache.log4j.SimpleLayout</code>（包含日志信息的级别和信息字符串）, <code>org.apache.log4j.TTCCLayout</code>（包含日志产生的时间、线程、类别等等信息）</li>
<li>语法如下：</li>
</ul>
</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">log4j<span class="class">.appender</span><span class="class">.appenderName</span><span class="class">.layout</span> = fully<span class="class">.qualified</span><span class="class">.name</span><span class="class">.of</span><span class="class">.layout</span><span class="class">.class</span>  </span><br><span class="line">log4j<span class="class">.appender</span><span class="class">.appenderName</span><span class="class">.layout</span><span class="class">.option1</span> = value1  </span><br><span class="line">...</span><br><span class="line">log4j<span class="class">.appender</span><span class="class">.appenderName</span><span class="class">.layout</span><span class="class">.option</span> = valueN</span><br></pre></td></tr></table></figure>
<ul>
<li>打印信息<ul>
<li>语法：<code>log4j.appender.appenderName.layout.ConversionPattern=...</code>;</li>
<li>参数：</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>%m</td>
<td>输出代码中指定的消息</td>
</tr>
<tr>
<td>%p</td>
<td>输出优先级，即DEBUG，INFO，WARN，ERROR，FATAL</td>
</tr>
<tr>
<td>%r</td>
<td>输出自应用启动到输出该log信息耗费的毫秒数</td>
</tr>
<tr>
<td>%c</td>
<td>输出所属的类目，通常就是所在类的全名</td>
</tr>
<tr>
<td>%t</td>
<td>输出产生该日志事件的线程名</td>
</tr>
<tr>
<td>%n</td>
<td>输出一个回车换行符，Windows平台为“rn”，Unix平台为“n”</td>
</tr>
<tr>
<td>%d</td>
<td>输出日志时间点的日期或时间，默认格式为ISO8601，也可以在其后指定格式，比如：%d{yyy MMM dd HH:mm:ss,SSS}，输出类似：2002年10月18日 22：10：28，921</td>
</tr>
<tr>
<td>%l</td>
<td>输出日志事件的发生位置，包括类目名、发生的线程，以及在代码中的行数</td>
</tr>
</tbody>
</table>
<h3 id="配置文件示例">配置文件示例</h3><ul>
<li>log写入控制台</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Root logger option</span></span><br><span class="line">log4j.rootLogger=INFO, <span class="built_in">stdout</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Direct log messages to stdout</span></span><br><span class="line">log4j.appender.<span class="built_in">stdout</span>=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.<span class="built_in">stdout</span>.Target=System.out</span><br><span class="line">log4j.appender.<span class="built_in">stdout</span>.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.<span class="built_in">stdout</span>.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-<span class="number">5</span>p %c&#123;<span class="number">1</span>&#125;:%L - %m%n</span><br></pre></td></tr></table></figure>
<ul>
<li>log写入文件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">### <span class="operator"><span class="keyword">set</span> <span class="keyword">log</span> <span class="keyword">levels</span> ###  </span><br><span class="line">log4j.rootLogger = debug,mylog</span><br><span class="line"></span><br><span class="line">log4j.appender.mylog=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.mylog.append=<span class="literal">true</span></span><br><span class="line">log4j.appender.mylog.<span class="keyword">file</span>= <span class="keyword">C</span>://<span class="keyword">Users</span>/changsiyuan/Desktop/<span class="keyword">log</span>.txt</span><br><span class="line">log4j.appender.mylog.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.mylog.layout.ConversionPattern=%-<span class="number">5</span><span class="keyword">p</span> %<span class="keyword">c</span>: %<span class="keyword">m</span>%<span class="keyword">n</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>log写入文件并限制文件大小</li>
</ul>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Root logger option</span><br><span class="line">log4j.rootLogger=INFO, <span class="keyword">file</span></span><br><span class="line"></span><br><span class="line"># Direct <span class="keyword">log</span> messages to a <span class="keyword">log</span> <span class="keyword">file</span></span><br><span class="line">log4j.appender.<span class="keyword">file</span>=org.apache.log4j.RollingFileAppender</span><br><span class="line"></span><br><span class="line">#Redirect to Tomcat logs folder</span><br><span class="line">#log4j.appender.<span class="keyword">file</span>.File=$&#123;catalina.home&#125;/logs/logging.<span class="keyword">log</span></span><br><span class="line"></span><br><span class="line">log4j.appender.<span class="keyword">file</span>.File=C:\\logigng.<span class="keyword">log</span></span><br><span class="line">log4j.appender.<span class="keyword">file</span>.MaxFileSize=<span class="number">10</span>MB</span><br><span class="line">log4j.appender.<span class="keyword">file</span>.MaxBackupIndex=<span class="number">10</span></span><br><span class="line">log4j.appender.<span class="keyword">file</span>.<span class="keyword">layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.<span class="keyword">file</span>.<span class="keyword">layout</span>.ConversionPattern=<span class="variable">%d</span>&#123;yyyy-MM-dd HH:mm:ss&#125; <span class="variable">%-</span><span class="number">5</span>p <span class="variable">%c</span>&#123;<span class="number">1</span>&#125;:<span class="variable">%L</span> - <span class="variable">%m</span><span class="variable">%n</span></span><br></pre></td></tr></table></figure>
<ul>
<li>log同时写入日志和文件</li>
</ul>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Root logger option</span><br><span class="line">log4j.rootLogger=INFO, <span class="keyword">file</span>, stdout</span><br><span class="line"></span><br><span class="line"># Direct <span class="keyword">log</span> messages to a <span class="keyword">log</span> <span class="keyword">file</span></span><br><span class="line">log4j.appender.<span class="keyword">file</span>=org.apache.log4j.RollingFileAppender</span><br><span class="line">log4j.appender.<span class="keyword">file</span>.File=C:\\logging.<span class="keyword">log</span></span><br><span class="line">log4j.appender.<span class="keyword">file</span>.MaxFileSize=<span class="number">10</span>MB</span><br><span class="line">log4j.appender.<span class="keyword">file</span>.MaxBackupIndex=<span class="number">10</span></span><br><span class="line">log4j.appender.<span class="keyword">file</span>.<span class="keyword">layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.<span class="keyword">file</span>.<span class="keyword">layout</span>.ConversionPattern=<span class="variable">%d</span>&#123;yyyy-MM-dd HH:mm:ss&#125; <span class="variable">%-</span><span class="number">5</span>p <span class="variable">%c</span>&#123;<span class="number">1</span>&#125;:<span class="variable">%L</span> - <span class="variable">%m</span><span class="variable">%n</span></span><br><span class="line"> </span><br><span class="line"># Direct <span class="keyword">log</span> messages to stdout</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target=System.out</span><br><span class="line">log4j.appender.stdout.<span class="keyword">layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.<span class="keyword">layout</span>.ConversionPattern=<span class="variable">%d</span>&#123;yyyy-MM-dd HH:mm:ss&#125; <span class="variable">%-</span><span class="number">5</span>p <span class="variable">%c</span>&#123;<span class="number">1</span>&#125;:<span class="variable">%L</span> - <span class="variable">%m</span><span class="variable">%n</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/log/">log</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-java-annotation" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/29/java-annotation/" class="article-date">
  	<time datetime="2015-12-28T16:00:00.000Z" itemprop="datePublished">2015-12-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/29/java-annotation/">Java注解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>最近项目中需要在服务器端的REST层加入鉴权的机制，即客户端在HTTP请求中带上用户token，调用REST层的每一个API前需要经过鉴权的步骤，即向中心服务器发送用户token查询该用户是否具有调用此API的权限，如果有则可以调用，没有则不能调用；</li>
<li>由于REST层的API都已经写好，且鉴权的代码和API的代码分离，故初步决定反射机制实现这一功能；</li>
<li>由于用到了反射，顺便学习了下java注解；</li>
<li>本文参考<a href="http://blog.sina.com.cn/s/blog_93dc666c0101gzn5.html" target="_blank" rel="external">这里</a>；</li>
</ul>
<h3 id="注解的作用">注解的作用</h3><ul>
<li>注释是给人看的，注解是给程序看的；</li>
<li>Annotation可被用于packages、types（类、接口、枚举、Annotation类型）、类型成员（方法、构造方法、成员变量、枚举值）、方法参数和本地变量（如循环变量、catch参数）；</li>
<li>注解的最主要作用是为特定的数据打上一个标记，以便以后拿来使用；</li>
<li>执行注解的原则：有什么标记（注解）就干什么事；</li>
<li>注释本质上是一个标记，可以在编译、类加载、运行时被读取，并执行相应的操作；</li>
<li>具体来说，注解有以下作用：生成文档、跟踪代码依赖性、在编译时进行格式检查；</li>
</ul>
<h3 id="元注解">元注解</h3><ul>
<li>元注解用于注解其他的注解；</li>
<li>@Target<ul>
<li><code>ElemenetType.CONSTRUCTOR</code> 构造器声明</li>
<li><code>ElemenetType.FIELD</code> 域声明（包括 enum 实例）</li>
<li><code>ElemenetType.LOCAL_VARIABLE</code> 局部变量声明</li>
<li><code>ElemenetType.METHOD</code> 方法声明</li>
<li><code>ElemenetType.PACKAGE</code> 包声明</li>
<li><code>ElemenetType.PARAMETER</code> 参数声明</li>
<li><code>ElemenetType.TYPE</code> 类，接口（包括注解类型）或enum声明</li>
</ul>
</li>
<li>@Retention<ul>
<li><code>RetentionPolicy.SOURCE</code> 注解将被编译器丢弃</li>
<li><code>RetentionPolicy.CLASS</code> 注解在class文件中可用，但会被VM丢弃</li>
<li><code>RetentionPolicy.RUNTIME VM</code> 将在运行期也保留注释，因此可以通过反射机制读取注解的信息</li>
</ul>
</li>
<li>@Documented<ul>
<li>@Documented 将此注解包含在javadoc中 ，它代表着此注解会被javadoc工具提取成文档;</li>
</ul>
</li>
<li>@Inherited<ul>
<li>@Inherited 允许子类继承父类中的注解;</li>
</ul>
</li>
</ul>
<h3 id="基本注解">基本注解</h3><ul>
<li>@Override：告诉编译器检查本方法确保被重写，只能作用于方法，不能作用于其他元素；</li>
<li>@Deprecated：修饰类或者方法，告诉编译器这个被修饰的类或方法已经过时，编译时提出警告信息；</li>
<li>@Suppress Warnings：取消编译器警告信息，作用于修饰的元素及所有子元素；</li>
<li>@Safe Varargs：专门抑制堆污染警告；</li>
<li>其他的java定义好的注解直接查阅API文档即可；</li>
</ul>
<h3 id="自定义注解">自定义注解</h3><ul>
<li>自定义注解修饰各种语法成分</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注解的定义</span></span><br><span class="line"><span class="keyword">package</span> test13;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> @<span class="class"><span class="keyword">interface</span> <span class="title">TestA</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test13;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@TestA</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAnnotation</span> </span>&#123;</span><br><span class="line">	<span class="annotation">@TestA</span> <span class="comment">//使用了类成员注解</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@TestA</span> <span class="comment">//使用了构造方法注解</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserAnnotation</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@TestA</span> <span class="comment">//使用了类方法注解</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="annotation">@TestA</span> <span class="comment">//使用了局部变量注解</span></span><br><span class="line">        Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">(@TestA Integer a)</span></span>&#123; <span class="comment">//使用了方法参数注解</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用元注解</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">package</span> <span class="tag">test13</span>;</span><br><span class="line"></span><br><span class="line"><span class="tag">import</span> <span class="tag">java</span><span class="class">.lang</span><span class="class">.annotation</span><span class="class">.Target</span>;</span><br><span class="line"><span class="tag">import</span> <span class="tag">java</span><span class="class">.lang</span><span class="class">.annotation</span><span class="class">.Retention</span>;</span><br><span class="line"><span class="tag">import</span> <span class="tag">java</span><span class="class">.lang</span><span class="class">.annotation</span><span class="class">.ElementType</span>;</span><br><span class="line"><span class="tag">import</span> <span class="tag">java</span><span class="class">.lang</span><span class="class">.annotation</span><span class="class">.RetentionPolicy</span>;</span><br><span class="line"></span><br><span class="line"><span class="at_rule">@<span class="keyword">Target(ElementType.TYPE)</span></span><br><span class="line">@<span class="function">Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface TestA </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在注解中添加内容</li>
</ul>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//定义注解</span><br><span class="line">package test13;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.Target;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.Retention;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.ElementType;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span></span><br><span class="line"></span><br><span class="line">@Target(&#123;ElementType.TYPE,ElementType.METHOD,ElementType.<span class="keyword">FIELD</span>,ElementType.CONSTRUCTOR&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> @<span class="class"><span class="keyword">interface</span> <span class="title">TestA</span> &#123;</span></span><br><span class="line">	String name();</span><br><span class="line">	int id() <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	<span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">gid</span>();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用注解</span></span><br><span class="line">package test13;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@TestA(name = <span class="string">"type"</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line"><span class="comment">// 类成员注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> UserAnnotation &#123;</span><br><span class="line">	@TestA(name = <span class="string">"param"</span>, id = <span class="number">1</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类成员注解</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"construct"</span>, id = <span class="number">2</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 构造方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserAnnotation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"public method"</span>, id = <span class="number">3</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"protected method"</span>, id = <span class="number">4</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"private method"</span>, id = <span class="number">5</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">c</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">(Integer a)</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>配合反射使用注解<ul>
<li>一般的做法是，定义annotation生命周期为运行时仍存在，运行时通过反射获取相应的annotation内容，然后根据annotation的内容决定采取下一步的动作；</li>
</ul>
</li>
</ul>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//定义注解</span><br><span class="line">package test13;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.Target;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.Retention;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.ElementType;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span></span><br><span class="line"></span><br><span class="line">@Target(&#123;ElementType.TYPE,ElementType.METHOD,ElementType.<span class="keyword">FIELD</span>,ElementType.CONSTRUCTOR&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> @<span class="class"><span class="keyword">interface</span> <span class="title">TestA</span> &#123;</span></span><br><span class="line">	String name();</span><br><span class="line">	int id() <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	<span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">gid</span>();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被注解修饰的类</span></span><br><span class="line">package test13;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@TestA(name = <span class="string">"type"</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line"><span class="comment">// 类成员注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> UserAnnotation &#123;</span><br><span class="line">	@TestA(name = <span class="string">"param"</span>, id = <span class="number">1</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类成员注解</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"construct"</span>, id = <span class="number">2</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 构造方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserAnnotation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"public method"</span>, id = <span class="number">3</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"protected method"</span>, id = <span class="number">4</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestA(name = <span class="string">"private method"</span>, id = <span class="number">5</span>, gid = Long.<span class="keyword">class</span>)</span><br><span class="line">	<span class="comment">// 类方法注解</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">c</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Map m = <span class="keyword">new</span> HashMap(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">(Integer a)</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">//用反射机制使用注解</span><br><span class="line">package test13;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.<span class="type">Annotation</span>;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Method</span>;</span><br><span class="line"></span><br><span class="line">public class <span class="type">ParseAnnotation</span> &#123;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> parseTypeAnnotation() throws <span class="type">ClassNotFoundException</span> &#123;</span><br><span class="line">		//通过反射获取<span class="type">UserAnnotation</span>类</span><br><span class="line">		<span class="type">Class</span>&lt;?&gt; clazz = <span class="type">Class</span>.forName(<span class="string">"test13.UserAnnotation"</span>);</span><br><span class="line"></span><br><span class="line">		//获取类的注解信息,由于注解信息保留到了运行时，所以这里可以获取</span><br><span class="line">		<span class="type">Annotation</span>[] annotations = clazz.getAnnotations();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">Annotation</span> annotation : annotations) &#123;</span><br><span class="line">			<span class="type">TestA</span> testA = (<span class="type">TestA</span>) annotation;</span><br><span class="line">			</span><br><span class="line">			//id= <span class="number">0</span>;name= <span class="keyword">type</span>;gid= class java.lang.<span class="type">Long</span>  (类注解仅有一个)</span><br><span class="line">			<span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"id= "</span> + testA.id() + <span class="string">";name= "</span> + testA.name()</span><br><span class="line">					+ <span class="string">";gid= "</span> + testA.gid());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> parseMethodAnnotation() &#123;</span><br><span class="line">		//通过反射获取类方法</span><br><span class="line">		<span class="type">Method</span>[] methods = <span class="type">UserAnnotation</span>.class.getDeclaredMethods();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">Method</span> <span class="keyword">method</span> : methods) &#123;</span><br><span class="line">			boolean hasAnnotation = <span class="keyword">method</span>.isAnnotationPresent(<span class="type">TestA</span>.class);</span><br><span class="line">			<span class="keyword">if</span> (hasAnnotation) &#123;</span><br><span class="line">				<span class="type">TestA</span> annotation = <span class="keyword">method</span>.getAnnotation(<span class="type">TestA</span>.class);</span><br><span class="line">				</span><br><span class="line">				/*</span><br><span class="line">				 * <span class="keyword">method</span> = c ; id = <span class="number">5</span> ; description = private <span class="keyword">method</span>; gid= class java.lang.<span class="type">Long</span></span><br><span class="line">                 * <span class="keyword">method</span> = a ; id = <span class="number">3</span> ; description = public <span class="keyword">method</span>; gid= class java.lang.<span class="type">Long</span></span><br><span class="line">                 * <span class="keyword">method</span> = b ; id = <span class="number">4</span> ; description = protected <span class="keyword">method</span>; gid= class java.lang.<span class="type">Long</span></span><br><span class="line">				 */</span><br><span class="line">				<span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"method = "</span> + <span class="keyword">method</span>.getName() + <span class="string">" ; id = "</span></span><br><span class="line">						+ annotation.id() + <span class="string">" ; description = "</span></span><br><span class="line">						+ annotation.name() + <span class="string">"; gid= "</span> + annotation.gid());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> parseConstructAnnotation() &#123;</span><br><span class="line">		//通过反射获取构造器</span><br><span class="line">		<span class="type">Constructor</span>[] constructors = <span class="type">UserAnnotation</span>.class.getConstructors();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">Constructor</span> constructor : constructors) &#123;</span><br><span class="line"></span><br><span class="line">			boolean hasAnnotation = constructor</span><br><span class="line">					.isAnnotationPresent(<span class="type">TestA</span>.class);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (hasAnnotation) &#123;</span><br><span class="line">				<span class="type">TestA</span> annotation = (<span class="type">TestA</span>) constructor</span><br><span class="line">						.getAnnotation(<span class="type">TestA</span>.class);</span><br><span class="line">				</span><br><span class="line">				/*</span><br><span class="line">				 * constructor = test13.<span class="type">UserAnnotation</span> ; id = <span class="number">2</span> ; description = construct; gid= class java.lang.<span class="type">Long</span></span><br><span class="line">				 */</span><br><span class="line">				<span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"constructor = "</span> + constructor.getName()</span><br><span class="line">						+ <span class="string">" ; id = "</span> + annotation.id() + <span class="string">" ; description = "</span></span><br><span class="line">						+ annotation.name() + <span class="string">"; gid= "</span> + annotation.gid());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> main(<span class="type">String</span>[] args) throws <span class="type">ClassNotFoundException</span> &#123;</span><br><span class="line">		parseTypeAnnotation();</span><br><span class="line">		parseMethodAnnotation();</span><br><span class="line">		parseConstructAnnotation();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-java-reflect" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/27/java-reflect/" class="article-date">
  	<time datetime="2015-12-26T16:00:00.000Z" itemprop="datePublished">2015-12-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/27/java-reflect/">Java反射机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>最近的项目中，需要根据客户端传入的id来动态的实例化对象，所以学习了一下java的反射机制；</li>
</ul>
<h3 id="反射的定义">反射的定义</h3><ul>
<li>反射是指程序可以访问、检测和修改它本身状态或行为的一种能力，并能根据自身行为的状态和结果，调整或修改应用所描述行为的状态和相关的语义；</li>
<li>import是在程序编译时，静态引入相应类，反射是程序运行时，根据某一字符串，访问、创建这个字符串描述的类或是它的方法；</li>
</ul>
<h3 id="反射的作用">反射的作用</h3><ul>
<li>在运行时判断任意一个对象所属的类 ；</li>
<li>在运行时构造任意一个类的对象 ；</li>
<li>在运行时判断任意一个类所具有的成员变量和方法 ；</li>
<li>在运行时调用任意一个对象的方法；</li>
</ul>
<h3 id="反射所需的API">反射所需的API</h3><p>都位于java.lang.reflect包中：</p>
<ul>
<li>Class类：代表一个类，位于java.lang包下；</li>
<li>Field类：代表类的成员变量（成员变量也称为类的属性）；</li>
<li>Method类：代表类的方法；</li>
<li>Constructor类：代表类的构造方法；</li>
<li>Array类：提供了动态创建数组，以及访问数组的元素的静态方法；</li>
</ul>
<h3 id="反射实例">反射实例</h3><ul>
<li>获取Class对象：</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> Employee &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">		<span class="keyword">Class</span> c1 = <span class="keyword">Class</span>.forName(<span class="string">"test12.Employee"</span>);</span><br><span class="line">		<span class="keyword">Class</span> c2 = Employee.<span class="keyword">class</span>;  </span><br><span class="line">		Employee e = <span class="keyword">new</span> Employee();  </span><br><span class="line">		<span class="keyword">Class</span> c3 = e.getClass(); </span><br><span class="line">		</span><br><span class="line">		System.out.<span class="keyword">println</span>(c1);  <span class="comment">//class test12.Employee</span></span><br><span class="line">		System.out.<span class="keyword">println</span>(c2);  <span class="comment">//class test12.Employee</span></span><br><span class="line">		System.out.<span class="keyword">println</span>(c3);  <span class="comment">//class test12.Employee</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取所有成员变量:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) </span><br><span class="line">			<span class="keyword">throws</span> <span class="type">ClassNotFoundException</span>, <span class="type">InstantiationException</span>, <span class="type">IllegalAccessException</span>, </span><br><span class="line">			<span class="type">NoSuchMethodException</span>, <span class="type">SecurityException</span>, <span class="type">IllegalArgumentException</span>, <span class="type">InvocationTargetException</span> &#123;</span><br><span class="line">		<span class="type">Class</span>&lt;?&gt; <span class="built_in">c</span> = <span class="type">Class</span>.forName(<span class="string">"test12.test"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//获取所有成员变量</span></span><br><span class="line">		<span class="type">Field</span>[] f = <span class="built_in">c</span>.getFields();</span><br><span class="line">		<span class="keyword">for</span>(int i =<span class="number">0</span>; i&lt;f.length; i++)&#123;</span><br><span class="line">			<span class="type">System</span>.out.<span class="built_in">println</span>(f[i]);  <span class="comment">//public int test12.test.c</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取特定的成员变量:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) </span><br><span class="line">			<span class="keyword">throws</span> <span class="type">ClassNotFoundException</span>, <span class="type">InstantiationException</span>, <span class="type">IllegalAccessException</span>, </span><br><span class="line">			<span class="type">NoSuchMethodException</span>, <span class="type">SecurityException</span>, <span class="type">IllegalArgumentException</span>, <span class="type">InvocationTargetException</span>, <span class="type">NoSuchFieldException</span> &#123;</span><br><span class="line">		<span class="type">Class</span>&lt;?&gt; <span class="built_in">c</span> = <span class="type">Class</span>.forName(<span class="string">"test12.test"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//获取特定成员变量</span></span><br><span class="line">		<span class="type">Field</span> f = <span class="built_in">c</span>.getField(<span class="string">"c"</span>);</span><br><span class="line">		<span class="type">System</span>.out.<span class="built_in">println</span>(f);  <span class="comment">//public int test12.test.c</span></span><br><span class="line">		<span class="type">Field</span> f1 = <span class="built_in">c</span>.getField(<span class="string">"d"</span>);  <span class="comment">//java.lang.NoSuchFieldException</span></span><br><span class="line">		<span class="type">System</span>.out.<span class="built_in">println</span>(f1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取所有方法:</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Method</span>;</span><br><span class="line"></span><br><span class="line">public class <span class="type">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> main(<span class="type">String</span>[] args) throws <span class="type">ClassNotFoundException</span> &#123;</span><br><span class="line">		<span class="type">Class</span> c = <span class="type">Class</span>.forName(<span class="string">"java.lang.String"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">Method</span>[] methods = c.getDeclaredMethods();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">Method</span> <span class="keyword">method</span> : methods) &#123;</span><br><span class="line">			<span class="type">System</span>.<span class="keyword">out</span>.println(<span class="keyword">method</span>);  //输出所有方法</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取特定的方法并调用之</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">InvocationTargetException</span>;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Method</span>;</span><br><span class="line"></span><br><span class="line">public class <span class="type">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> main(<span class="type">String</span>[] args) </span><br><span class="line">			throws <span class="type">ClassNotFoundException</span>, <span class="type">InstantiationException</span>, <span class="type">IllegalAccessException</span>, </span><br><span class="line">			<span class="type">NoSuchMethodException</span>, <span class="type">SecurityException</span>, <span class="type">IllegalArgumentException</span>, <span class="type">InvocationTargetException</span> &#123;</span><br><span class="line">		<span class="type">Class</span> c = <span class="type">Class</span>.forName(<span class="string">"test12.test"</span>);</span><br><span class="line"></span><br><span class="line">		//获取方法</span><br><span class="line">		<span class="type">Object</span> t = c.newInstance();</span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(t instanceof test);  //<span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        //调用方法</span><br><span class="line">        <span class="type">Method</span> stringMethod = c.getDeclaredMethod(<span class="string">"plus"</span>, new <span class="type">Class</span>[]&#123;<span class="type">int</span>.class, <span class="type">int</span>.class&#125;);</span><br><span class="line">        <span class="type">Object</span> <span class="literal">result</span> = stringMethod.invoke(t, new <span class="type">Object</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>&#125;);</span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="literal">result</span>);  //<span class="number">3</span></span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="literal">result</span> instanceof <span class="type">Integer</span>);  //<span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test类</span></span><br><span class="line"><span class="keyword">package</span> test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">plus</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a+b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>动态生成对象（构造器不含参数）</li>
</ul>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Class</span>&lt;?&gt; classType = <span class="keyword">String</span>.<span class="keyword">class</span>;</span><br><span class="line"><span class="keyword">Object</span> obj = classType.newInstance();</span><br></pre></td></tr></table></figure>
<ul>
<li>动态生成对象（构造器含参数）:</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">InvocationTargetException</span>;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Method</span>;</span><br><span class="line"></span><br><span class="line">public class <span class="type">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="type">void</span> main(<span class="type">String</span>[] args) </span><br><span class="line">			throws <span class="type">ClassNotFoundException</span>, <span class="type">InstantiationException</span>, <span class="type">IllegalAccessException</span>, </span><br><span class="line">			<span class="type">NoSuchMethodException</span>, <span class="type">SecurityException</span>, <span class="type">IllegalArgumentException</span>, <span class="type">InvocationTargetException</span> &#123;</span><br><span class="line">		<span class="type">Class</span> c = <span class="type">Class</span>.forName(<span class="string">"test12.test"</span>);</span><br><span class="line"></span><br><span class="line">		//获取构造器并实例化类</span><br><span class="line">		<span class="type">Constructor</span> cons = c.getConstructor(new <span class="type">Class</span>[] &#123;<span class="type">int</span>.class, <span class="type">int</span>.class&#125;);</span><br><span class="line">		<span class="type">Object</span> obj = cons.newInstance(new <span class="type">Object</span>[] &#123;<span class="number">10</span>,<span class="number">20</span>&#125;);</span><br><span class="line">        </span><br><span class="line">        //调用方法</span><br><span class="line">        <span class="type">Method</span> stringMethod = c.getDeclaredMethod(<span class="string">"plus"</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="literal">result</span> = stringMethod.invoke(obj);</span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="literal">result</span>);  //<span class="number">30</span></span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="literal">result</span> instanceof <span class="type">Integer</span>);  //<span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test类</span></span><br><span class="line"><span class="keyword">package</span> test12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> b;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.a = a;</span><br><span class="line">		<span class="keyword">this</span>.b = b;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">plus</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a+b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-java-polymorphism" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/25/java-polymorphism/" class="article-date">
  	<time datetime="2015-12-24T16:00:00.000Z" itemprop="datePublished">2015-12-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/25/java-polymorphism/">Java中的多态</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>最近研究了一下java中的多态这一java特有的非常优秀的特性；</li>
<li>多态增加了程序的灵活性和可扩展性，但是也对程序的安全性和稳定性提出了挑战；</li>
</ul>
<h3 id="多态的概念">多态的概念</h3><ul>
<li>多态的定义：指允许不同类的对象对同一消息做出响应，即同一消息可以根据发送对象的不同而采用多种不同的行为方式（发送消息就是函数调用）；</li>
<li>多态的分类：编译时多态（方法的重载就是其具体实现），运行时多态（本文中的多态均指运行时多态）；</li>
<li>实现多态的技术是动态绑定（dynamic binding）：是指在执行期间判断所引用对象的实际类型，根据其实际的类型调用其相应的方法；</li>
<li>多态的作用：消除类型之间的耦合关系；</li>
</ul>
<h3 id="多态存在的条件">多态存在的条件</h3><ul>
<li>要有继承（包括接口的实现）；</li>
<li>要有重写；</li>
<li>父类引用指向子类对象；</li>
</ul>
<h3 id="实例">实例</h3><ul>
<li>父类如下：</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package test11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseClass</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> a = <span class="number">6</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">base</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		System.<span class="keyword">out</span>.println(<span class="string">"父类普通方法"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		System.<span class="keyword">out</span>.println(<span class="string">"父类被覆盖方法"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>子类如下：</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test11;</span><br><span class="line"></span><br><span class="line">public class SubClass extends BaseClass&#123;</span><br><span class="line">	public <span class="keyword">int</span> b = <span class="number">8</span>;</span><br><span class="line">	public <span class="keyword">int</span> a = <span class="number">8</span>;</span><br><span class="line">	public void test()&#123;</span><br><span class="line">		System.out.println(<span class="string">"子类覆盖父类的test方法"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void <span class="sub"><span class="keyword">sub</span>()&#123;</span></span><br><span class="line">		System.out.println(<span class="string">"子类普通方法"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		BaseClass base = new BaseClass();</span><br><span class="line">		SubClass <span class="sub"><span class="keyword">sub</span> = new SubClass();</span></span><br><span class="line">		BaseClass bc = new SubClass();</span><br><span class="line">		<span class="regexp">//</span>SubClass sb = new BaseClass();  <span class="regexp">//</span>编译时报错，不能从父类到子类强制转换</span><br><span class="line"></span><br><span class="line">		System.out.println(base.a);  <span class="regexp">//</span><span class="number">6</span></span><br><span class="line">		//System.out.println(base.b);  <span class="regexp">//</span>报错，因为BaseClass没有变量b</span><br><span class="line">		base.base();  <span class="regexp">//</span>父类普通方法</span><br><span class="line">		base.test();  <span class="regexp">//</span>父类被覆盖方法</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="sub"><span class="keyword">sub</span>.b);</span>  //<span class="number">8</span></span><br><span class="line">		System.out.println(<span class="sub"><span class="keyword">sub</span>.a);</span>  //<span class="number">8</span></span><br><span class="line">		<span class="sub"><span class="keyword">sub</span>.test();</span>  //子类覆盖父类的test方法</span><br><span class="line">		<span class="sub"><span class="keyword">sub</span>.<span class="keyword">sub</span>();</span>  //子类普通方法</span><br><span class="line">		<span class="sub"><span class="keyword">sub</span>.base();</span>  //父类普通方法</span><br><span class="line">		</span><br><span class="line">		//System.out.println(bc.b);  <span class="regexp">//</span>编译时报错，编译时bc是BaseClass类，不含有变量b</span><br><span class="line">		System.out.println(bc.a);  <span class="regexp">//</span><span class="number">6</span>，因为变量没有多态的特性</span><br><span class="line">		bc.test();  <span class="regexp">//</span>子类覆盖父类的test方法</span><br><span class="line">		//bc.sub();  <span class="regexp">//</span>编译时报错，编译时bc是BaseClass类，不含有方法<span class="sub"><span class="keyword">sub</span>()</span><br><span class="line">		bc.base();</span>  //父类普通方法</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>BaseClass base = new BaseClass();</code>定义base为父类，可访问所有父类的变量和方法；</li>
<li><code>SubClass sub = new SubClass();</code>定义为子类，优先访问子类中的变量和方法，如果没有，再从父类寻找；</li>
<li>对于<code>BaseClass bc = new SubClass();</code>:<ul>
<li>编译时，系统首先new出来一个SubClass类的实例，系统自动将这个new出来的实例强制转换为BaseClass类型，并且赋给bc对象；</li>
<li>运行时，bc对象名义上是BaseClass类型，实际上是SubClass类型，bc对象可访问且优先访问SubClass类中的方法，找不到的话再到它的父类BaseClass寻找；</li>
<li>尽管bc对象在运行时是SubClass类型，bc对象在运行时是可以访问SubClass自己的方法的（比如sub()方法），但是由于bc对象在编译时是BaseClass类型，bc.sub()这一句话根本通不过编译，所以运行时bc对象实际上是不能访问sub()方法的；</li>
<li>在编译时，base和bc对象都是BaseClass类型的对象，但是在运行时base仍为BaseClass类型，bc却是SubClass类型，这就出现了base和bc这两个编译时相同类型的变量，在运行时调用test()方法的结果却不一致的现象，就是多态；</li>
<li>多态性只对方法有效，对于变量无效，所以访问bc对象的a变量时，输出父类的a变量而非子类的a变量值，这和java内部运行机制有关；</li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-latex" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/20/latex/" class="article-date">
  	<time datetime="2015-12-19T16:00:00.000Z" itemprop="datePublished">2015-12-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/20/latex/">Latex使用方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>最近要写论文，所以粗浅学了下Latex的使用方法；</li>
<li>本文将Latex常用的语法和工具做个总结，大多数是借鉴和引用别人的博客；</li>
</ul>
<h3 id="Latex">Latex</h3><ul>
<li>Latex是一种排版工具，借助于特定的语法实现论文、书籍等的排版；</li>
<li>想要实现用Latex排版一篇论文，需要以下几个工具或软件：<ul>
<li>学习Latex语法；</li>
<li>安装Latex解析器和Latex的pdf生成工具，本文选用TexLive2015；</li>
<li>安装一款适合自己的Latex编辑器，本文选用Texmaker；</li>
</ul>
</li>
</ul>
<h3 id="TexLive2015">TexLive2015</h3><ul>
<li>教程请点击<a href="http://tieba.baidu.com/p/3524644809" target="_blank" rel="external">这里</a>；</li>
<li>iso镜像文件下载地址：<ul>
<li><a href="http://mirror.ctan.org/systems/texlive/Images/texlive2015.iso" target="_blank" rel="external">地址一</a>;</li>
<li><a href="http://pan.baidu.com/s/1gdrjVIb" target="_blank" rel="external">地址二</a>，密码txt3；</li>
</ul>
</li>
<li>安装方法：解压iso文件后，双击批处理文件install-tl-advanced，选择安装目录后，即可安装；</li>
</ul>
<p><img src="/images/Latex/latex1.png" alt="latex1"></p>
<p><img src="/images/Latex/latex2.png" alt="latex1"></p>
<h3 id="Latex编辑器">Latex编辑器</h3><ul>
<li>texLive软件自带编辑器teXworks editor；</li>
<li>也可选用其它编辑器：<a href="http://www.xm1math.net/texmaker/download.html" target="_blank" rel="external">textmarker</a>、<a href="http://www.texstudio.org/" target="_blank" rel="external">teXstudio</a>、<a href="https://www.sharelatex.com/" target="_blank" rel="external">在线编辑器sharelatex</a>、<a href="http://www.zhihu.com/question/19954023" target="_blank" rel="external">其他编辑器</a>;</li>
</ul>
<h3 id="Latex常用语法">Latex常用语法</h3><ul>
<li>教程<ul>
<li><a href="http://www.cnblogs.com/billin/archive/2011/12/29/2306145.html" target="_blank" rel="external">入门教程</a>；</li>
<li><a href="http://www.cnblogs.com/ywl925/p/3671827.html" target="_blank" rel="external">排版和格式</a>；</li>
<li><a href="https://latex-project.org/guides/usrguide.pdf" target="_blank" rel="external">官方教程</a>；</li>
</ul>
</li>
<li>数学常用<ul>
<li><a href="http://blog.163.com/goldman2000@126/blog/static/167296895201221242646561/" target="_blank" rel="external">数学公式</a>;</li>
<li><a href="http://blog.sina.com.cn/s/blog_4c88d09a0100u9jx.html" target="_blank" rel="external">括号</a>;</li>
<li><a href="http://www.mohu.org/info/symbols/symbols.htm" target="_blank" rel="external">数学符号</a>;</li>
<li><a href="http://blog.chinaunix.net/uid-25985452-id-3213715.html" target="_blank" rel="external">希腊字母</a>;</li>
</ul>
</li>
</ul>
<h3 id="生成参考文献">生成参考文献</h3><ul>
<li>进入<a href="https://scholar.google.com.hk/" target="_blank" rel="external">谷歌学术</a>；</li>
<li>点击谷歌学术的设置按钮，选择“显示导入BibTex的链接”；</li>
</ul>
<p><img src="/images/Latex/latex3.png" alt="latex1"></p>
<ul>
<li>在谷歌学术中所搜所需的文章，点击文章下面的导出BibTex按钮，即可自动生成该文章的BibTex的引用信息；</li>
</ul>
<p><img src="/images/Latex/latex4.png" alt="latex1"></p>
<p><img src="/images/Latex/latex5.png" alt="latex1"></p>
<ul>
<li>添加一个名为”myreference.bib”的文件，放在和.tex文件的同一目录下，将上面生成的BibTex复制进去；</li>
<li>在.tex文件的需要添加参考文献的地方（必须是<code>\end{document}</code>之前）添加下面的代码：</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">\bibliographystyle&#123;plain&#125;</span>  <span class="comment">## 设置参考文献的类型，plain代表标准类型</span></span><br><span class="line"><span class="string">\bibliography&#123;myreference.bib&#125;</span>  <span class="comment">## 设置bib文件的名称，让latex编译器能够找到bib文件</span></span><br></pre></td></tr></table></figure>
<ul>
<li>我用的编辑器是Texmaker，点击工具&gt;BibTex，编译bib文件；</li>
<li>bib文件编译好后，再编译.tex文件（运行.tex文件），即可看到效果：</li>
</ul>
<p><img src="/images/Latex/latex6.png" alt="latex1"></p>
<ul>
<li>引用参考文献：</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\cite&#123;文章名称&#125;   <span class="comment">## 文章名称是指写在bib文件中的<span class="doctag">@article</span>后面的内容</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Latex/">Latex</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/others/">others</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-JavaEE-Web-standard" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/15/JavaEE-Web-standard/" class="article-date">
  	<time datetime="2015-12-14T16:00:00.000Z" itemprop="datePublished">2015-12-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/15/JavaEE-Web-standard/">JavaEE Web开发规范汇总</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>在开发系统资源库项目的过程中，发现自己的代码有多处不规范之处；</li>
<li>本文总结了JavaEE Web的一些开发规范，尤其是RESTful设计模式的一些常见的规范，以警示自己编写代码必须要规范、可维护、可扩展；</li>
</ul>
<h3 id="数据库设计和命名规范">数据库设计和命名规范</h3><ul>
<li>库表名称、字段名称含义明确，并且使用snake_case命名，避免使用特殊符号和sql关键字；</li>
<li>字段应当具有原子性，不可再分；</li>
<li>Table用单数，Column用单数；</li>
<li>代表个数、次数等数量概念的，用count，比如<code>xxx_count</code>;</li>
<li>时间类型统一规定命名为xxx_date的形式，并且带上timezone；</li>
<li>boolean类型的命名要用<code>is_xxx</code>格式，比如在业务上删除一条记录时，并不会将本条记录真正从数据库中删除，而是将<code>is_deleted</code>字段置为相应的值；</li>
<li>每个表都要有主键，名称是id，类型为bigint；</li>
<li>一个字段不要有多个用途；</li>
<li>varchar的缺省长度是255，varchar(50)并不比varchar(255)节省空间，因为这个空间只在需要时才分配，而不会提前分配，使用varchar(255)可以提升系统的可持续性；</li>
<li>必须避免不同数据库表的数据冗余，数据冗余很容易造成数据的不一致性；</li>
<li>不同的数据库表间应当尽量解耦，这样可以保证每个表只存储他该存储的信息，库表间可用外键连接；</li>
<li>关于数据库表设计，可参考<a href="http://mp.weixin.qq.com/s?__biz=MzA5ODM5MDU3MA==&amp;mid=400370227&amp;idx=1&amp;sn=267d2ab7f58a7c3b9c5fabcb5aa0c2d6&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd" target="_blank" rel="external">这里</a>；</li>
</ul>
<h3 id="RESTful设计规范">RESTful设计规范</h3><ul>
<li>我画了一张图清晰地说明了再用Java开发Web应用时，如果使用RESTful设计模式，应该遵循的架构：</li>
</ul>
<p><img src="/images/RESTful_java_structure.png" alt="RESTful_java_structure"></p>
<ul>
<li>对上图的说明：<ul>
<li>REST层只向client提供数据接口，不进行数据查询和处理；</li>
<li>Service层向REST提供各种数据和服务，是进行数据处理最重要的一层；</li>
<li>DAO层内含有各种SQL语句，以便查询；</li>
<li>entity是数据库中一条记录的映射对象；</li>
<li>entity manager对象根据相关的配置文件（如persistence.xml），在EJB容器中，负责数据库连接的管理、释放等工作；</li>
<li>数据库保存数据；</li>
<li>不同的REST和Dao之间不要传递数据，如果一个Service需要另一个Service的数据，可相互传递；</li>
</ul>
</li>
<li>EntityManager实例化的两种方式：<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方法一：通过createEntityManagerFactory方法实例化</span></span><br><span class="line">EntityManager em = Persistence.createEntityManagerFactory(<span class="string">"cn.com.haohandata_ResourceStore_war_1.0-SNAPSHOTPU"</span>) .createEntityManager();</span><br><span class="line"><span class="comment">//方法二：通过@PersistenceContext注入</span></span><br><span class="line"><span class="annotation">@PersistenceContext</span>(unitName = <span class="string">"cn.com.haohandata_ResourceStore_war_1.0-SNAPSHOTPU"</span>) </span><br><span class="line"><span class="keyword">private</span> EntityManager em;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="RESTful_API设计规范（老师总结）">RESTful API设计规范（老师总结）</h3><ul>
<li>原则：<ul>
<li>资源（URL）永远是名词，操作（HTTP方法）永远是动词；</li>
<li>GET永远不应该修改对象内容;</li>
</ul>
</li>
<li>基本形式<ul>
<li><code>GET /weibo</code> - 获取微博列表</li>
<li><code>GET /weibo/12</code> - 获取某个微博</li>
<li><code>POST /weibo</code> - 创建微博</li>
<li><code>PUT /weibo/12</code> - 修改某个微博</li>
<li><code>PATCH /weibo/12</code> - 部分修改某个微博</li>
<li><code>DELETE /weibo/12</code> - 删除某个微博</li>
</ul>
</li>
<li>有关系的资源<ul>
<li><code>GET /weibo/12/comment</code> - 获取某个微博的评论列表</li>
<li><code>GET /weibo/12/comment/5</code> - 获取某个微博的某个评论</li>
<li><code>POST /weibo/12/comment</code> - 创建微博的评论</li>
<li><code>PUT /weibo/12/comment/5</code> - 修改某个微博的某个评论</li>
<li><code>PATCH /weibo/12/comment/5</code> - 部分修改某个微博的某个评论</li>
<li><code>DELETE /weibo/12/comment/5</code> - 删除某个微博的某个评论</li>
</ul>
</li>
<li>不太能归类为CRUD的操作<ul>
<li><code>PUT /weibo/12/like</code> - 给某个微博点赞</li>
<li><code>DELETE /weibo/12/like</code> - 删除某个微博的赞</li>
</ul>
</li>
<li>过滤、排序、搜索等<ul>
<li><code>GET /weibo?deleted=true</code> - 得到所有标记为删除的微博</li>
<li><code>GET /weibo?sort=-create-date</code> - 按照创建日期反序排序得到微博列表</li>
<li><code>GET /weibo?sort=comment-count,-create-date</code> - 先按微博评论数再按创建日期反序排序得到微博列表</li>
<li><code>GET /weibo?keyword=xxx</code> - 得到包含关键字xxx的微博列表</li>
<li><code>GET /weibo?keyword=xxx&amp;deleted=true&amp;sort=comment-count,-create-date</code> - 搜索关键字包含xxx的标记为删除的微博，按照评论数再按创建日期反序排序得到微博列表</li>
</ul>
</li>
<li>常用的查询可以独立出来<ul>
<li><code>GET /weibo/top10</code> - 得到最热前10名的微博列表</li>
</ul>
</li>
<li><a href="http://blog.jobbole.com/41233/" target="_blank" rel="external">这里</a>写得非常不错</li>
</ul>
<h3 id="编写Java代码需要注意">编写Java代码需要注意</h3><ul>
<li>参考<a href="http://www.codeceo.com/article/11-tips-to-coding-better.html" target="_blank" rel="external">这里</a></li>
<li>保持方法简短扼要</li>
<li>永远永远不要将同一个变量用于不同的目的</li>
<li>尽可能让变量和方法的名称能够描述要实现的功能</li>
<li>尽可能将变量定义在最靠近它们的地方</li>
<li>不要出现让人费解的数字</li>
<li>要像对待朋友一样对待你擅长的语言</li>
<li>不要逆常规而行</li>
<li>千万小心过早的优化代码</li>
<li>要常常重构经过测试的代码</li>
<li>不要沉溺于过度的设计技巧</li>
<li>随时随地学习新的知识</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RESTful/">RESTful</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Eric Chang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
	
	<a rel="license" href="http://creativecommons.org/licenses/by/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/cn/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by/3.0/cn/">知识共享署名 3.0 中国大陆许可协议</a>进行许可。
	
	<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','1BK1VZMDEA-ktxiBz_9B');
</script>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258423514'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1258423514%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
          
	
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>