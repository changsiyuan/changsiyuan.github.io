<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Eric Chang&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="~爱前端，爱生活~">
<meta property="og:type" content="website">
<meta property="og:title" content="Eric Chang's Blog">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Eric Chang's Blog">
<meta property="og:description" content="~爱前端，爱生活~">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eric Chang's Blog">
<meta name="twitter:description" content="~爱前端，爱生活~">
  
    <link rel="alternative" href="/atom.xml" title="Eric Chang&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">


	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/images/me.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/" style="font-family: Microsoft Yahei;">Eric Chang</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">归档</a></li>
				        
							<li><a href="/tags/feeling">感悟</a></li>
				        
							<li><a href="/tags/me">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/changsiyuan" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/2803286360" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:changsiyuan2011@126.com" title="mail">mail</a>
					        
								<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/preview?locale=zh_CN&trk=prof-0-sb-preview-primary-button" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Angularjs/" style="font-size: 11.25px;">Angularjs</a> <a href="/tags/JSONP/" style="font-size: 10px;">JSONP</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 18.75px;">JavaScript</a> <a href="/tags/Latex/" style="font-size: 10px;">Latex</a> <a href="/tags/Linkedlist/" style="font-size: 11.25px;">Linkedlist</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Operating-System/" style="font-size: 10px;">Operating System</a> <a href="/tags/RESTful/" style="font-size: 10px;">RESTful</a> <a href="/tags/Tree/" style="font-size: 11.25px;">Tree</a> <a href="/tags/Web/" style="font-size: 17.5px;">Web</a> <a href="/tags/books/" style="font-size: 11.25px;">books</a> <a href="/tags/computer/" style="font-size: 11.25px;">computer</a> <a href="/tags/cooking/" style="font-size: 11.25px;">cooking</a> <a href="/tags/css/" style="font-size: 12.5px;">css</a> <a href="/tags/datebase/" style="font-size: 13.75px;">datebase</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/feeling/" style="font-size: 17.5px;">feeling</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/glassfish/" style="font-size: 10px;">glassfish</a> <a href="/tags/hadoop/" style="font-size: 16.25px;">hadoop</a> <a href="/tags/hardware/" style="font-size: 10px;">hardware</a> <a href="/tags/hdfs/" style="font-size: 10px;">hdfs</a> <a href="/tags/html/" style="font-size: 11.25px;">html</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/jQuery/" style="font-size: 12.5px;">jQuery</a> <a href="/tags/javaEE/" style="font-size: 10px;">javaEE</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mapreduce/" style="font-size: 13.75px;">mapreduce</a> <a href="/tags/me/" style="font-size: 10px;">me</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/node-js/" style="font-size: 10px;">node.js</a> <a href="/tags/others/" style="font-size: 11.25px;">others</a> <a href="/tags/psychology/" style="font-size: 11.25px;">psychology</a> <a href="/tags/publicity/" style="font-size: 10px;">publicity</a> <a href="/tags/selenium/" style="font-size: 10px;">selenium</a> <a href="/tags/translation/" style="font-size: 11.25px;">translation</a> <a href="/tags/travel/" style="font-size: 10px;">travel</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.ruanyifeng.com/home.html">阮一峰</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://es6.ruanyifeng.com/#README">ES6</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">MDN-JavaScript</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.uisdc.com/">优设网</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我叫常思源，毕业于北京邮电大学。专注前端开发事业。虽然在很多方面仍是小白，但我会不断努力哒~</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Eric Chang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/images/me.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Eric Chang</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">归档</a></li>
		        
					<li><a href="/tags/feeling">感悟</a></li>
		        
					<li><a href="/tags/me">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/changsiyuan" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/2803286360" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:changsiyuan2011@126.com" title="mail">mail</a>
			        
						<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/preview?locale=zh_CN&trk=prof-0-sb-preview-primary-button" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2015-10-2-datebase-conflict" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/02/2015-10-2-datebase-conflict/" class="article-date">
  	<time datetime="2015-10-01T16:00:00.000Z" itemprop="datePublished">2015-10-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/02/2015-10-2-datebase-conflict/">数据库并发冲突的解决</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>数据库读写看似简单，其实蕴含着许多值得思考的问题；</li>
<li>并发读写是令数据库设计者头疼的问题，其实，这个问题不仅令数据库设计者困惑，对于数据库的使用者来说，如何从业务层面高效处理并发读写问题也是不小的挑战；</li>
<li>本文就此问题做简单探讨；</li>
</ul>
<h3 id="问题描述">问题描述</h3><ul>
<li>在多用户环境中，在同一时间可能会有多个用户更新相同的记录，这会产生冲突，具体为：<ul>
<li>丢失更新：一个事务的更新覆盖了其它事务的更新结果，就是所谓的更新丢失。例如：用户A把值从6改为2，用户B把值从2改为6，则用户A丢失了他的更新；</li>
<li>脏读：当一个事务读取其它完成一半事务的记录时，就会发生脏读取。例如：用户A,B看到的值都是6，用户B把值改为2，用户A读到的值仍为6；</li>
</ul>
</li>
</ul>
<h3 id="数据库层面的并发控制-悲观锁">数据库层面的并发控制-悲观锁</h3><ul>
<li>说明：<ul>
<li>假定本次读写一定会发生并发冲突，屏蔽一切可能违反数据完整性的操作；</li>
<li>适用于实际业务中冲突发生可能性较大的情况，比如很有可能不同的人同时修改同一条数据库记录；</li>
<li>如果实际业务中冲突发生可能性较小，则用悲观锁效率很低（因为上锁的代价大）；</li>
</ul>
</li>
<li>使用：<ul>
<li>操作之前先上锁；</li>
<li>需要使用数据库的锁机制，比如SQL SERVER 的TABLOCKX（排它表锁） 此选项被选中时，SQL  Server将在整个表上置排它锁直至该命令或事务结束，这将防止其他进程读取或修改表中的数据；</li>
</ul>
</li>
</ul>
<h3 id="数据库层面的并发控制-乐观锁">数据库层面的并发控制-乐观锁</h3><ul>
<li>说明：<ul>
<li>假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性，乐观锁不能解决脏读的问题；</li>
<li>适用于实际业务中冲突发生可能性较小的情况，比如几乎不可能不同的人同时修改同一条数据库记录；</li>
</ul>
</li>
<li>使用：<ul>
<li>数据表中专门有一个version字段（int型）记录版本信息；</li>
<li>每当这条记录改动时，这条记录对应的version字段增1；</li>
<li>每次更新时检查版本号是否一致，比如数据库中数据版本为6，更新提交时version=6+1,使用该version值(=7)与数据库version+1(=7)作比较，如果相等，则可以更新，如果不等则有可能其他程序已更新该记录，所以返回错误；</li>
</ul>
</li>
</ul>
<h3 id="结论">结论</h3><ul>
<li>在实际生产环境里边，如果并发量不大且不允许脏读，可以使用悲观锁解决并发问题；</li>
<li>但如果系统的并发非常大的话,悲观锁定会带来非常大的性能问题,所以我们就要选择乐观锁定的方法；</li>
<li>上面介绍的锁都是数据库层面的锁，其实，如果从业务层面来看，上面的并发控制机制还是不够的，在数据库设计时，可以设计lock字段，如果要暂时锁定某些行，令lock=1时视为锁定，业务锁面向业务，更加可靠；</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/datebase/">datebase</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/datebase/">datebase</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-10-1-http-improve-web" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/01/2015-10-1-http-improve-web/" class="article-date">
  	<time datetime="2015-09-30T16:00:00.000Z" itemprop="datePublished">2015-10-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/01/2015-10-1-http-improve-web/">面向HTTP的Web性能提升方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>前端优化是个永恒的课题</li>
<li>前端优化的方案非常多，诸如加快脚本加载速度、缓存优化、提升js执行效率、运用ajax技术等等；</li>
<li>本文重点介绍面向HTTP的一些Web性能提升方案；</li>
</ul>
<h3 id="到底发生什么了？">到底发生什么了？</h3><ul>
<li>建立TCP连接<ul>
<li>为了进行可靠的数据传输，TCP在进行发送数据之前，会进行TCP三次握手，以此确定接收方能够成功收取传输的数据，而建立连接的过程，必然是要耗费系统资源，以及时间资源的。</li>
</ul>
</li>
<li>服务端处理并响应<ul>
<li>当服务端接收到客户端发送来的请求之后，如果请求内容是静态资源，服务端会从硬盘中取出静态资源，然后将静态资源放在响应主体中，发送给客户端。如果是动态资源，服务端首先取出资源，并通过业务逻辑操作，动态生成最终的响应主体，然后发送给客户端。</li>
</ul>
</li>
<li>客户端渲染<ul>
<li>客户端接受到服务端传输过来的网络资源，然后进行渲染，绘制等，最终展示给用户。</li>
</ul>
</li>
</ul>
<h3 id="优化点一：持久连接Keep-Alive">优化点一：持久连接Keep-Alive</h3><ul>
<li>HTTP连接设计之初是请求-响应-关闭，也就是每建立一次HTTP连接，只能进行一次资源请求，当需要在同一目标服务器上获取多个资源的时候，就需要多次建立HTTP连接，而这个多次建立连接的过程，便降低了网站的性能。</li>
<li>于是，出现了Connection:Keep-Alive，人称持久连接。Keep-Alive避免了建立或者说重新建立连接的过程，减少了HTTP连接。</li>
<li>而与此配套的有Keep-Alive:timeout=120,max=5</li>
<li>其中,timeout=120 是指这个TCP通道保持120S，max=5 指这个TCP通道最多接收5个HTTP请求，之后便自动关闭该连接。</li>
</ul>
<h3 id="优化点二：修改时间Last-Modified_和_If-Modified-Since">优化点二：修改时间Last-Modified 和 If-Modified-Since</h3><ul>
<li>Last-Modified首部是服务端对客户端的HTTP响应所加的一个与缓存有关的HTTP首部，该首部标记了所请求资源在服务端的最后修改时间。类似：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Last-Modified : Fri , <span class="number">12</span> May <span class="number">2015</span> <span class="number">13</span>:<span class="number">10</span>:<span class="number">33</span> GMT</span><br></pre></td></tr></table></figure>
<ul>
<li>当客户端发现HTTP响应头中有Last-Modified，会对资源进行缓存，在下次请求资源时，在HTTP请求头中添加If-Modified-Since首部，首部中将会添加上次成功请求资源时响应头部的Last-Modified属性值，即：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Modified-Since : Fri , <span class="number">12</span> May <span class="number">2015</span> <span class="number">13</span>:<span class="number">10</span>:<span class="number">33</span> GMT</span><br></pre></td></tr></table></figure>
<ul>
<li>当服务端接收到的HTTP请求中，发现有If-Modified-Since头部时，会将该属性值与请求资源的最后修改时间进行比对，如果最后修改时间与该属性值一致时，服务端会返回一个304 Not Modified响应，该响应中不包括响应实体。浏览器收到304的响应后，会进行重定向，获取本地缓存资源。如果最后修改时间与该属性值不一致，则会从服务端重新获取资源，做出200响应。</li>
</ul>
<h3 id="优化点三：版本标记_ETag_和_If-None-Match">优化点三：版本标记 ETag 和 If-None-Match</h3><ul>
<li>ETag其实与Last-Modified是差不多的方式，但是ETag并没有选择以时间作为标记，而是对所请求文件进行某些算法来生成一串唯一的字符串，作为对某一文件的标记。当收到客户端对某一资源的请求时，服务端在响应时，添加ETag首部,如下：</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">ETag</span><span class="symbol">:W/<span class="string">"a627ff1c9e65d2dede2efe0dd25efb8c"</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>当客户端发现ETag头部时，同样会对资源进行缓存，并在下次请求时，在请求头部添加If-None-Match，如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">If</span>-<span class="constant">None</span>-<span class="constant">Match</span><span class="symbol">:W/<span class="string">"a627ff1c9e65d2dede2efe0dd25efb8c"</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当服务端收到请求中含有该头部时，会使用同样的ETag生成算法对文件ETag进行计算，并与If-None-Match属性值进行比对，如果一致，则返回一个304 Not Modified响应，基本与上一种方式是一致的。</p>
</li>
</ul>
<h3 id="优化点四：缓存时间_Expires_和_Cache-Control">优化点四：缓存时间 Expires 和 Cache-Control</h3><ul>
<li><p>上述两种方式中，每次请求资源时，虽然在有缓存的情况下，选择缓存进行渲染绘制，但是在这之前还是发起了一次HTTP请求，虽然并没有真实的响应实体，但是依然会造成一些资源消耗。而Expires与上述两种方式使用了不同的思路。</p>
</li>
<li><p>当服务端希望客户端浏览器对某一资源进行缓存时，为了免去客户端每次都要询问自己：我上次的缓存现在还能用吗？所以，服务端选择了放权。只去告诉浏览器，我这次给你的资源你可以用多长时间，在这个时间段内，你可以一直使用它，无需每次咨询我。而服务端就是通过Expires属性来告诉客户端浏览器可以多长时间内不需要询问服务端。如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expires:Thu, <span class="number">19</span> Nov <span class="number">2015</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">00</span> GMT</span><br></pre></td></tr></table></figure>
</li>
<li><p>当客户端在响应首部中发现该属性值时，便会将该资源缓存起来，而缓存的过期时间即是Expires中的时间。在这个时间段内，浏览器完全自主。</p>
</li>
<li>但是，Expires有一个不足的地方是，如果服务端时间与客户端本地时间不统一时，可能服务端让客户端可以对该资源缓存一个小时，而客户端本地时间比服务端时间快了两个小时，那就意味着，所有缓存都将不会生效。</li>
<li><p>于是有了弥补该不足的一个属性，即：Cache-Control。如果服务端在响应首部添加该属性时，客户端将直接使用该属性值来生成本地时间的缓存过期时间，这样便解决了这个问题，如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Cache</span>-<span class="constant">Control</span><span class="symbol">:max-age=</span><span class="number">3600</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果客户端在2015年10月01日13时00分00秒收到该响应时，便会加上3600秒也就是2015年10月01日14时00分00秒作为缓存过期时间。如果响应头部既有Expires和Cache-Control，浏览器会首选Cache-Control。</p>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Web/">Web</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-9-12-five-layer" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/12/2015-9-12-five-layer/" class="article-date">
  	<time datetime="2015-09-11T16:00:00.000Z" itemprop="datePublished">2015-09-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/12/2015-9-12-five-layer/">计算机网络五层结构功能汇总</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><blockquote>
<ul>
<li>网上有很多博客介绍过计算机网络五层结构，但专门汇总五层结构功能的博文非常少；</li>
<li>本文从纵向的角度，清晰概述计算机网络五层结构的功能和特点；</li>
<li>本文总结了计算机网络五层结构的协议名和专用术语，并对一些结构性问题加以解释；</li>
<li>本文没有介绍五层结构的实现细节；</li>
</ul>
</blockquote>
<h3 id="五层结构的作用汇总">五层结构的作用汇总</h3><table>
<thead>
<tr>
<th>层级名称</th>
<th>主要作用和功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>物理层</td>
<td>发送和接收比特流；<br>负责将比特流调制到载波上面（调幅、调频、调相）；<br>可以用信道复用等技术提升发送速率；</td>
</tr>
<tr>
<td>数据链路层</td>
<td>负责相邻设备间通信，这两个设备间没有交换节点，具体表现为点对点通信（PPP协议）和广播通信（CSMA/CD协议）；<br>用MAC地址识别参与通信的两个节点（源节点、目的节点），MAC地址是本层及以下层专用；<br>上层网络层根据目的IP确定下一跳IP地址，数据链路层(交换机)根据下一跳IP地址就能确定下一跳的MAC地址，并将网络层数据报再次封装，加上目的MAC地址，交由物理层传送；<br>负责帧的差错检测，丢弃错误的帧（只检错不纠错），错误可能是帧丢失、帧重复、帧失序；</td>
</tr>
<tr>
<td>网络层</td>
<td>负责不相邻的两个节点间的通信，比如我的电脑和网页服务器之间的通信；<br>用IP地址识别源地址、目的地址，IP地址是本层及以上层专用；<br>能够确定转发路线，使得效率最高；</td>
</tr>
<tr>
<td>运输层</td>
<td>识别并将数据报正确交付相应的应用程序，识别数据报属于哪个应用程序的方法为看端口；<br>TCP可靠传输，UDP不可靠传输；</td>
</tr>
<tr>
<td>应用层</td>
<td>使用得到的报文段，为用户提供各种服务（浏览器、邮件、远程通信）；<br>向上面向用户（域名给用户看），向下面向运输层和网络层（域名解析给他们看）；</td>
</tr>
</tbody>
</table>
<h3 id="五层结构传输单元名称">五层结构传输单元名称</h3><table>
<thead>
<tr>
<th>层级名称</th>
<th>传输单元名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层</td>
<td>报文</td>
</tr>
<tr>
<td>运输层</td>
<td>TCP：报文段；<br>UDP：用户数据报；</td>
</tr>
<tr>
<td>网络层</td>
<td>分组或IP数据报（简称数据报）</td>
</tr>
<tr>
<td>数据链路层</td>
<td>帧</td>
</tr>
<tr>
<td>物理层</td>
<td>比特</td>
</tr>
</tbody>
</table>
<h3 id="各层协议和专用术语汇总">各层协议和专用术语汇总</h3><table>
<thead>
<tr>
<th>层级名称</th>
<th>传输单元名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层</td>
<td>网际组管理协议IGMP：使得连接在本局域网上的多播路由器知道本局域网上是否有主机（指主机上的进程）参加或退出某个多播组；<br>DNS：域名系统；<br>简单文件传送协议TFTP；<br>文件传送协议FTP；<br>NFS：网络文件系统；<br>动态主机配置协议DHCP：用于自动分配IP地址；<br>简单网络管理协议SNMP；<br>简单邮件传送协议SMTP：用于发送邮件；<br>邮件读取协议POP和IMAP：用于读取邮件；<br>远程终端协议TELNET；<br>超文本传送协议HTTP；<br>socket：IP和端口统称套接字，java语言中称为java socket编程；<br>安全外壳SSH（Secure Shell）：不是一种协议，是运用运输层SSL协议构建的一个类似telnet的应用，SSH = TELNET + SSL，和web开发框架中的SSH框架没有任何关系（SSH=Struts+Spring+Hibernate）；</td>
</tr>
<tr>
<td>运输层</td>
<td>传输控制协议TCP：面向连接；<br>用户数据报协议UDP：无连接；<br>安全套接层SSL：是一种在运输层对网络数据进行加密的协议;</td>
</tr>
<tr>
<td>网络层</td>
<td>地址解析协议ARP：已知一台机器的IP地址，需要找出其相对应的硬件MAC地址；<br>网际控制报文协议ICMP：分为ICMP差错报文和ICMP询问报文，用于主机和路由器报告差错和异常情况，ping命令是在应用层直接使用网络层协议的例子；<br>内部网关协议IGP：一个自治系统内部使用的路由协议，包括RIP和OSPF协议；<br>外部网关协议EGP：自治系统间路由协议，包括BGP协议；<br>VPN：虚拟专用网技术，用到了网络地址转换NAT技术；</td>
</tr>
<tr>
<td>数据链路层</td>
<td>PPP：点对点信道所使用的协议；<br>CSMA/CD：广播信道使用的协议；<br>MAC地址；</td>
</tr>
<tr>
<td>物理层</td>
<td>传输介质：双绞线、同轴电缆；<br>信道复用技术：频分复用、时分复用、码分复用；<br>宽带接入技术：ADSL（非对称用户数字线）；</td>
</tr>
</tbody>
</table>
<h3 id="各层典型设备">各层典型设备</h3><table>
<thead>
<tr>
<th>层级名称</th>
<th>设备名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层</td>
<td>网关：连接两个或多个使用不同协议的网络，充当“协议转换器”，是两个局域网之间的通道；</td>
</tr>
<tr>
<td>运输层</td>
<td>暂无</td>
</tr>
<tr>
<td>网络层</td>
<td>路由器：连接不同网络的设备，自动选择设定路由，寻找最佳路径，在某些情况下，路由器也被称做网关；</td>
</tr>
<tr>
<td>数据链路层</td>
<td>网卡（网络适配器）：当接收帧错误时就丢弃，正确时就交付网络层，内含MAC地址；<br>交换机：相当于多个网桥，将好多计算机连接成一个局域网，负责局域网内部的数据交换，相当于扩展的网桥，允许在还没把数据帧接受完全的情况下转发帧；<br>网桥/桥接器：把一个局域网隔离成许多网段，维护转发表，对收到的帧进行转发、过滤或丢弃（完全接收到一帧后才转发）；</td>
</tr>
<tr>
<td>物理层</td>
<td>集线器/转发器：简单转发比特，不维护任何表；</td>
</tr>
</tbody>
</table>
<h3 id="几个结构性问题的解释">几个结构性问题的解释</h3><blockquote>
<ul>
<li>为何不能只有MAC地址，IP地址没有行不行？</li>
</ul>
</blockquote>
<ul>
<li>这和”能不能只有数据链路层，没有网络层”的问题一样；</li>
<li>他们处理的是不同层面的事务，前者专注于相邻节点传输、后者则专注于不相邻节点传输；</li>
<li>这是”网络”这个事务由小到大、量变产生质变的必然选择；</li>
</ul>
<blockquote>
<ul>
<li>为何不将TCP可靠传输的任务交由网络层负责？</li>
</ul>
</blockquote>
<ul>
<li>其实这是”可靠”怎么理解的问题，如果网络层可靠了，但是在传输层不可靠，数据也无法正确及时的送达应用程序手中；</li>
<li>如果网络层和运输层都保证可靠，协议未免太过复杂，效率降低；</li>
<li>所以只在运输层保证可靠，是在效率、可靠性之间权衡做出的最佳选择；</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/computer/">computer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/network/">network</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/computer/">computer</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-9-11-css-use" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/11/2015-9-11-css-use/" class="article-date">
  	<time datetime="2015-09-10T16:00:00.000Z" itemprop="datePublished">2015-09-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/11/2015-9-11-css-use/">CSS技巧汇总</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>使用CSS渲染页面是当今网页常用的技术。</li>
<li>本文汇总了CSS使用时的注意事项和技巧。</li>
</ul>
<h3 id="浏览器支持">浏览器支持</h3><ul>
<li>webkit/safari/chrome：-webkit-；</li>
<li>firefox：-moz-；</li>
<li>IE：-ms-；</li>
<li>opera：-o-；</li>
<li>一般来说，对于下面介绍的一些较新的css3特性，为了兼容旧版浏览器，需要添加-webkit-前缀；</li>
</ul>
<h3 id="技巧汇总">技巧汇总</h3><table>
<thead>
<tr>
<th>描述</th>
<th>方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>改变控件的四个角的弧度</td>
<td>border-radius属性，另有border-top-left-radius、border-top-right-radius、border-bottom-right-radius、border-bottom-left-radius等扩展属性</td>
</tr>
<tr>
<td>改变input标签中placeholder的样式</td>
<td>使用伪类 input::-webkit-input-placeholder, textarea::-webkit-input-placeholder</td>
</tr>
<tr>
<td>使元素自由浮动</td>
<td>使用float属性</td>
</tr>
<tr>
<td>使元素从他自己的位置偏移</td>
<td>使用position:relative属性,配合left、right等属性使用</td>
</tr>
<tr>
<td>使元素固定位置</td>
<td>使用position:fixed属性，并配合z-index属性设置元素的层叠顺序</td>
</tr>
<tr>
<td>设置元素绝对位置</td>
<td>使用position:absolute属性</td>
</tr>
<tr>
<td>设置文字的位置</td>
<td>使用text-align属性</td>
</tr>
<tr>
<td>设置元素是否显示</td>
<td>使用display属性</td>
</tr>
<tr>
<td>设置元素溢出后样式</td>
<td>使用overflow属性</td>
</tr>
<tr>
<td>设置鼠标悬停样式</td>
<td>使用cursor属性</td>
</tr>
<tr>
<td>设置文本阴影</td>
<td>使用text-shadow属性，此属性为CSS3增强特性</td>
</tr>
<tr>
<td>设置元素透明度</td>
<td>使用opacity属性</td>
</tr>
</tbody>
</table>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Web/">Web</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-7-31-git-command" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/31/2015-7-31-git-command/" class="article-date">
  	<time datetime="2015-07-30T16:00:00.000Z" itemprop="datePublished">2015-07-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/31/2015-7-31-git-command/">git常用命令</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引言">引言</h2><ul>
<li>git是常用的版本管理工具</li>
<li>本文总结了git最常用的命令，应当熟记于心</li>
<li>使用git应当尽量使用命令行，这样可以帮助熟悉git的流程</li>
</ul>
<h2 id="配置和状态：">配置和状态：</h2><p>git status        git现在状态</p>
<p>git init         初始化git，生成 .git 文件；</p>
<h2 id="常用动作：">常用动作：</h2><p>git clone (url)        将工程的master分支clone下来；</p>
<p>git clone (url) (空格) (目录)        仅仅将repository某个目录clone到本地；</p>
<p>git clone (url) (空格) /(目录)        将git这个目录下的所有文件下载到本地这个目录下；</p>
<p>git  clone  -b  branchName  (url)        将一个分支clone到本地；</p>
<p>git  checkout  -b   csy_ui   origin/csy_ui_m     clone另一个分支到本地的新建分支中；</p>
<p>git checkout  branchName        切换到某个分支，在checkout前需保证当前分支已经commit，否则会报错；</p>
<p>git  merge  (被合并分支名称)      将被合并分支合并到当前分支，执行此命令后，没有冲突的都已经merge到当前分支，有冲突的会提示，用编辑器解决完冲突后，直接add以及commit即可完成整个merge过程，不用重新merge；</p>
<p>git branch test        新建名为test的分支；</p>
<p>git checkout -b test        新建名为test的分支，并checkout到该分支；</p>
<p>git add .        add改动到暂存区域；</p>
<p>git commit -a  -m “….”        commit改动到repository；</p>
<p>git push origin master        push到名字为origin的远端的master分支中；</p>
<p>git diff        对比当前分支在当前状态下和刚刚写换到这个分支的时候有什么不同，列出改动的文件和具体改动哪些内容；</p>
<p>git  mv  old_name new_name        重命名文件</p>
<h2 id="历史和记录：">历史和记录：</h2><p>git log/git log –graph        查看git历史动作</p>
<p>history        查看git命令历史记录</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/git/">git</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-7-30-files-encode" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/30/2015-7-30-files-encode/" class="article-date">
  	<time datetime="2015-07-29T16:00:00.000Z" itemprop="datePublished">2015-07-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/30/2015-7-30-files-encode/">进制、文件和编码的理解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引言">引言</h2><ul>
<li>进制、文件、编码是计算机系统的重要概念，应当理解；</li>
<li>本文介绍了进制、文件、编码应当掌握的基本内容</li>
</ul>
<h2 id="进制">进制</h2><ul>
<li>进制间转换<a href="http://jingyan.baidu.com/article/495ba84109665338b30ede98.html" target="_blank" rel="external">请戳这里</a>；</li>
</ul>
<h2 id="编码">编码</h2><ul>
<li>编码是信息从一种形式或格式转换为另一种形式的过程；</li>
<li>常见编码格式：ascii、GBK、UTF-8；</li>
<li>无论何种编码，最终要在计算机中以二进制形式存储，英文和中文占用字节数目不同，具体占用几个字节由编码方式决定；</li>
<li>计算机的文件分为二进制文件和文本文件，二进制文件是经过编译后的，用编辑器打开肯定是乱码，而文本文件中存储了此文件的编码方式，如果编辑器可以自动识别这个文本文件的编码方式，则用编辑器打开文本文件时就会自动正确解码，不会有乱码现象；</li>
</ul>
<h2 id="文件">文件</h2><ul>
<li>计算机的文件有两种：文本文件、二进制文件；</li>
<li>计算机的存储在物理上是二进制的，所以文本文件与二进制文件的区别并不是物理上的，而是逻辑上的，也可以说文本文件是二进制文件的特殊形式；</li>
<li>两者区别：<ul>
<li>文本文件是基于字符编码的文件，常见的编码有ASCII编码，UNICODE编码等等，先将文件中的人类可识别的字符转换为一串数字（具体怎么转换由编码方式决定），然后以二进制的形式存储在计算机中；</li>
<li>二进制文件是基于值编码的文件，你可以根据具体应用，指定某个值是什么意思；</li>
<li>文本文件能够用编辑器打开，二进制文件不能（乱码），二进制文件能够用特定的软件读取其中的内容（WinHex、UltraEdit）；</li>
</ul>
</li>
<li>例子1：<ul>
<li>文本文件：中文和英文文档、源代码文档；</li>
<li>二进制文件：经过编译后的.class文件、可执行文件.exe；</li>
</ul>
</li>
<li>例子2：<ul>
<li>如果用文本文件存储int类型的数字1，其中存储的是1的ascii码（假定用ascii编码）49（一个字节），再将49转换成二进制进行物理存储，读取的时候读到的是49，经过解码显示数字1；</li>
<li>如果用二进制文件存储int类型的数字1，由于int类型占用四个字节，故文件中存储的是四个字节00000000 00000000 00000000 00000001，在读取文件的时候应当告知以int方式读取，即四个四个字节读取；</li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/others/">others</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/others/">others</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-7-29-key-shortcuts" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/29/2015-7-29-key-shortcuts/" class="article-date">
  	<time datetime="2015-07-28T16:00:00.000Z" itemprop="datePublished">2015-07-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/29/2015-7-29-key-shortcuts/">常用快捷键</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引言">引言</h2><ul>
<li>本文分类总结了常用快捷键</li>
<li>编程时应当尽量使用键盘输入，避免过多的鼠标操作，可以提升编程效率</li>
<li>必要时可以为IDE安装emmet等插件，方便编程和开发</li>
</ul>
<h2 id="编辑：">编辑：</h2><p>ctrl+c：复制</p>
<p>ctrl+v：粘贴</p>
<p>ctrl+shift+v：无格式粘贴</p>
<p>ctrl+x：剪切</p>
<p>ctrl+f：查找</p>
<p>ctrl+z：返回上一状态</p>
<p>ctrl+y：返回下一状态</p>
<p>ctrl+s：保存</p>
<p>ctrl+a：全选</p>
<h2 id="windows系统：">windows系统：</h2><p>ctrl+tab：标签页切换</p>
<p>alt+tab：窗口切换</p>
<p>alt+滑轮：字体大小转换</p>
<p>windows+d：桌面</p>
<p>windows+e：打开计算机文件夹</p>
<p>windows+r：打开终端</p>
<p>启动按F12：显示启动项</p>
<h2 id="浏览器：">浏览器：</h2><p>F5：刷新；</p>
<p>F12：开发者工具；</p>
<p>Ctrl+U：查看源代码； </p>
<p>F11：全屏；</p>
<p>Ctrl+N：打开新窗口；</p>
<p>Alt+F4：关闭当前窗口；</p>
<p>Ctrl+T：打开新标签页；</p>
<p>Ctrl+W：关闭当前标签页或弹出式窗口；</p>
<p>Ctrl+Tab：切换到下一个标签页 ；</p>
<p>Ctrl+Shift+Tab：切换到上一个标签页；</p>
<p>Ctrl+1到Ctrl+8：切换到指定位置编号的标签页；</p>
<h2 id="linux系统：">linux系统：</h2><p>ctrl+alt+T：打开终端</p>
<p>ctrl+alt+L：锁屏</p>
<h2 id="编程/普通编辑器/IDE：">编程/普通编辑器/IDE：</h2><p>ctrl+space或alt+/：补全代码</p>
<p>ctrl+p：Show parameters for selected method，函数参数提示；</p>
<p>shift+alt+F：格式化代码</p>
<p>ctrl+/：注释代码</p>
<p>ctrl+L：清空控制台</p>
<p>ctrl+Home/End：选中当前光标所在位置之前/之后的一个单词；</p>
<p>ctrl+shift+Home/End：选中当前光标所在位置之前/之后的所有字符；</p>
<p>shift+左右箭头：以字符为单位选中；</p>
<p>ctrl+左右箭头：以单词为单位跳转；</p>
<p>shift+ctrl+左右箭头：以单词为单位选中；</p>
<p>alt+shift+上下箭头：本行和上下行换行；</p>
<p>ctrl+x：删除行；</p>
<p>ctrl+d：复制本行到下一行；</p>
<p>shift+alt+s：自动生成代码（比如get set方法）；</p>
<p>选中代码块右键&gt;surround with：自动生成代码（比如try…catch块儿）；</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/others/">others</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/others/">others</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-7-29-JVM-data-field" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/29/2015-7-29-JVM-data-field/" class="article-date">
  	<time datetime="2015-07-28T16:00:00.000Z" itemprop="datePublished">2015-07-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/29/2015-7-29-JVM-data-field/">JVM运行时数据区</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="JVM运行时数据区的理解">JVM运行时数据区的理解</h2><ul>
<li>运行时数据区面向线程，而不面向类或方法或对象；</li>
<li>线程共享：方法区、堆内存（heap）,线程私有：虚拟机栈（栈内存stack）、本地方法栈、程序计数器；</li>
<li>程序计数器：存放线程执行位置（main函数也是一个线程）；</li>
<li>虚拟机栈（栈内存）：生命周期和对应的线程相同，存放该线程的局部变量、对象的引用；方法中可能嵌套调用别的方法，这些方法的变量以”先进后出、后进先出“的方式在栈内存中存储，所以内层方法无法访问外层方法的变量（他们在栈底），执行外层方法时内层方法的变量已经弹出栈消失了，所以外层方法也不会访问到内层方法的变量；一个方法的执行过程，就是这个方法对于帧栈的入栈出栈过程；</li>
<li>本地方法栈：作用和虚拟机栈完全相同；虚拟机栈对应普通的java方法，本地方法栈对应native方法；native方法是一个java调用非java代码的接口；</li>
<li>方法区：JVM内存管理中最大一块；存储常量（final修饰）、类变量/成员变量（static修饰）、类信息（每个类的访问控制符、修饰符、继承关系等）；</li>
<li>堆内存：JVM启动时创建，存放对象本身，不存放对对象的引用（引用存在栈内存）；</li>
<li>JVM垃圾收集特指收集堆内存中的失去引用的对象的存储空间；栈内存存储空间不予收集；如果一个对象长期不失去引用、但在程序中已经没有用，那么系统不会进行垃圾收集，可能造成内存泄露/内存溢出；</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-5-11-mapreduce-program" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/11/2015-5-11-mapreduce-program/" class="article-date">
  	<time datetime="2015-05-10T16:00:00.000Z" itemprop="datePublished">2015-05-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/11/2015-5-11-mapreduce-program/">MapReduce编程技巧和注意事项</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>在编写Mapreduce程序的过程中会遇到各种各样的问题，本文为您梳理了常见的问题、注意事项和技巧；</li>
</ul>
<h3 id="MapReduce中常见的数据类型转换方法">MapReduce中常见的数据类型转换方法</h3><table>
<thead>
<tr>
<th>类型转换</th>
<th style="text-align:center">方法汇总</th>
</tr>
</thead>
<tbody>
<tr>
<td>int&gt;String</td>
<td style="text-align:center">int i=12345; String s=””; 第一种方法：s=i+””; 第二种方法：s=String.valueOf(i);</td>
</tr>
<tr>
<td>String&gt;int</td>
<td style="text-align:center">s=”12345”; int i; 第一种方法：i=Integer.parseInt(s); 第二种方法：i=Integer.valueOf(s).intValue();</td>
</tr>
<tr>
<td>LongWritable&gt;String</td>
<td style="text-align:center">LongWritable.toString()</td>
</tr>
<tr>
<td>String&gt;long</td>
<td style="text-align:center">Long.parseLong(String)</td>
</tr>
<tr>
<td>Text&gt;String</td>
<td style="text-align:center">Text.toString()</td>
</tr>
<tr>
<td>long&gt;LongWritable</td>
<td style="text-align:center">new LongWritable(long)</td>
</tr>
<tr>
<td>String&gt;Text</td>
<td style="text-align:center">new Text(String)</td>
</tr>
</tbody>
</table>
<h3 id="编程注意事项">编程注意事项</h3><ul>
<li><p>hadoop特有的数据类型（LongWritable、IntWritable和Text等）和java的数据结构（set、list、map等）不兼容，以下使用情形会出错：<br>例如：<code>Set &lt;Text&gt; userSet = new HashSet&lt;Text&gt;();</code>  或者  <code>List &lt;LongWritable&gt; list = new ArrayList &lt;LongWritable&gt;();</code><br>所以尽量不要同时使用；</p>
</li>
<li><p>reduce中遍历values的过程只能执行一遍，因为values是Iterable迭代器类型；如果需要多次遍历values内容，要么每次遍历前移动迭代器指针到初始位置，要么第一次遍历时将values内容放入list中，方便以后重复访问；</p>
</li>
<li><p>map的输出必须是Writable类型的（比如IntWritable、LongWritable、Text），如果是普通java类型（Integer、Long、String）会出错（报错：Unable to initialize MapOutputCollector）；</p>
</li>
<li><p>map的输入固定为<key=这一行的输入在分片文件中的偏移量，value=这一行内容>，输入类型为<object类型，text类型>，这些都不能随意更改，如需更改，要重写inputFormat；</object类型，text类型></key=这一行的输入在分片文件中的偏移量，value=这一行内容></p>
</li>
</ul>
<h3 id="Mapreduce程序参数设置">Mapreduce程序参数设置</h3><table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:center">设置方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>不执行reduce函数</td>
<td style="text-align:center">job.setNumReduceTasks(0);此时不执行reduce，输出文件的数量就是map的数量；</td>
</tr>
<tr>
<td>设置执行map的类</td>
<td style="text-align:center">job.setMapperClass(FlowFilter.class);</td>
</tr>
<tr>
<td>设置执行combine的类（一般就是reduce类）</td>
<td style="text-align:center">job.setCombinerClass(Reduce.class);</td>
</tr>
<tr>
<td>设置执行reduce的类</td>
<td style="text-align:center">job.setReducerClass(DNTGUserInfoReducer.class);</td>
</tr>
<tr>
<td>设置map的数量</td>
<td style="text-align:center">job.setNumMapTasks(maps)；</td>
</tr>
<tr>
<td>设置reduce数量（最终输出文件数量）</td>
<td style="text-align:center">job.setNumReduceTasks(reduces);</td>
</tr>
<tr>
<td>设置文件输入类型（默认为inputFormat，一行一行读取）</td>
<td style="text-align:center">job.setInputFormatClass(ProvinceInputFormat.class);</td>
</tr>
<tr>
<td>设置map的输出类型（key、value类型）</td>
<td style="text-align:center">job.setMapOutputKeyClass(HMKey.class);  job.setMapOutputValueClass(HMValue.class);</td>
</tr>
<tr>
<td>设置redcue的输出类型（key、value类型）</td>
<td style="text-align:center">job.setReduceOutputKeyClass(Text.class);  job.setReduceOutputValueClass(IntWritable.class);</td>
</tr>
<tr>
<td>统一设置map和reduce的输出类型</td>
<td style="text-align:center">job.setOutputKeyClass(Text.class);  job.setOutputValueClass(IntWritable.class);</td>
</tr>
<tr>
<td>设置整个程序输入、输出路径</td>
<td style="text-align:center">FileInputFormat.addInputPath(job, new Path(otherArgs[0]));  FileOutputFormat.setOutputPath(job, new Path(otherArgs[1]));</td>
</tr>
</tbody>
</table>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mapreduce/">mapreduce</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/hadoop/">hadoop</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
    <article id="post-2015-5-10-mapreduce-model" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/10/2015-5-10-mapreduce-model/" class="article-date">
  	<time datetime="2015-05-09T16:00:00.000Z" itemprop="datePublished">2015-05-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/10/2015-5-10-mapreduce-model/">MapReduce设计模式实例解析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引言">引言</h3><ul>
<li>MapReduce设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的代码设计经验总结；</li>
<li>使用设计模式的目的：使用设计模式是为了提高编码效率、提高代码重用率、让代码更容易被他人理解、保证代码可靠性；</li>
<li>设计模式千万种，本文为您梳理出来最重要、最常用的几种设计模式，方便理解和掌握；</li>
<li>本文的每一种设计模式都搭配了实例程序，以及输入和输出，让您更好更快地理解；</li>
</ul>
<h3 id="计数（Counting）一">计数（Counting）一</h3><ul>
<li>问题定义：在数据文件中包含大量的记录，每条记录中包含了某个实体的若干数值属性，目标问题是要计算每个实体的某个数值属性的函数表达式值，例如求和、平均值等；</li>
<li>具体问题描述：现在有一个英文文件，需要统计其中每个单词的个数（wordcount）；</li>
<li>解决方案：在map中分离每个单词，传入reduce，在reduce中将每个单词的value相加；</li>
<li>程序：</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wordcountTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span><br><span class="line">            <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt;&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>); <span class="comment">// type of output value</span></span><br><span class="line">    <span class="keyword">private</span> Text word = <span class="keyword">new</span> Text();   <span class="comment">// type of output key</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="typename">void</span> map(LongWritable key, Text value, Context context</span><br><span class="line">                    ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">      StringTokenizer itr = <span class="keyword">new</span> StringTokenizer(value.toString()); <span class="comment">// line to string token</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">while</span> (itr.hasMoreTokens()) &#123;</span><br><span class="line">        word.set(itr.nextToken());    <span class="comment">// set word as each input keyword</span></span><br><span class="line">        context.write(word, one);     <span class="comment">// create a pair &lt;keyword, 1&gt; </span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Reduce</span></span><br><span class="line">       <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">IntWritable</span>,<span class="title">Text</span>,<span class="title">IntWritable</span>&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="typename">void</span> reduce(Text key, Iterable&lt;IntWritable&gt; values, </span><br><span class="line">                       Context context</span><br><span class="line">                       ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">      <span class="typename">int</span> sum = <span class="number">0</span>; <span class="comment">// initialize the sum for each keyword</span></span><br><span class="line">      <span class="keyword">for</span> (IntWritable <span class="string">val :</span> values) &#123;</span><br><span class="line">        sum += val.get();  </span><br><span class="line">      &#125;</span><br><span class="line">      result.set(sum);</span><br><span class="line"></span><br><span class="line">      context.write(key, result); <span class="comment">// create a pair &lt;keyword, number of occurences&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Driver program</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="typename">void</span> main(String[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration(); </span><br><span class="line">    String[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args).getRemainingArgs(); <span class="comment">// get all args</span></span><br><span class="line">    <span class="keyword">if</span> (otherArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">      System.err.println(<span class="string">"Usage: WordCount &lt;in&gt; &lt;out&gt;"</span>);</span><br><span class="line">      System.exit(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a job with name "wordcount"</span></span><br><span class="line">    Job job = <span class="keyword">new</span> Job(conf, <span class="string">"wordcount"</span>);</span><br><span class="line">    job.setJarByClass(WordCount.<span class="keyword">class</span>);</span><br><span class="line">    job.setMapperClass(Map.<span class="keyword">class</span>);</span><br><span class="line">    job.setReducerClass(Reduce.<span class="keyword">class</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// uncomment the following line to add the Combiner</span></span><br><span class="line">    job.setCombinerClass(Reduce.<span class="keyword">class</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// set output key type   </span></span><br><span class="line">    job.setOutputKeyClass(Text.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// set output value type</span></span><br><span class="line">    job.setOutputValueClass(IntWritable.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">//set the HDFS path of the input data</span></span><br><span class="line">    FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">0</span>]));</span><br><span class="line">    <span class="comment">// set the HDFS path for the output</span></span><br><span class="line">    FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Wait till job completion</span></span><br><span class="line">    System.exit(job.waitForCompletion(<span class="literal">true</span>) ? 0 : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">输入：一篇英文文章，单词之间用空格分割</span><br><span class="line">apple banana banana yellow</span><br><span class="line">yellow orange apple orange</span><br><span class="line"></span><br><span class="line">输出：词频统计结果</span><br><span class="line">apple <span class="number">2</span></span><br><span class="line">banana <span class="number">2</span></span><br><span class="line">yellow <span class="number">2</span></span><br><span class="line">orange <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="计数（Counting）二">计数（Counting）二</h3><ul>
<li>具体问题描述：输入文件为两列，分别为用户手机号和流量数，现需要统计每个用户的总流量数；</li>
<li>解决方案：map中将每个用户的手机号、流量分别作为key和value传入reduce，由reduce来统计总流量数；</li>
<li>程序：</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wordcountTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Counter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> class WordCount &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> class Map </span><br><span class="line">            extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>); <span class="comment">// type of output value</span></span><br><span class="line">    <span class="keyword">private</span> Text user = <span class="keyword">new</span> Text();   <span class="comment">// type of output key</span></span><br><span class="line">    <span class="keyword">private</span> IntWritable flow = <span class="keyword">new</span> IntWritable();</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">map</span>(LongWritable <span class="variable">key</span>, Text value, Context context</span><br><span class="line">                    ) <span class="keyword">throws</span> IOException, InterruptedException </span><br><span class="line">    	<span class="keyword">String</span> <span class="built_in">line</span> = value.toString();</span><br><span class="line">    	<span class="keyword">String</span> [] array = <span class="built_in">line</span>.<span class="built_in">split</span>(<span class="string">"\t"</span>);</span><br><span class="line">    	<span class="keyword">if</span>(array.length==<span class="number">2</span>)&#123;</span><br><span class="line">    		user.<span class="built_in">set</span>(array[<span class="number">0</span>]);</span><br><span class="line">    		flow = <span class="keyword">new</span> IntWritable(Integer.parseInt(array[<span class="number">1</span>]));</span><br><span class="line">    		context.write(user, flow);</span><br><span class="line">    	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    		<span class="keyword">return</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> class Reduce</span><br><span class="line">       extends Reducer&lt;Text,IntWritable,Text,IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> reduce(Text <span class="variable">key</span>, Iterable&lt;IntWritable&gt; values, </span><br><span class="line">                       Context context</span><br><span class="line">                       ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">      <span class="built_in">int</span> sum = <span class="number">0</span>; <span class="comment">// initialize the sum for each keyword</span></span><br><span class="line">      <span class="keyword">for</span> (IntWritable val : values) &#123;</span><br><span class="line">        sum += val.<span class="built_in">get</span>();  </span><br><span class="line">      &#125;</span><br><span class="line">      result.<span class="built_in">set</span>(sum);</span><br><span class="line"></span><br><span class="line">      context.write(<span class="variable">key</span>, result); <span class="comment">// create a pair &lt;keyword, number of occurences&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Driver program</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration(); </span><br><span class="line">    <span class="keyword">String</span>[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args).getRemainingArgs(); <span class="comment">// get all args</span></span><br><span class="line">    System.out.<span class="built_in">println</span>(System.getenv(<span class="string">"HADOOP_HOME"</span>));</span><br><span class="line">    <span class="keyword">if</span> (otherArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">      System.err.<span class="built_in">println</span>(<span class="string">"Usage: WordCount &lt;in&gt; &lt;out&gt;"</span>);</span><br><span class="line">      System.<span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a job with name "wordcount"</span></span><br><span class="line">    Job job = <span class="keyword">new</span> Job(conf, <span class="string">"userflow"</span>);</span><br><span class="line">    job.setJarByClass(WordCount.class);</span><br><span class="line">    job.setMapperClass(Map.class);</span><br><span class="line">    job.setReducerClass(Reduce.class);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// uncomment the following line to add the Combiner</span></span><br><span class="line">    <span class="comment">// job.setCombinerClass(Reduce.class);</span></span><br><span class="line">    <span class="comment">// set output key type   </span></span><br><span class="line">    job.setOutputKeyClass(Text.class);</span><br><span class="line">    <span class="comment">// set output value type</span></span><br><span class="line">    job.setOutputValueClass(IntWritable.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//set reduce number</span></span><br><span class="line">    job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//set the HDFS path of the input data</span></span><br><span class="line">    FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">0</span>]));</span><br><span class="line">    <span class="comment">// set the HDFS path for the output</span></span><br><span class="line">    FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">1</span>]));</span><br><span class="line">    <span class="comment">//Wait till job completion</span></span><br><span class="line">    System.<span class="built_in">exit</span>(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：用户手机号和流量，用空格分割</span><br><span class="line"><span class="number">13500000000</span> <span class="number">10</span></span><br><span class="line"><span class="number">13800000000</span> <span class="number">20</span></span><br><span class="line"><span class="number">13500000000</span> <span class="number">20</span></span><br><span class="line"><span class="number">13800000000</span> <span class="number">15</span></span><br><span class="line"><span class="number">18700000000</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">输出：每个手机号的总流量</span><br><span class="line"><span class="number">13500000000</span> <span class="number">30</span></span><br><span class="line"><span class="number">13800000000</span> <span class="number">35</span></span><br><span class="line"><span class="number">18700000000</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>
<h3 id="分类（classfication）">分类（classfication）</h3><ul>
<li>问题定义：在数据文件中包含大量的记录，每条记录中包含了某个实体的若干属性，目标问题是在给定一个计算函数的情况下，将此计算函数计算后得到的结果相同的实体放在一起；</li>
<li>具体问题描述：输入数据为两列，分别是手机号和其访问的网址，目的是统计同一个网址有哪些手机号访问过；</li>
<li>解决方案：map阶段把网址、手机号分别作为key、value传入reduce，由reduce实现分类；</li>
<li>程序：</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wordcountTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Counter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span><br><span class="line">            <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt;&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>); <span class="comment">// type of output value</span></span><br><span class="line">    <span class="keyword">private</span> Text webPage = <span class="keyword">new</span> Text();   <span class="comment">// type of output key</span></span><br><span class="line">    <span class="keyword">private</span> LongWritable flow = <span class="keyword">new</span> LongWritable();</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="typename">void</span> map(LongWritable key, Text value, Context context</span><br><span class="line">                    ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">    	String line = value.toString();</span><br><span class="line">    	String [] array = line.split(<span class="string">" "</span>);</span><br><span class="line">    	<span class="keyword">if</span>(array.length==<span class="number">2</span>)&#123;</span><br><span class="line">    		webPage.set(array[<span class="number">1</span>]);</span><br><span class="line">    		flow = <span class="keyword">new</span> LongWritable(Long.parseLong(array[<span class="number">0</span>]));</span><br><span class="line">    		context.write(webPage,flow);</span><br><span class="line">    	&#125;<span class="comment">/*else&#123;</span><br><span class="line">    		return;</span><br><span class="line">    	&#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Reduce</span></span><br><span class="line">       <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="typename">void</span> reduce(Text key, Iterable&lt;LongWritable&gt; values, </span><br><span class="line">                       Context context</span><br><span class="line">                       ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (LongWritable <span class="string">val :</span> values) &#123;</span><br><span class="line">    	  context.write(key, val);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Driver program</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="typename">void</span> main(String[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration(); </span><br><span class="line">    String[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args).getRemainingArgs(); <span class="comment">// get all args</span></span><br><span class="line">    System.out.println(System.getenv(<span class="string">"HADOOP_HOME"</span>));</span><br><span class="line">    <span class="keyword">if</span> (otherArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">      System.err.println(<span class="string">"Usage: WordCount &lt;in&gt; &lt;out&gt;"</span>);</span><br><span class="line">      System.exit(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a job with name "wordcount"</span></span><br><span class="line">    Job job = <span class="keyword">new</span> Job(conf, <span class="string">"userflow"</span>);</span><br><span class="line">    job.setJarByClass(WordCount.<span class="keyword">class</span>);</span><br><span class="line">    job.setMapperClass(Map.<span class="keyword">class</span>);</span><br><span class="line">    job.setReducerClass(Reduce.<span class="keyword">class</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// uncomment the following line to add the Combiner</span></span><br><span class="line">    <span class="comment">// job.setCombinerClass(Reduce.class);</span></span><br><span class="line">    <span class="comment">// set output key type  </span></span><br><span class="line"></span><br><span class="line">    job.setOutputKeyClass(Text.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// set output value type</span></span><br><span class="line">    job.setOutputValueClass(LongWritable.<span class="keyword">class</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//set reduce number</span></span><br><span class="line">    job.setNumReduceTasks(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">//set the HDFS path of the input data</span></span><br><span class="line">    FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">0</span>]));</span><br><span class="line">    <span class="comment">// set the HDFS path for the output</span></span><br><span class="line">    FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">1</span>]));</span><br><span class="line">    <span class="comment">//Wait till job completion</span></span><br><span class="line">    System.exit(job.waitForCompletion(<span class="literal">true</span>) ? 0 : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出：</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">输入：手机号和网址，用空格分割</span><br><span class="line"><span class="number">18500000001</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">18500000002</span> souhu<span class="class">.com</span></span><br><span class="line"><span class="number">18500000003</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">18500000004</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">18500000005</span> souhu<span class="class">.com</span></span><br><span class="line"><span class="number">18500000006</span> github<span class="class">.com</span></span><br><span class="line"><span class="number">18500000007</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">18500000008</span> github<span class="class">.com</span></span><br><span class="line"></span><br><span class="line">输出：每个网址对应的访问过它的手机号</span><br><span class="line">github<span class="class">.com</span> <span class="number">18500000006</span></span><br><span class="line">github<span class="class">.com</span> <span class="number">18500000008</span></span><br><span class="line">sina<span class="class">.com</span> <span class="number">18500000001</span></span><br><span class="line">sina<span class="class">.com</span> <span class="number">18500000003</span></span><br><span class="line">sina<span class="class">.com</span> <span class="number">18500000004</span></span><br><span class="line">sina<span class="class">.com</span> <span class="number">18500000007</span></span><br><span class="line">souhu<span class="class">.com</span> <span class="number">18500000002</span></span><br><span class="line">souhu<span class="class">.com</span> <span class="number">18500000005</span></span><br></pre></td></tr></table></figure>
<ul>
<li>说明：本程序并不能实现将每一个网址放入单独的文件输出，这是因为在“shuffle”过程中，计算出的partitionID相同的key被分到一个reduce中，然而，不同的key的partitionID可能相同，即同一个key肯定被分到同一个reduce，但是同一个reduce中可能有不同的key，所以上述算法不能实现完全分类。关于shuffle请参考我的另一篇博客<a href="http://changsiyuan.github.io/hadoop/2015/04/01/mapreduce/" target="_blank" rel="external">Mapreduce过程详解</a></li>
</ul>
<h3 id="过滤（filtering）">过滤（filtering）</h3><ul>
<li>问题定义：在数据文件中包含大量的记录，每条记录中包含了某个实体的若干属性，目标问题是在将符合某个条件的记录取出（或进行格式转换）；</li>
<li>具体问题描述：输入文件为三列：手机号、属性、访问网站，目标是将属性为0的记录过滤掉；</li>
<li>解决方案：map中将前两列作为key，最后一列为value，判断属性后输出过滤结果即可，不需要reduce过程；</li>
<li>程序：</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wordcountTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Counter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> class WordCount &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> class Map extends Mapper&lt;<span class="keyword">Object</span>, Text, <span class="keyword">String</span>, Text&gt; &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>); </span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> KVcount user = <span class="keyword">new</span> KVcount(); <span class="comment">// type of output key</span></span><br><span class="line">		<span class="keyword">private</span> Text webPage = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">map</span>(<span class="keyword">Object</span> <span class="variable">key</span>, Text value, Context context</span><br><span class="line">                    ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    	<span class="keyword">String</span> <span class="built_in">line</span> = value.toString();</span><br><span class="line">    	<span class="keyword">String</span> [] array = <span class="built_in">line</span>.<span class="built_in">split</span>(<span class="string">" "</span>);</span><br><span class="line">    	<span class="keyword">if</span>(array.length==<span class="number">3</span>)&#123;</span><br><span class="line">    		user.setphoneNum(Long.parseLong(array[<span class="number">0</span>]));</span><br><span class="line">    		user.setattribute(Integer.parseInt(array[<span class="number">1</span>]));</span><br><span class="line">    		webPage = <span class="keyword">new</span> Text(array[<span class="number">2</span>]);</span><br><span class="line">    		<span class="keyword">if</span>(user.attribute!=<span class="number">0</span>)&#123;</span><br><span class="line">    			context.write(<span class="keyword">String</span>.valueOf(user.phoneNum)+<span class="string">"  "</span>+<span class="keyword">String</span>.valueOf(user.attribute),webPage);</span><br><span class="line">    		&#125;</span><br><span class="line">    		</span><br><span class="line">    	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    		<span class="keyword">return</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//本程序不需要reduce过程</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> class Reduce extends</span><br><span class="line">			Reducer&lt;KVcount, Text, Text, LongWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> reduce(Text <span class="variable">key</span>, Iterable&lt;LongWritable&gt; values,</span><br><span class="line">				Context context) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">				</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Driver program</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		<span class="keyword">String</span>[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args)</span><br><span class="line">				.getRemainingArgs(); <span class="comment">// get all args</span></span><br><span class="line">		System.out.<span class="built_in">println</span>(System.getenv(<span class="string">"HADOOP_HOME"</span>));</span><br><span class="line">		<span class="keyword">if</span> (otherArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">			System.err.<span class="built_in">println</span>(<span class="string">"Usage: WordCount &lt;in&gt; &lt;out&gt;"</span>);</span><br><span class="line">			System.<span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// create a job with name "wordcount"</span></span><br><span class="line">		Job job = <span class="keyword">new</span> Job(conf, <span class="string">"userflow"</span>);</span><br><span class="line">		job.setJarByClass(WordCount.class);</span><br><span class="line">		job.setMapperClass(Map.class);</span><br><span class="line">		<span class="comment">// job.setReducerClass(Reduce.class);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// uncomment the following line to add the Combiner</span></span><br><span class="line">		<span class="comment">// job.setCombinerClass(Reduce.class);</span></span><br><span class="line">		<span class="comment">// set output key type</span></span><br><span class="line"></span><br><span class="line">		job.setMapOutputKeyClass(KVcount.class);</span><br><span class="line">		job.setMapOutputValueClass(Text.class);</span><br><span class="line">		</span><br><span class="line"><span class="comment">//		job.setOutputKeyClass(Text.class);</span></span><br><span class="line"><span class="comment">//		// set output value type</span></span><br><span class="line"><span class="comment">//		job.setOutputValueClass(LongWritable.class);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// set reduce number</span></span><br><span class="line">		job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line">		<span class="comment">// set the HDFS path of the input data</span></span><br><span class="line">		FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">0</span>]));</span><br><span class="line">		<span class="comment">// set the HDFS path for the output</span></span><br><span class="line">		FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">1</span>]));</span><br><span class="line">		<span class="comment">// Wait till job completion</span></span><br><span class="line">		System.<span class="built_in">exit</span>(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">输入：手机号、属性、网站</span><br><span class="line"><span class="number">18500000001</span> <span class="number">0</span> sina.com</span><br><span class="line"><span class="number">18500000002</span> <span class="number">0</span> souhu.com</span><br><span class="line"><span class="number">18500000003</span> <span class="number">1</span> sina.com</span><br><span class="line"><span class="number">18500000004</span> <span class="number">0</span> sina.com</span><br><span class="line"><span class="number">18500000005</span> <span class="number">1</span> souhu.com</span><br><span class="line"><span class="number">18500000006</span> <span class="number">1</span> github.com</span><br><span class="line"><span class="number">18500000007</span> <span class="number">1</span> sina.com</span><br><span class="line"><span class="number">18500000008</span> <span class="number">0</span> github.com</span><br><span class="line"></span><br><span class="line">输出：属性为<span class="number">1</span>的被过滤出来</span><br><span class="line"><span class="number">18500000003</span> <span class="number">1</span> sina.com</span><br><span class="line"><span class="number">18500000005</span> <span class="number">1</span> souhu.com</span><br><span class="line"><span class="number">18500000006</span> <span class="number">1</span> github.com</span><br><span class="line"><span class="number">18500000007</span> <span class="number">1</span> sina.com</span><br></pre></td></tr></table></figure>
<h3 id="排序（Sorting）">排序（Sorting）</h3><ul>
<li>问题定义：在数据文件中包含大量的记录，每条记录中包含了某个实体的若干属性，目标问题是在将记录按照一定规则排序后输出；</li>
<li>具体问题描述：输入为三列，手机号、上行流量、下行流量，要求计算每个手机号的总流量并按照从小到大的顺序输出；</li>
<li>解决方案：在map中将上下行流量相加，得出总流量，以&lt;手机号，总流量&gt;形式输出；reduce中将每个手机号按照总流量从小到大的顺序排序后输出；</li>
<li>程序：</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wordcountTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Counter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.generic.<span class="keyword">NEW</span>;</span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.bind.v2.<span class="keyword">runtime</span>.unmarshaller.XsiNilLoader.Array;</span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.ws.policy.privateutil.PolicyUtils.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> WordCount &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> Map <span class="keyword">extends</span></span><br><span class="line">			Mapper&lt;Object, Text, LongWritable, LongWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>); </span><br><span class="line">		<span class="keyword">private</span> LongWritable phoneNumber = <span class="keyword">new</span> LongWritable(); </span><br><span class="line">		<span class="keyword">private</span> LongWritable totalFlow = <span class="keyword">new</span> LongWritable();  <span class="comment">//记录总流量</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> map(Object key, Text value, Context context)</span><br><span class="line">				<span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">			String line = value.toString();</span><br><span class="line">			String[] array = line.split(<span class="string">" "</span>);</span><br><span class="line">			totalFlow = <span class="keyword">new</span> LongWritable(<span class="keyword">Long</span>.parseLong(array[<span class="number">1</span>])</span><br><span class="line">					+ <span class="keyword">Long</span>.parseLong(array[<span class="number">2</span>]));  <span class="comment">//上下行流量相加</span></span><br><span class="line">			<span class="keyword">if</span> (array.length == <span class="number">3</span>) &#123;</span><br><span class="line">				context.<span class="keyword">write</span>(<span class="keyword">new</span> LongWritable(<span class="keyword">Long</span>.parseLong(array[<span class="number">0</span>])), totalFlow);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> Reduce <span class="keyword">extends</span></span><br><span class="line">			Reducer&lt;LongWritable, LongWritable, LongWritable, Object&gt; &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> reduce(LongWritable key, Iterable&lt;LongWritable&gt; values,</span><br><span class="line">				Context context) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">			</span><br><span class="line">			List &lt;<span class="keyword">Long</span>&gt; totalUserFlow = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">Long</span>&gt;();</span><br><span class="line">			<span class="keyword">for</span> (LongWritable val : values) &#123;</span><br><span class="line">				totalUserFlow.add(val.get());</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			Object[] arrObjects =totalUserFlow.toArray();</span><br><span class="line">			Arrays.<span class="keyword">sort</span>(arrObjects);</span><br><span class="line">		</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;arrObjects.length; j++)&#123;</span><br><span class="line">				context.<span class="keyword">write</span>(key, arrObjects[j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Driver program</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		String[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args)</span><br><span class="line">				.getRemainingArgs(); <span class="comment">// get all args</span></span><br><span class="line">		System.out.<span class="keyword">println</span>(System.getenv(<span class="string">"HADOOP_HOME"</span>));</span><br><span class="line">		<span class="keyword">if</span> (otherArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">			System.err.<span class="keyword">println</span>(<span class="string">"Usage: WordCount &lt;in&gt; &lt;out&gt;"</span>);</span><br><span class="line">			System.exit(<span class="number">2</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// create a job with name "wordcount"</span></span><br><span class="line">		Job job = <span class="keyword">new</span> Job(conf, <span class="string">"userflow"</span>);</span><br><span class="line">		job.setJarByClass(WordCount.<span class="keyword">class</span>);</span><br><span class="line">		job.setMapperClass(Map.<span class="keyword">class</span>);</span><br><span class="line">		job.setReducerClass(Reduce.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// uncomment the following line to add the Combiner</span></span><br><span class="line">		<span class="comment">// job.setCombinerClass(Reduce.class);</span></span><br><span class="line">		<span class="comment">// set output key type</span></span><br><span class="line"></span><br><span class="line">		job.setMapOutputKeyClass(LongWritable.<span class="keyword">class</span>);</span><br><span class="line">		job.setMapOutputValueClass(LongWritable.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">		job.setOutputKeyClass(LongWritable.<span class="keyword">class</span>);</span><br><span class="line">		job.setOutputValueClass(Object.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// set reduce number</span></span><br><span class="line">		job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">		<span class="comment">// set the HDFS path of the input data</span></span><br><span class="line">		FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">0</span>]));</span><br><span class="line">		<span class="comment">// set the HDFS path for the output</span></span><br><span class="line">		FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">1</span>]));</span><br><span class="line">		<span class="comment">// Wait till job completion</span></span><br><span class="line">		System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：手机号、上行流量、下行流量，以空格分割</span><br><span class="line"><span class="number">15700000000</span> <span class="number">3333</span> <span class="number">2222</span></span><br><span class="line"><span class="number">13900000000</span> <span class="number">3333</span> <span class="number">4444</span></span><br><span class="line"><span class="number">15700000000</span> <span class="number">1111</span> <span class="number">2222</span></span><br><span class="line"><span class="number">13900000000</span> <span class="number">2222</span> <span class="number">1111</span></span><br><span class="line"></span><br><span class="line">输出：按照总流量大小排序输出</span><br><span class="line"><span class="number">13900000000</span> <span class="number">3333</span></span><br><span class="line"><span class="number">13900000000</span> <span class="number">7777</span></span><br><span class="line"><span class="number">15700000000</span> <span class="number">3333</span></span><br><span class="line"><span class="number">15700000000</span> <span class="number">5555</span></span><br></pre></td></tr></table></figure>
<h3 id="去重计数（Distinct_Counting）">去重计数（Distinct Counting）</h3><ul>
<li>问题定义：在数据文件中包含大量的记录，每条记录中包含了某个实体的若干属性，目标问题是在计算某几个属性组合后去掉相同重复组合后，其中某一属性的统计值；</li>
<li>具体问题的描述：输入为两列，手机号、访问网址，要求统计每个网址都有几种手机号访问；</li>
<li>解决方案：map中将网址作为key、手机号作为value，发送给reduce；计数、去重的工作都由reduce完成；去重的工作由HashSet完成；</li>
<li>程序：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">package wordcount_test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenizerMapper</span></span><br><span class="line">       <span class="title">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">LongWritable</span> phoneNum = new <span class="type">LongWritable</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> webPage = new <span class="type">Text</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void <span class="built_in">map</span>(<span class="type">Object</span> key, <span class="type">Text</span> value, <span class="type">Context</span> context</span><br><span class="line">                    ) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line">    	<span class="type">String</span> line = value.<span class="built_in">toString</span>();</span><br><span class="line">		<span class="type">String</span>[] array = line.<span class="built_in">split</span>(<span class="string">" "</span>);</span><br><span class="line">		<span class="keyword">if</span>(array.length==<span class="number">2</span>)&#123;</span><br><span class="line">			phoneNum = new <span class="type">LongWritable</span>(<span class="type">Long</span>.parseLong(array[<span class="number">0</span>]));</span><br><span class="line">			webPage = new <span class="type">Text</span>(array[<span class="number">1</span>]);</span><br><span class="line">			context.write(webPage, phoneNum);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntSumReducer</span></span><br><span class="line">       <span class="title">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">IntWritable</span> result = new <span class="type">IntWritable</span>();</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> void <span class="built_in">reduce</span>(<span class="type">Text</span> key, <span class="type">Iterable</span>&lt;<span class="type">LongWritable</span>&gt; values,</span><br><span class="line">                       <span class="type">Context</span> context</span><br><span class="line">                       ) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line"></span><br><span class="line">      int sum = <span class="number">0</span>;</span><br><span class="line">      <span class="type">Set</span> &lt;<span class="type">String</span>&gt; phoneNumSet = new <span class="type">HashSet</span>&lt;<span class="type">String</span>&gt;(); </span><br><span class="line">      <span class="keyword">for</span>(<span class="type">LongWritable</span> val : values)&#123;</span><br><span class="line">    	  phoneNumSet.add(val.<span class="built_in">toString</span>());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">String</span> s : phoneNumSet)&#123;</span><br><span class="line">    	  sum++;</span><br><span class="line">      &#125;</span><br><span class="line">      result.<span class="keyword">set</span>(sum);</span><br><span class="line">      context.write(key, result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) <span class="keyword">throws</span> <span class="type">Exception</span> &#123;</span><br><span class="line">    <span class="type">Configuration</span> conf = new <span class="type">Configuration</span>();</span><br><span class="line">    <span class="type">Job</span> job = <span class="type">Job</span>.getInstance(conf, <span class="string">"word count"</span>);</span><br><span class="line">    job.setJarByClass(<span class="type">WordCount</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setMapperClass(<span class="type">TokenizerMapper</span>.<span class="keyword">class</span>);</span><br><span class="line"><span class="comment">//    job.setCombinerClass(IntSumReducer.class);</span></span><br><span class="line">    job.setReducerClass(<span class="type">IntSumReducer</span>.<span class="keyword">class</span>);</span><br><span class="line">    </span><br><span class="line">    job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">    job.setMapOutputKeyClass(<span class="type">Text</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setMapOutputValueClass(<span class="type">LongWritable</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setOutputKeyClass(<span class="type">Text</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setOutputValueClass(<span class="type">IntWritable</span>.<span class="keyword">class</span>);</span><br><span class="line">    <span class="type">FileInputFormat</span>.addInputPath(job, new <span class="type">Path</span>(args[<span class="number">0</span>]));</span><br><span class="line">    <span class="type">FileOutputFormat</span>.setOutputPath(job, new <span class="type">Path</span>(args[<span class="number">1</span>]));</span><br><span class="line">    <span class="type">System</span>.exit(job.waitForCompletion(<span class="literal">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出：</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：手机号、访问网址，用空格分割</span><br><span class="line"><span class="number">15700000000</span> qq<span class="class">.com</span></span><br><span class="line"><span class="number">13900000000</span> qq<span class="class">.com</span></span><br><span class="line"><span class="number">13900000000</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">15700000000</span> qq<span class="class">.com</span></span><br><span class="line"><span class="number">15700000000</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">12900000000</span> sina<span class="class">.com</span></span><br><span class="line"></span><br><span class="line">输出：每个网址对应的手机号种类数量</span><br><span class="line">qq<span class="class">.com</span> <span class="number">2</span></span><br><span class="line">sina<span class="class">.com</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h3 id="相关计数（Cross-Correlation）">相关计数（Cross-Correlation）</h3><ul>
<li>问题定义：输入若干数组，每个数组是由若干实体构成，目标问题是计算数组中实体以一定条件要求成对出现的次数或概率；</li>
<li>具体问题描述：输入数据是2列，手机号、访问网址，现在需要统计每个手机号访问每个网址的次数；</li>
<li>解决方案：Stripes方法–map中将手机号作为key、访问网址和计数值1作为value，reduce中进行统计；Pairs方法–map中将手机号和访问网址作为key、计数值1作为value，reduce中进行统计；</li>
<li>程序：</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">Stripes方法:</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> wordcount_test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> class WordCount &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> class TokenizerMapper</span><br><span class="line">       extends Mapper&lt;<span class="keyword">Object</span>, Text, LongWritable, Text&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LongWritable phoneNum = <span class="keyword">new</span> LongWritable();</span><br><span class="line">    <span class="keyword">private</span> Text webPage = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">map</span>(<span class="keyword">Object</span> <span class="variable">key</span>, Text value, Context context</span><br><span class="line">                    ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">    	<span class="keyword">String</span> <span class="built_in">line</span> = value.toString();</span><br><span class="line">		<span class="keyword">String</span>[] array = <span class="built_in">line</span>.<span class="built_in">split</span>(<span class="string">" "</span>);</span><br><span class="line">		<span class="keyword">if</span>(array.length==<span class="number">2</span>)&#123;</span><br><span class="line">			phoneNum = <span class="keyword">new</span> LongWritable(Long.parseLong(array[<span class="number">0</span>]));</span><br><span class="line">			webPage = <span class="keyword">new</span> Text(array[<span class="number">1</span>]);</span><br><span class="line">			context.write(phoneNum, webPage);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> class IntSumReducer</span><br><span class="line">       extends Reducer&lt;LongWritable,Text, <span class="keyword">String</span>, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> reduce(LongWritable <span class="variable">key</span>, Iterable&lt;Text&gt; values,</span><br><span class="line">                       Context context</span><br><span class="line">                       ) <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">int</span> sum = <span class="number">0</span>;</span><br><span class="line">      Text webText;</span><br><span class="line">      <span class="keyword">String</span> webString;</span><br><span class="line">      List &lt;<span class="keyword">String</span>&gt; webList = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line">      Set &lt;<span class="keyword">String</span>&gt; webSet = <span class="keyword">new</span> HashSet&lt;<span class="keyword">String</span>&gt;(); </span><br><span class="line">      </span><br><span class="line">      <span class="comment">//将values迭代器内容放入list中，方便之后重复访问</span></span><br><span class="line">      <span class="keyword">for</span>(Text val : values)&#123;</span><br><span class="line">    	  webList.<span class="built_in">add</span>(val.toString());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//唯一的网址存入webSet</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">String</span> val : webList) &#123;</span><br><span class="line">    	  webSet.<span class="built_in">add</span>(val);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//分别统计当前手机号（key）的每个访问网址的次数并输出</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">String</span> s: webSet)&#123;</span><br><span class="line">    	  <span class="keyword">for</span> (<span class="keyword">String</span> web : webList) &#123;</span><br><span class="line">    		  <span class="keyword">if</span>(s.equals(web))&#123;</span><br><span class="line">    			  sum++;</span><br><span class="line">    		  &#125;</span><br><span class="line">    	  &#125;</span><br><span class="line">    	  result.<span class="built_in">set</span>(sum);</span><br><span class="line">    	  context.write(<span class="variable">key</span>.toString()+<span class="string">" "</span>+s, result);</span><br><span class="line">    	  sum =<span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">    Job job = Job.getInstance(conf, <span class="string">"word count"</span>);</span><br><span class="line">    job.setJarByClass(WordCount.class);</span><br><span class="line">    job.setMapperClass(TokenizerMapper.class);</span><br><span class="line"><span class="comment">//    job.setCombinerClass(IntSumReducer.class);</span></span><br><span class="line">    job.setReducerClass(IntSumReducer.class);</span><br><span class="line">    </span><br><span class="line">    job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">    job.setMapOutputKeyClass(LongWritable.class);</span><br><span class="line">    job.setMapOutputValueClass(Text.class);</span><br><span class="line">    job.setOutputKeyClass(<span class="keyword">String</span>.class);</span><br><span class="line">    job.setOutputValueClass(IntWritable.class);</span><br><span class="line">    FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">    FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line">    System.<span class="built_in">exit</span>(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">pairs方法：</span><br><span class="line"></span><br><span class="line">package wordcount_test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenizerMapper</span></span><br><span class="line">       <span class="title">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">IntWritable</span> one = new <span class="type">IntWritable</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> phoneNum = new <span class="type">String</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> webPage = new <span class="type">String</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void <span class="built_in">map</span>(<span class="type">Object</span> key, <span class="type">Text</span> value, <span class="type">Context</span> context</span><br><span class="line">                    ) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line">    	<span class="type">String</span> line = value.<span class="built_in">toString</span>();</span><br><span class="line">		<span class="type">String</span>[] array = line.<span class="built_in">split</span>(<span class="string">" "</span>);</span><br><span class="line">		<span class="keyword">if</span>(array.length==<span class="number">2</span>)&#123;</span><br><span class="line">			phoneNum = array[<span class="number">0</span>];</span><br><span class="line">			webPage = array[<span class="number">1</span>];</span><br><span class="line">			context.write(new <span class="type">Text</span>(phoneNum+<span class="string">" "</span>+webPage), one);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntSumReducer</span></span><br><span class="line">       <span class="title">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">IntWritable</span> result = new <span class="type">IntWritable</span>();</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> void <span class="built_in">reduce</span>(<span class="type">Text</span> key, <span class="type">Iterable</span>&lt;<span class="type">IntWritable</span>&gt; values,</span><br><span class="line">                       <span class="type">Context</span> context</span><br><span class="line">                       ) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line"></span><br><span class="line">    	int sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">IntWritable</span> val : values) &#123;</span><br><span class="line">          sum ++;</span><br><span class="line">        &#125;</span><br><span class="line">        result.<span class="keyword">set</span>(sum);</span><br><span class="line">        context.write(key, result);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) <span class="keyword">throws</span> <span class="type">Exception</span> &#123;</span><br><span class="line">    <span class="type">Configuration</span> conf = new <span class="type">Configuration</span>();</span><br><span class="line">    <span class="type">Job</span> job = <span class="type">Job</span>.getInstance(conf, <span class="string">"word count"</span>);</span><br><span class="line">    job.setJarByClass(<span class="type">WordCount</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setMapperClass(<span class="type">TokenizerMapper</span>.<span class="keyword">class</span>);</span><br><span class="line"><span class="comment">//    job.setCombinerClass(IntSumReducer.class);</span></span><br><span class="line">    job.setReducerClass(<span class="type">IntSumReducer</span>.<span class="keyword">class</span>);</span><br><span class="line">    </span><br><span class="line">    job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">    job.setMapOutputKeyClass(<span class="type">Text</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setMapOutputValueClass(<span class="type">IntWritable</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setOutputKeyClass(<span class="type">Text</span>.<span class="keyword">class</span>);</span><br><span class="line">    job.setOutputValueClass(<span class="type">IntWritable</span>.<span class="keyword">class</span>);</span><br><span class="line">    <span class="type">FileInputFormat</span>.addInputPath(job, new <span class="type">Path</span>(args[<span class="number">0</span>]));</span><br><span class="line">    <span class="type">FileOutputFormat</span>.setOutputPath(job, new <span class="type">Path</span>(args[<span class="number">1</span>]));</span><br><span class="line">    <span class="type">System</span>.exit(job.waitForCompletion(<span class="literal">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例输入输出：</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">输入：手机号、网址，中间用空格分割</span><br><span class="line"><span class="number">15700000000</span> qq<span class="class">.com</span></span><br><span class="line"><span class="number">13900000000</span> qq<span class="class">.com</span></span><br><span class="line"><span class="number">13900000000</span> sina<span class="class">.com</span></span><br><span class="line"><span class="number">15700000000</span> qq<span class="class">.com</span></span><br><span class="line"><span class="number">15700000000</span> sina<span class="class">.com</span></span><br><span class="line"></span><br><span class="line">输出：手机号、访问网址和对应的次数统计结果</span><br><span class="line"><span class="number">13900000000</span> qq<span class="class">.com</span> <span class="number">1</span></span><br><span class="line"><span class="number">13900000000</span> sina<span class="class">.com</span> <span class="number">1</span></span><br><span class="line"><span class="number">15700000000</span> qq<span class="class">.com</span> <span class="number">2</span></span><br><span class="line"><span class="number">15700000000</span> sina<span class="class">.com</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mapreduce/">mapreduce</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/hadoop/">hadoop</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
  <script>
  (function() {
    var cx = '017806109166577290598:caowtb3biqa';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>



</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Eric Chang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
	
	<a rel="license" href="http://creativecommons.org/licenses/by/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/cn/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by/3.0/cn/">知识共享署名 3.0 中国大陆许可协议</a>进行许可。
	
	<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','1BK1VZMDEA-ktxiBz_9B');
</script>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258423514'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1258423514%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
          
	
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>